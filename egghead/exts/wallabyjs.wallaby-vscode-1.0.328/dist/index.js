/*
 * wallaby-vscode - v1.0.328
 * http://wallabyjs.com
 * Copyright (c) 2014-2022 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of wallaby-vscode and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */

!function e(t,a,i){process.env.WALLABY_PRODUCTION=!0;var s="function"==typeof require&&require;module.exports=function o(n,r){if(!a[n]){if(!t[n]){var l="function"==typeof require&&require;if(!r&&l)return l(n,!0);if(s)return s(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[n]={exports:{}};t[n][0].call(d.exports,function(e){var a=t[n][1][e];return o(a||e)},d,d.exports,e,t,a,i)}return a[n].exports}(i[0])}({1:[function(e,t,a){"use strict";var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const s=e("fs"),o=e("path"),n=e("os"),r=e("vscode"),l=e("./lib/compositeDisposable"),c=r.window,d=r.workspace,h=/^darwin/.test(process.platform),u=6e5,p=e("./package.json").version,g=e("./lib/startViewPanel");class m{activate(t){return i(this,void 0,void 0,function*(){this.strictSSL=void 0,this.protocol="https",this._disposables=new l,t.subscriptions.push({dispose:()=>this.deactivate()}),r.window.registerWebviewPanelSerializer&&r.window.registerWebviewPanelSerializer(g.viewType,{deserializeWebviewPanel(e,a){return i(this,void 0,void 0,function*(){g.revive(e,t)})}}),this._initializeDownloadSettings(),this._initializeImages(t),this._disposables.add(()=>{delete this._failedUpdateCount,clearTimeout(this._updateChecker)}),setImmediate(()=>i(this,void 0,void 0,function*(){this._baseUrl=this.protocol+"://update.wallabyjs.com/",this._versionFile=o.join(__dirname,"wallaby.json"),this._corePackage=o.join(__dirname,"..","wallaby","package.json"),this._coreFolder=o.dirname(this._corePackage),this._coreVersionManifest=o.join(__dirname,"..","core.json"),this._lkp=o.join(n.homedir(),".wallaby","key.lic"),this._oldlkp=o.join(s.realpathSync(t.extensionPath),"..",".wlck"),this._updating=!0,!s.existsSync(this._lkp)&&s.existsSync(this._oldlkp)&&(this._lkp=this._oldlkp),(m._isDebugMode()||m._noAutomaticInstallMode())&&(this._baseDownload=(()=>{throw new Error("Can not delete/download/extract in this mode")})),this._setupStatusIndicator(),this._readVersionManifestAndRefreshCoreLocation();const a=!s.existsSync(o.join(n.homedir(),".wallaby"))||!s.existsSync(o.join(n.homedir(),".wallaby","key.lic"))&&!s.existsSync(o.join(n.homedir(),".wallaby","startPage.json")),r={context:t,coreClient:this._reloadCoreClient(),reloadCoreClient:()=>{this._updatingAfterLicenseChange?delete r.coreClient:(this._readVersionManifestAndRefreshCoreLocation(),r.coreClient=this._reloadCoreClient(),r.coreVersion=this._wallabyCoreVersion(),this._updating||r.coreClient||(clearTimeout(this._updateChecker),this._performUpdate(r,!1)))},statusBar:this._statusBar,onFirstStart:()=>{clearTimeout(this._updateChecker),this._performUpdate(r,!1)},licenseChanged:({wasRunning:e,hasEverStartedOnOpenedProject:t,newKey:a,start:s,stop:o})=>i(this,void 0,void 0,function*(){this._updatingAfterLicenseChange=!0;let n=!1;const l=r.coreVersion;this._readVersionManifestAndRefreshCoreLocation(),l!==this._wallabyCoreVersion()&&e&&(o(),n=!0);const c=()=>i(this,void 0,void 0,function*(){const e=r.updateAvailable;try{r.updateAvailable=(()=>{}),clearTimeout(this._updateChecker),yield this._performUpdate(r,!1),this._readVersionManifestAndRefreshCoreLocation(),r.coreClient=this._reloadCoreClient(),r.coreVersion=this._wallabyCoreVersion()}finally{r.updateAvailable=e}});e?a.freeLicense?(o(),n=!0,yield c()):(r.onCoreDownload=(()=>{o(),n=!0}),yield c(),delete r.onCoreDownload):yield c(),delete this._updatingAfterLicenseChange,(n||!e&&t)&&s()}),readyForUse:()=>{},updateAvailable:()=>{},forceCoreUpdate:()=>{m._isDebugMode()||m._noAutomaticInstallMode()?c.showErrorMessage("Force core update is not available when 'wallaby.noAutomaticInstall' is 'true'."):(c.showInformationMessage("Downloading Wallaby.js core. Depending on the speed of your internet connection this may take a few moments."),clearTimeout(this._updateChecker),this._performUpdate(r,!0))},debug:m._isDebugMode(),licensed:!1,isMac:h,firstInstall:a,deactivate:()=>this.deactivate(),version:m._getVsCodeVersion(),coreVersion:this._wallabyCoreVersion()};try{const t=e("./lib/controller");this._controller=new t(r),this._controller.activate(),this._disposables.add(()=>this._controller.deactivate())}catch(e){m._notifyError(e.message)}try{yield this._updateIfRequired(!0,void 0,!1,!0,void 0),r.coreClient||r.reloadCoreClient(),console.log("[Wallaby Console] VS Code extension v"+p),console.log("[Wallaby Console] Core v"+r.coreVersion),this._hideStatusIndicator(),r.readyForUse()}catch(e){m._notifyError(e.message)}finally{this._hideStatusIndicator(),this._updating=!1}}))})}_wallabyCoreVersion(){try{return m._requireNoCache(this._corePackage).version}catch(e){return"0.0.0"}}_addNewVersionToManifest(e,t){let a;try{a=JSON.parse(s.readFileSync(this._coreVersionManifest).toString());const e=(new Date).getTime();Object.keys(a).forEach(i=>{!a[i].invalidated&&a[i].releaseDate<=t&&(a[i].invalidated=e)})}catch(e){a={}}a[e]={releaseDate:t,invalidated:!1,expiry:{}},this._readVersionManifestAndRefreshCoreLocation(a,!0)}_readVersionManifestAndRefreshCoreLocation(e,t){var a;if(m._noAutomaticInstallMode())return void(this._corePackage=o.join(__dirname,"..","wallaby","package.json"));if(!e)try{e=JSON.parse(s.readFileSync(this._coreVersionManifest).toString())}catch(a){try{if(!s.existsSync(this._corePackage))return;{m._requireNoCache(this._corePackage).version;const a=s.statSync(this._corePackage).mtime.getTime();t=!0,e={"":{releaseDate:a,invalidated:!1,expiry:{}}}}}catch(e){return}}const i=null===(a=this._expiryDate())||void 0===a?void 0:a.getTime(),n=Object.keys(e).map(t=>Object.assign({id:t,folder:o.join(__dirname,"..","wallaby"+t)},e[t])).sort((e,t)=>t.releaseDate-e.releaseDate),r=(new Date).getTime()-72e5;n.forEach(a=>{s.existsSync(a.folder)?a.invalidated&&0===Object.keys(a.expiry).length&&a.invalidated<r&&(t=!0,delete e[a.id],m._remove(a.folder,!0)):(t=!0,delete e[a.id])});const l=n.filter(t=>(!i||t.releaseDate<i)&&e[t.id]);if(l.length){if(i&&i<(new Date).getTime()&&!e[l[0].id].expiry[i]){e[l[0].id].expiry[i]=!0;for(let t=1;t<l.length;t++)delete e[l[t].id].expiry[i];t=!0}const a=(l.find(e=>!e.invalidated)||l[0]).id;this._corePackage=o.join(__dirname,"..","wallaby"+a,"package.json")}else this._corePackage=o.join(__dirname,"..","wallaby_missing","package.json");return this._coreFolder=o.dirname(this._corePackage),t&&s.writeFileSync(this._coreVersionManifest,JSON.stringify(e)),e}_initializeDownloadSettings(){try{const e=r.workspace.getConfiguration();if(e){const t=e.get("http.proxy","");t&&(process.env.http_proxy=t);const a=e.get("https.proxy","");a&&(process.env.https_proxy=a)}}catch(e){}try{r.workspace.getConfiguration()&&(r.workspace.getConfiguration().get("wallaby.useHttpForDownload",!1)&&(this.protocol="http"),r.workspace.getConfiguration().get("wallaby.strictSSL",!0)||(this.strictSSL=!1))}catch(e){}}_updateGutterIndicatorForType(e,t,a,i){const r=e.asAbsolutePath(o.join("images",(i?"last.":"")+t+".svg"));if(!s.existsSync(r))return;const l=(~t.indexOf("snapshot")?'<svg width="16px" height="16px" xmlns="http://www.w3.org/2000/svg"'+n.EOL+'     viewBox="0 0 16 16">'+n.EOL+'  <path fill="#62b455"'+(i?' style="fill-opacity:0;stroke:#ffa0a0;stroke-width:1"':"")+n.EOL+'        d="m 13.5,5.25 v 7.071429 C 13.5,12.972098 13.038098,13.5 12.46875,13.5 H 3.53125 C 2.9619018,13.5 2.5,12.972098 2.5,12.321429 V 5.25 C 2.5,4.5993304 2.9619018,4.0714286 3.53125,4.0714286 H 5.421875 L 5.6861206,3.2636161 C 5.8365357,2.8044643 6.2210937,2.5 6.6507812,2.5 h 2.6962772 c 0.4296873,0 0.8142946,0.3044643 0.9646606,0.7636161 l 0.266406,0.8078125 H 12.46875 C 13.038098,4.0714286 13.5,4.5993304 13.5,5.25 Z M 10.578125,8.7857143 C 10.578125,7.1602674 9.4222908,5.8392857 8,5.8392857 c -1.4222411,0 -2.578125,1.3209817 -2.578125,2.9464286 0,1.6254467 1.1558839,2.9464277 2.578125,2.9464277 1.4222908,0 2.578125,-1.320981 2.578125,-2.9464277 z m -0.6875,0 c 0,1.190849 -0.8486201,2.1607147 -1.890625,2.1607147 -1.0420044,0 -1.890625,-0.9698657 -1.890625,-2.1607147 0,-1.1908487 0.8486206,-2.1607148 1.890625,-2.1607148 1.0420049,0 1.890625,0.9698661 1.890625,2.1607148 z"></path>'+n.EOL+"</svg>":'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="16px" height="16px">'+n.EOL+"  <g>"+n.EOL+'    <rect x="2.5" y="2.5" width="11" height="11" rx="2.5" ry="2.5" style="'+(i?"fill:#62b455;fill-opacity:0;stroke:#62b455;stroke-width:1":"fill:#62b455;fill-opacity:1;")+'" />'+n.EOL+"  </g>"+n.EOL+"</svg>").replace(/fill:#.[^;]*/,"fill:"+a[t]).replace(/fill="#.[^"]*/,'fill="'+a[t]).replace(/stroke:#.[^;]*/,"stroke:"+a[t]).replace(/stroke="#.[^"]*/,'stroke="'+a[t]),c=s.readFileSync(r).toString();l.replace(/\r/g,"")!==c.replace(/\r/g,"")&&s.writeFileSync(r,l)}_initializeImages(e){try{const t=r.workspace.getConfiguration();if(t){const a=t.get("wallaby.colors",{});a&&Object.keys(a).forEach(t=>{try{if(!t)return;this._updateGutterIndicatorForType(e,t,a,!1),this._updateGutterIndicatorForType(e,t,a,!0)}catch(e){console.error("Failed to set icon "+t+" type to "+a[t]+". "+e.message)}})}}catch(e){}}_reloadCoreClient(){Object.keys(originalRequire.cache).forEach(e=>{const t=originalRequire.cache[e];t.filename&&~t.filename.indexOf(this._coreFolder+o.sep)&&delete originalRequire.cache[e]});try{return originalRequire(o.join(this._coreFolder,"client"))}catch(e){return}}_performUpdate(e,t){return i(this,void 0,void 0,function*(){try{if(this._updating=!0,yield this._updateIfRequired(!1,e.licensed,t,!1,e.onCoreDownload))try{delete this._failedUpdateCount,this.showUpdateNotifications()&&c.showInformationMessage(`Wallaby.js core has been successfully updated to v${m._requireNoCache(this._corePackage).version}.`),e.updateAvailable(t)}catch(e){console.error(e)}}catch(e){this._failedUpdateCount=this._failedUpdateCount?this._failedUpdateCount+1:1,t&&m._notifyError(e.message),console.error(e)}finally{if(this._failedUpdateCount&&this._failedUpdateCount>3)return;this._updateChecker=setTimeout(()=>this._performUpdate(e,!1),u),this._updating=!1}})}_updateIfRequired(e,t,a,r,l){return i(this,void 0,void 0,function*(){let i=!1;const d=this._expiryDateString();let h=this._baseUrl;const u=e=>this._download({name:"version",from:`${e}wallaby.json?licensed=${t?"true":"false"}${d?"&expiry="+d.replace(/\//g,"-"):""}`,to:this._versionFile});let p=!a&&(yield m._stat(this._corePackage));const g=o.join(n.homedir(),".wallaby","downloads","wallaby.zip");if(!p&&!a&&s.existsSync(g))try{yield this._extract(g,this._coreFolder),p=s.statSync(this._corePackage),r||(i=!0)}catch(e){console.error(e)}let y;if(m._isDebugMode()||m._noAutomaticInstallMode()||e&&p)y={core:p&&m._requireNoCache(this._corePackage).version||"unknown"};else{this._statusUpdater("Downloading wallaby.js version file");try{yield u(this._baseUrl)}catch(e){h=`${this.protocol}://s3.amazonaws.com/wallaby-downloads/`,yield u("http://update.wallabyjs.com/")}y=this._version()}let _=!0;if((m._isDebugMode()||m._noAutomaticInstallMode())&&!p)throw new Error("With wallaby.noAutomaticInstall option set, you need to manually install wallaby core and dependencies when the extension is installed/updated.");if(!p||m._requireNoCache(this._corePackage).version!==y.core){this._statusUpdater("Downloading and extracting wallaby.js core"),_=!1,l&&l();try{i=yield this._downloadZip({name:"core",from:`${h}wallaby-v${y.core}.zip`})}catch(e){i=yield this._downloadZip({name:"core",from:`${this.protocol}://s3.amazonaws.com/wallaby-downloads/wallaby-v${y.core}.zip`})}}return e&&!_&&this.showUpdateNotifications()&&c.showInformationMessage(`Wallaby.js core v${y.core} has been successfully installed.`),i})}static _isDebugMode(){return d.getConfiguration()&&d.getConfiguration().get("wallaby.debug",!1)}static _noAutomaticInstallMode(){return d.getConfiguration()&&d.getConfiguration().get("wallaby.noAutomaticInstall",!1)}_version(){let e;return m._requireNoCache(this._versionFile).latestServer.forEach(t=>{t.substring(0,t.lastIndexOf("."))===p.substring(0,t.lastIndexOf("."))&&(e=t)}),{core:e}}static _requireNoCache(e){return delete originalRequire.cache[originalRequire.resolve(e)],originalRequire(e)}static _stat(e){try{return s.statSync(e)}catch(e){return!1}}static _remove(t,a){return i(this,void 0,void 0,function*(){try{yield new Promise((a,i)=>{e("fs-extra").remove(t,(e,t)=>{e?i(e):a()})})}catch(e){if(a)throw e;yield m._remove(t,!0)}})}_downloadZip(e){return i(this,void 0,void 0,function*(){s.existsSync(o.join(n.homedir(),".wallaby"))||s.mkdirSync(o.join(n.homedir(),".wallaby")),s.existsSync(o.join(n.homedir(),".wallaby","downloads"))||s.mkdirSync(o.join(n.homedir(),".wallaby","downloads"));const t=o.join(n.homedir(),".wallaby","downloads","wallaby.zip"),a=yield this._baseDownload(e.from,e.name,t,2e6);try{yield this._extract(t,e.to)}catch(t){throw new Error(`Error while unzipping wallaby.js ${e.name} file: ${t.message}`)}return a})}_download(e){return i(this,void 0,void 0,function*(){return yield this._baseDownload(e.from,e.name,e.to)})}_baseDownload(t,a,o,n){let l=!1;const c=()=>!l&&(l=!0),d="This may occur when you are behind proxy. Try setting VS Code's 'Http: Proxy' settings to fix the problem.";return new Promise((l,h)=>i(this,void 0,void 0,function*(){try{const u=e("node-fetch"),p={headers:{"User-Agent":"VS Code "+r.version}};if(t.startsWith("https:")){const t=e("https");!1===this.strictSSL&&(p.agent=new t.Agent({rejectUnauthorized:!1}))}const g=yield u(t,p);if(!g.ok||200!==g.status)throw new Error(`Error while downloading wallaby.js ${a}, status code: ${g.status}. ${d}`);if(n&&g.headers["content-length"]&&parseInt(g.headers["content-length"],10)<n)throw new new Error(`Error while downloading wallaby.js ${a}, file is corrupt. ${d}`);{const e=yield g.buffer();s.writeFileSync(o,e),c()&&l(o)}}catch(u){console.error("node-fetch Wallaby download failed:"),console.error(u);const p=e("request");try{p({url:t,headers:{"User-Agent":"VS Code "+r.version},strictSSL:this.strictSSL}).on("response",e=>{n&&e&&e.headers&&e.headers["content-length"]&&parseInt(e.headers["content-length"],10)<n&&c()&&h(new Error(`Error while downloading wallaby.js ${a}, file is corrupt. ${d}`)),e&&200!==e.statusCode&&c()&&h(new Error(`Error while downloading wallaby.js ${a}, status code: ${e.statusCode}. ${d}`))}).pipe(s.createWriteStream(o)).on("error",e=>c()&&h(new Error(`Error while downloading wallaby.js ${a} file, ${e.message}. ${d}`))).on("close",()=>i(this,void 0,void 0,function*(){return c()&&l(o)}))}catch(e){c()&&h(e)}}}))}_extract(t,a){return i(this,void 0,void 0,function*(){const a=new(e("adm-zip-mit"))(t),i=new Date(a.getEntry("package.json").header.time);i.setMinutes(i.getMinutes()-i.getTimezoneOffset());const n=JSON.parse(a.readAsText("package.json")).version,[r,l,c]=n.split(".").map(e=>parseInt(e)),d=e("crypto");if(r>1||l>0||c>1091){const e="-----BEGIN RSA PUBLIC KEY-----\nMIIBCgKCAQEAngwMnSkF1zlHJggr7kXXO02ytYIlzMdvQxHu6hli+TFIeO72HNfK\nP27g+f8EtlPRB0UwnpAHtkJHNCdwpo04eU8hS8g9vbmNf00luUJGuUHnf62Pp0EI\nKbGKJvzkdPgfs62MItfi4uf+XiHa8rN0Bk7hRbddI1zA4Wupf/E0wZ7UorgCE9XB\nEM6VULphGdHorpmHBW5deeCHIledtMOpOfDSM5lvjiqgVqmjNYT+WXCwjN8yCcyU\noedY3afSHTyqiuInKcpXd+VJQb2+d7y583Pb3+kDGraBMGFJaWGewm7+IYIlgk5C\nuk54FsjCvwvaa0SKr2rkIBKuyFX3ZGymyQIDAQAB\n-----END RSA PUBLIC KEY-----",t=a.getEntries();t.sort((e,t)=>e.entryName.localeCompare(t.entryName));const i=a.readAsText("signature.txt"),s=d.createVerify("RSA-SHA512");if(t.forEach(e=>{"signature.txt"!==e.entryName&&s.update(e.getData())}),!s.verify(e,Buffer.from(i,"base64")))throw new Error("could not verify core version")}let h=d.randomBytes(3).toString("hex");for(;s.existsSync(o.join(__dirname,"..","wallaby"+h));)h=d.randomBytes(3).toString("hex");const u=o.join(__dirname,"..","wallaby"+h);yield new Promise((e,t)=>{a.extractAllToAsync(u,!0,a=>{a?t(a):e()})}),this._addNewVersionToManifest(h,i.getTime())})}static _notifyError(e){c.showErrorMessage(e)}_setupStatusIndicator(){this._wallabyStartPage=c.createStatusBarItem(r.StatusBarAlignment.Left,-1e13),this._wallabyStartPage.text="Wallaby",this._wallabyStartPage.tooltip="Wallaby (click to open start view)",this._wallabyStartPage.command="wallaby.openStartView",this._wallabyStartPage.show(),r.workspace.getConfiguration().get("wallaby.startViewStatusBar",!0)||this._wallabyStartPage.hide(),r.workspace.onDidChangeConfiguration(e=>{r.workspace.getConfiguration().get("wallaby.startViewStatusBar",!0)?this._wallabyStartPage.show():this._wallabyStartPage.hide()}),this._statusBar=c.createStatusBarItem(r.StatusBarAlignment.Right,-1e13),this._statusBar.show();const e=this._statusBar.hide.bind(this._statusBar),t=this._statusBar.dispose.bind(this._statusBar);this._statusBar.hide=(()=>{this._statusBar.stopProgress(),this._statusBar._mainText="",this._statusBar._extensionText="",this._statusBar.text="",this._statusBar.tooltip="",e()}),this._statusBar.dispose=(()=>{this._statusBar.stopProgress(),t()}),this._statusBar.displayProgress=(()=>{let e=0;const t=["[=--------]","[-=-------]","[--=------]","[---=-----]","[----=----]","[-----=---]","[------=--]","[-------=-]","[--------=]","[-------=-]","[------=--]","[-----=---]","[----=----]","[---=-----]","[--=------]","[-=-------]"];clearInterval(this._statusBar._progress),this._statusBar._progress=setInterval(()=>{this._statusBar.setMainText(`${t[e=++e%t.length]}   `),this._statusBar._doUpdateText()},150)}),this._statusBar.setMainText=(e=>{this._statusBar._mainText=e}),this._statusBar.setExtensionText=(e=>{this._statusBar._extensionText=e}),this._statusBar.updateText=(()=>this._statusBar._doUpdateText()),this._statusBar._doUpdateText=(()=>{this._statusBar.text=`${this._statusBar._extensionText||""}   ${this._statusBar._mainText||""}`}),this._statusBar.stopProgress=(()=>{clearInterval(this._statusBar._progress),delete this._statusBar._progress}),this._statusBar.isDisplayingProgress=(()=>!!this._statusBar._progress),this._statusBar.displayProgress(),this._statusUpdater=(e=>{this._statusBar.tooltip=e}),this._disposables.add(()=>{this._removeStatusIndicator()}),this._statusBar.hide()}_expiryDate(){try{const[e,t,a]=this._expiryDateString().split("/");return new Date(Date.UTC(parseInt(a,10),parseInt(t,10)-1,parseInt(e,10)))}catch(e){}}_expiryDateString(){try{const t=e=>e&&e.replace(/^\s+|\s+$/gm,"");let a=e("fs").readFileSync(this._lkp).toString();if(a){const e=a.split(":");2===e.length&&(a=t(e[1]))}return Buffer.from(a,"base64").toString().split("\n")[2]}catch(e){}}static _getVsCodeVersion(){try{const[e,t]=r.version.split(".");return{major:parseInt(e,10),minor:parseInt(t,10)}}catch(e){return{major:1,minor:0}}}_hideStatusIndicator(){this._statusBar&&this._statusBar.hide(),this._statusUpdater=(()=>{})}_removeStatusIndicator(){this._statusBar&&this._statusBar.dispose(),this._statusUpdater=(()=>{})}deactivate(){this._disposed||(this._disposables.dispose(),this._disposed=!0)}showUpdateNotifications(){return r.workspace.getConfiguration().get("wallaby.showUpdateNotifications",!0)}}a.activate=(e=>{(new m).activate(e)})},{"./lib/compositeDisposable":3,"./lib/controller":4,"./lib/startViewPanel":7,"./package.json":14,"adm-zip-mit":void 0,crypto:void 0,fs:void 0,"fs-extra":void 0,https:void 0,"node-fetch":void 0,os:void 0,path:void 0,request:void 0,vscode:void 0}],2:[function(e,t,a){"use strict";const i=e("vscode"),s=e("path");a.activate=function(t){const a=i.workspace.getConfiguration()&&i.workspace.getConfiguration().get("wallaby.debug",!1);return a&&(global.originalRequire=e),a||"dist"===s.basename(__dirname)?e("./extension").activate(t):(global.originalRequire=e,e("./dist/index").activate(t))}},{"./extension":1,path:void 0,vscode:void 0}],3:[function(e,t,a){"use strict";t.exports=class{constructor(){this._disposables=[]}add(e){e.dispose?this._disposables.push(e):this._disposables.push({dispose:e})}dispose(){this._disposables.forEach(e=>e.dispose())}}},{}],4:[function(e,t,a){"use strict";var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const s=e("path"),o=e("crypto"),n=e("fs-extra"),r=e("os"),l=e("vscode"),c=e("events"),d=e("lodash"),h=e("./compositeDisposable"),u=e("./screenshotContentProvider"),p=e("./testTimelineContentProvider"),g=e("./testsOutputBuilder"),m=e("./valueExplorer"),y=e("./traceExplorer"),_=e("./testFileCoverageExplorer"),w=e("./startViewPanel"),b=e("./outputInspector"),f=e("./tutorial"),v=l.workspace,T=l.window,x="wallaby-tests",S="wallaby-console",C=300,k="‌",D="‍",E="wallaby.showCommandPalette",P={info:"​",error:"​​"};let F=1;const O={"wallaby.start":{visible:!0},"wallaby.stop":{visible:!0},"wallaby.startExclusively":{visible:!0},"wallaby.showCommandPalette":{visible:!1},"wallaby.showLastScreenshot":{visible:!0},"wallaby.showLicense":{visible:!0},"wallaby.runProjectTests":{visible:!0},"wallaby.runLineTests":{visible:!0},"wallaby.runFileTests":{visible:!0},"wallaby.updateProjectSnapshots":{visible:!0},"wallaby.updateFileSnapshots":{visible:!0},"wallaby.updateTestSnapshots":{visible:!0},"wallaby.jumpToFailingTest":{visible:!0},"wallaby.jumpToLineTest":{visible:!0},"wallaby.jumpToErrorSource":{visible:!0},"wallaby.toggleUncovered":{visible:!0},"wallaby.toggleTestFilter":{visible:!0},"wallaby.showLineTests":{visible:!0},"wallaby.showLineTestsFromMenu":{visible:!1},"wallaby.selectConfigFile":{visible:!0},"wallaby.startOnClosestMonoRepoProject":{visible:!1},"wallaby.showFailingTests":{visible:!0},"wallaby.showSideBySideDiff":{visible:!0},"wallaby.openWallabyApp":{visible:!0},"wallaby.showValue":{visible:!0},"wallaby.copyValue":{visible:!0},"wallaby.copyExpressionPath":{visible:!1},"wallaby.copyExpressionData":{visible:!1},"wallaby.goToExpressionSource":{visible:!1},"wallaby.copyDiagnosticsReportToClipboard":{visible:!0},"wallaby.runModeOnSave":{visible:!0},"wallaby.runModeImmediate":{visible:!0},"wallaby.runModeToggle":{visible:!0},"wallaby.forceCoreUpdate":{visible:!0},"wallaby.resetTestFilter":{visible:!1},"wallaby.resetUncovered":{visible:!1},"wallaby.playTraceNextStep":{visible:!1},"wallaby.playTracePrevStep":{visible:!1},"wallaby.playTraceNextStepOut":{visible:!1},"wallaby.playTracePrevStepOut":{visible:!1},"wallaby.playTraceNextStepOver":{visible:!1},"wallaby.playTracePrevStepOver":{visible:!1},"wallaby.playTraceForwardToSelection":{visible:!1},"wallaby.playTraceBackwardToSelection":{visible:!1},"wallaby.playTraceForwardToBreakpoint":{visible:!1},"wallaby.playTraceBackwardToBreakpoint":{visible:!1},"wallaby.openCallStackFrame":{visible:!1},"wallaby.revealTraceStep":{visible:!1},"wallaby.stopTraceNavigation":{visible:!1},"wallaby.statusBarCommand":{visible:!1},"wallaby.debugTest":{visible:!0},"wallaby.profileTest":{visible:!0},"wallaby.showTestStory":{visible:!0},"wallaby.showTestStoryBeside":{visible:!0},"wallaby.jumpToTest":{visible:!0},"wallaby.searchTests":{visible:!0},"wallaby.openFile":{visible:!1},"wallaby.addToExclusiveTestRun":{visible:!0},"wallaby.addToExclusiveTestRunFromMenu":{visible:!1},"wallaby.startExclusivelyFromMenu":{visible:!1},"wallaby.selectAsConfigurationAndStart":{visible:!1},"wallaby.revealValue":{visible:!0},"wallaby.lockTestStory":{visible:!1},"wallaby.unlockTestStory":{visible:!1},"wallaby.navigate":{visible:!1},"wallaby.clearValue":{visible:!0},"wallaby.clearFileValues":{visible:!0},"wallaby.clearAllValues":{visible:!0},"wallaby.openStartView":{visible:!1},"wallaby.showError":{visible:!0},"wallaby.closeInspector":{visible:!1},"wallaby.deleteInspection":{visible:!1},"wallaby.jumpToSnapshot":{visible:!1},"wallaby.toggleInspectorFocus":{visible:!1},"wallaby.inspectValue":{visible:!1},"wallaby.suppressShowingInspectorDocHeader":{visible:!1},"wallaby.openTutorial":{visible:!0},"wallaby.openSampleProject":{visible:!0},"wallaby.resetCache":{visible:!1},"wallaby.testingMenuGoToTest":{visible:!1},"wallaby.testingMenuDebug":{visible:!1},"wallaby.testingMenuRunTest":{visible:!1},"wallaby.testingMenuProfile":{visible:!1},"wallaby.testingMenuViewStory":{visible:!1},"wallaby.testingMenuGoToError":{visible:!1},"wallaby.testingMenuUpdateSnapshot":{visible:!1},"wallaby.testingMenuGoToFile":{visible:!1},"wallaby.testingMenuRunFileTests":{visible:!1}},L={"wallaby.feature.diagnostics":{version:[1,0,735],enabled:!0},"wallaby.feature.debugger":{version:[1,0,799],enabled:!0},"wallaby.feature.debugger.breakpoints":{version:[1,0,1010],enabled:!0},"wallaby.feature.profiler":{version:[1,0,1004],enabled:!0},"wallaby.feature.testStory":{version:[1,0,899],enabled:!0},"wallaby.feature.exclusiveTestRun":{version:[1,0,865],enabled:!0},"wallaby.feature.testFilters":{version:[1,0,778],enabled:!0},"wallaby.feature.trackableValues":{version:[1,0,1005],enabled:!0},"wallaby.feature.inspections":{version:[1,0,1055],enabled:!0},"wallaby.feature.testExplorer":{version:[1,0,1127],enabled:!0}};class j extends c.EventEmitter{constructor(e){super();const t=this;this._state=e,this._context=e.context,this._statusBar=e.statusBar,this._reloadCoreClient=e.reloadCoreClient;const a=t=>{if(e&&e.coreClient)return t(e.coreClient)};this._tryGetSession=(()=>a(e=>e.Session)),this._tryGetUtils=(()=>a(e=>e.utils)),this._tryGetDmp=(()=>a(e=>e.dmp)),this._isMac=e.isMac,this._firstInstall=e.firstInstall,this._deactivator=e.deactivate,this._lineAndColumnLinks=!1,this._activeLicenseSession=null,this._coreVersion=e.coreVersion,this._setFeatureContext(),e.updateAvailable=d.bind(this._updateAvailable,this),e.readyForUse=d.bind(this._readyForUse,this),this._disposables=new h,d.each(O,(e,a)=>t._disposables.add(l.commands.registerCommand(a,(...e)=>t[a.substring(8,a.length)](...e)))),this._activeTraceFrameWithNowhereToGoDecorationType=T.createTextEditorDecorationType({rangeBehavior:1,borderStyle:"solid",borderRadius:"2px",borderWidth:"1px",dark:{backgroundColor:"rgba(255, 0, 0, 0.2)",borderColor:"rgba(255, 0, 0, 0.2)"},light:{backgroundColor:"rgba(255, 0, 52, 0.35)",borderColor:"rgba(255, 0, 52, 0.35)"}}),this._activeTraceFrameDecorationType=T.createTextEditorDecorationType({rangeBehavior:1,borderStyle:"solid",borderRadius:"2px",borderWidth:"1px",dark:{backgroundColor:"rgba(255, 255, 0, 0.2)",borderColor:"rgba(255, 255, 0, 0.2)"},light:{backgroundColor:"rgba(255, 255, 102, 0.45)",borderColor:"rgba(255, 255, 102, 0.45)"}});const i={rangeBehavior:1,borderStyle:"solid",borderRadius:"2px",borderWidth:"1px",dark:{backgroundColor:"rgba(122, 189, 122, 0.3)",borderColor:"rgba(122, 189, 122, 0.3)"},light:{backgroundColor:"rgba(206, 231, 206, 0.45)",borderColor:"rgba(206, 231, 206, 0.45)"}};this._activeTraceCallStackFrameDecorationType=T.createTextEditorDecorationType(i),this._activeValueCallStackFrameDecorationType=T.createTextEditorDecorationType(i);const o=new l.ThemeColor("editorCodeLens.foreground"),n=o,r=o;this._coverageDecorationTypes={0:this._createGutterDecorationType("errorSource",!1,!1),1:this._createGutterDecorationType("notCovered",!1,!1),2:this._createGutterDecorationType("covered",!1,!1),3:this._createGutterDecorationType("partiallyCovered",!1,!1),4:this._createGutterDecorationType("errorSource",!1,!1),5:this._createGutterDecorationType("errorPath",!1,!1),100:this._createGutterDecorationType("errorSource",!0,!1),101:this._createGutterDecorationType("notCovered",!0,!1),102:this._createGutterDecorationType("covered",!0,!1),103:this._createGutterDecorationType("partiallyCovered",!0,!1),104:this._createGutterDecorationType("errorSource",!0,!1),105:this._createGutterDecorationType("errorPath",!0,!1),1000:this._createGutterDecorationType("errorSource",!1,!0),1001:this._createGutterDecorationType("notCovered",!1,!0),1002:this._createGutterDecorationType("covered",!1,!0),1003:this._createGutterDecorationType("partiallyCovered",!1,!0),1004:this._createGutterDecorationType("errorSource",!1,!0),1005:this._createGutterDecorationType("errorPath",!1,!0),1100:this._createGutterDecorationType("errorSource",!0,!0),1101:this._createGutterDecorationType("notCovered",!0,!0),1102:this._createGutterDecorationType("covered",!0,!0),1103:this._createGutterDecorationType("partiallyCovered",!0,!0),1104:this._createGutterDecorationType("errorSource",!0,!0),1105:this._createGutterDecorationType("errorPath",!0,!0),userLog:this._createInlineHoverDecorationType("#0000ff","rgba(86, 156, 214, 1)"),systemLog:this._createInlineHoverDecorationType(n,r),error:this._createInlineHoverDecorationType("#c80000","#fe536a")},this._testsOutputDocumentSelector={language:x},this._consoleOutputDocumentSelector={language:S},this._setupVersionSpecificComponents(e.version),this._uncoveredRegionDecorationType=T.createTextEditorDecorationType({backgroundColor:"#d2a032",color:"#ffffff"}),this._testsOutputChannel=T.createOutputChannel("Wallaby.js Tests"),this._consoleOutputChannel=T.createOutputChannel("Wallaby.js Console"),this._testsOutputChannel.append(k),this._consoleOutputChannel.append(D);let c=d.bind(t._absoluteFilePath,t);this._failingTestsOutput=new g(this._testsOutputChannel,c,this._tryGetDmp,this._disposables,this._lineAndColumnLinks,!0,this._testsOutputDocumentSelector,this._sideBySideDiffSupported,d.bind(this._getWallabyAppUrl,this),k,d.bind(this._isInExperimentalMode,this)),this._lineTestsOutput=new g(this._testsOutputChannel,c,this._tryGetDmp,this._disposables,this._lineAndColumnLinks,void 0,this._testsOutputDocumentSelector,this._sideBySideDiffSupported,d.bind(this._getWallabyAppUrl,this),k,d.bind(this._isInExperimentalMode,this)),l.workspace.registerTextDocumentContentProvider&&(t._screenshotProvider=new u(()=>s.join(t._session.projectCachePath,"instrumented","screen.png")),t._testTimelineContentProvider=new p(c),t._disposables.add(l.workspace.registerTextDocumentContentProvider("wallaby-screenshot",t._screenshotProvider)),t._disposables.add(l.workspace.registerTextDocumentContentProvider("wallaby-test-timeline",t._testTimelineContentProvider)),t._disposables.add(l.workspace.registerTextDocumentContentProvider("wallaby-diff",{provideTextDocumentContent:e=>Buffer.from(e.query.toString(),"base64").toString()})));const b=new l.CodeAction("Debug test",l.CodeActionKind.Empty),f=new l.CodeAction("Open test story",l.CodeActionKind.Empty),v=new l.CodeAction("Add test to filter",l.CodeActionKind.Empty),C=new l.CodeAction("Remove test from filter",l.CodeActionKind.Empty),E=new l.CodeAction("Reveal in Value Explorer",l.CodeActionKind.Empty),P=new l.CodeAction("Show assertion diff",l.CodeActionKind.Empty),F=new l.CodeAction("Update test snapshots",l.CodeActionKind.Empty),j=new l.CodeAction("Show value",l.CodeActionKind.Empty),I=new l.CodeAction("Clear value",l.CodeActionKind.Empty),N=new l.CodeAction("Jump to error source",l.CodeActionKind.Empty),A=new l.CodeAction("Show error",l.CodeActionKind.Empty),R=new l.CodeAction("Show in Output Inspector",l.CodeActionKind.Empty);b.command={command:"wallaby.debugTest",title:""},v.command=C.command={command:"wallaby.toggleTestFilter",title:""},f.command={command:"wallaby.showTestStory",title:""},E.command={command:"wallaby.revealValue",title:""},P.command={command:"wallaby.showSideBySideDiff",title:""},F.command={command:"wallaby.updateTestSnapshots",title:""},j.command={command:"wallaby.showValue",title:""},I.command={command:"wallaby.clearValue",title:""},N.command={command:"wallaby.jumpToErrorSource",title:""},A.command={command:"wallaby.showError",title:""},R.command={command:"wallaby.inspectValue",title:""},this._onDidUpdateDocuments=new l.EventEmitter;const M=["javascript","javascriptreact","typescript","typescriptreact","coffeescript","vue"];this._disposables.add(l.languages.registerCodeActionsProvider(M,{provideCodeActions:(e,a)=>{if(t._session){const i=t._getDocumentFilePath(e),s=t._session.openedDocuments[i];if(s&&(!s.changeTs||s.changeTs<s.updateTs)){if(s.testDeclarations){const e=s.testDeclarations[a.end.line];if(e){if(this._traceExplorer.traceBeingNavigated())return[];{const t=[b,f,e.filtered?C:v];return e.snap&&t.push(F),t}}}const e=[],t=T.activeTextEditor;if(t){const a=t.selection;a&&a.start.line===a.end.line&&a.start.character!==a.end.character&&e.push(j)}if(s.messages&&s.messages[a.end.line]){const t=s.messages[a.end.line];t&&(L["wallaby.feature.inspections"].enabled&&(this._inspectorActive&&!t.inspected||!this._inspectorActive)&&e.push(R),e.push(E),t.removable&&L["wallaby.feature.trackableValues"].enabled&&e.push(I))}if(s.errors){const t=s.errors[a.end.line];t&&(L["wallaby.feature.inspections"].enabled&&e.push(A),t.diff&&e.push(P),t.snap&&e.push(F),t.source||e.push(N))}return e}}return[]}},{providedCodeActionKinds:[l.CodeActionKind.Empty]})),this._disposables.add(l.languages.registerHoverProvider(M,{provideHover(e,a){const i=t._stats&&t._stats.failingNumber,s=t._getDocumentFilePath(e),o=a.line+1,n=t._session&&((t._session.openedDocuments[s]||{}).testMatchSnapshotCalls||{})[a.line],r=e=>{if(!t._session)return e();t._session.requestSnapshot({file:s,line:o,type:"content"},a=>a&&a.name?e(t._createHover(`\`\`\`\nSnapshot name: \`${a.name}\` \n${a.content}\n\`\`\``)):e())};if(i||n)return new Promise(a=>t._session?i?void t._session.requestError({file:t._getDocumentFilePath(e),line:o,type:"errorSource",includeErrorExtendedDetails:!0},e=>e&&e.error?a(t._createHover(t._failingTestsOutput.createErrorMarkdown(e.error,{file:s,line:o}))):n?r(a):a()):r(a):a())}})),this._disposables.add(l.languages.registerDefinitionProvider(M,{provideDefinition(e,a){const i=t._getDocumentFilePath(e),s=a.line+1;if(t._session&&((t._session.openedDocuments[i]||{}).testMatchSnapshotCalls||{})[a.line])return new Promise(e=>{if(!t._session)return e();t._session.requestSnapshot({file:i,line:s,type:"location"},a=>{if(!a||!a.name)return e();const i=parseInt(a.loc,10)-1;return i>=0?e(new l.Location(l.Uri.file(t._absoluteFilePath(a.file)),new l.Position(i,0))):e()})})}})),this._disposables.add(l.languages.registerCodeLensProvider(M,{onDidChangeCodeLenses:this._onDidUpdateDocuments.event,provideCodeLenses(e){if(!t._codeLensEnabled)return[];const a=(a,i)=>{const s=[];if(a.testDeclarations)return d.each(a.testDeclarations,(a,o)=>{if(a)try{o=parseInt(o,10);const n=e.lineAt(o),r=new l.Range(n.lineNumber,n.firstNonWhitespaceCharacterIndex+2,n.lineNumber,n.range.end.character);t._codeLensRunTestEnabled&&!a.debugged&&s.push(new l.CodeLens(r,{title:"Run",tooltip:"Run Test",command:"wallaby.runLineTests",arguments:[n.lineNumber+1]})),L["wallaby.feature.debugger"].enabled&&t._codeLensDebuggerEnabled&&s.push(new l.CodeLens(r,{title:a.debugged?"Stop debugger":"Debug",tooltip:a.debugged?"Stop debugger":"Debug",command:a.debugged?"wallaby.stopTraceNavigation":"wallaby.debugTest",arguments:[n.lineNumber+1]})),L["wallaby.feature.testStory"].enabled&&t._codeLensTestStoryEnabled&&(a.debugged&&i||s.push(new l.CodeLens(r,{title:"View story",tooltip:"View story",command:"wallaby.showTestStoryBeside",arguments:[{line:n.lineNumber+1,force:!0},!0,!0]}))),L["wallaby.feature.profiler"].enabled&&t._codeLensProfilerEnabled&&t._profilingEnabledForProject&&!t._traceExplorer.traceBeingNavigated()&&(a.debugged&&i||s.push(new l.CodeLens(r,{title:"Profile",tooltip:"Profile",command:"wallaby.profileTest",arguments:[n.lineNumber+1]}))),t._codeLensTestFiltersEnabled&&!t._traceExplorer.traceBeingNavigated()&&L["wallaby.feature.testFilters"].enabled&&s.push(new l.CodeLens(r,{title:a.filtered?"Remove from filter":"Focus",tooltip:a.filtered?"Remove from filter":"Add to filter",command:"wallaby.toggleTestFilter",arguments:[n.lineNumber+1]})),t._codeLensUpdateSnapshotsEnabled&&!t._traceExplorer.traceBeingNavigated()&&a.snap&&s.push(new l.CodeLens(r,{title:a.snap>1?"Update snapshots":"Update snapshot",tooltip:a.snap>1?"Update snapshots":"Update snapshot",command:"wallaby.updateTestSnapshots",arguments:[n.lineNumber+1]}))}catch(e){}}),s};if(t._session){const i=t._getDocumentFilePath(e),s=t._session.openedDocuments[i];if(s){if(!s.errorTs&&(!s.changeTs||s.changeTs<s.updateTs))return a(s,t._anyVisibleTimelineEditors());if(s.changeTs>s.updateTs||s.errorTs<=s.updateTs&&s.createTs<s.updateTs)return new Promise(e=>{s.provideLenses=(()=>{e(a(s,t._anyVisibleTimelineEditors()))})})}}return[]}}));const V=()=>{this._codeLensRunTestEnabled=l.workspace.getConfiguration().get("wallaby.codeLensFeature.runTest",!1),this._codeLensDebuggerEnabled=l.workspace.getConfiguration().get("wallaby.codeLensFeature.debugger",!0),this._codeLensTestStoryEnabled=l.workspace.getConfiguration().get("wallaby.codeLensFeature.testStory",!0),this._codeLensProfilerEnabled=l.workspace.getConfiguration().get("wallaby.codeLensFeature.profiler",!0),this._codeLensTestFiltersEnabled=l.workspace.getConfiguration().get("wallaby.codeLensFeature.testFilters",!0),this._codeLensUpdateSnapshotsEnabled=l.workspace.getConfiguration().get("wallaby.codeLensFeature.updateSnapshots",!0),this._codeLensEnabled=l.workspace.getConfiguration().get("wallaby.codeLens",!0)&&(this._codeLensDebuggerEnabled||this._codeLensTestStoryEnabled||this._codeLensProfilerEnabled||this._codeLensTestFiltersEnabled||this._codeLensUpdateSnapshotsEnabled||this._codeLensRunTestEnabled)},B=()=>{const e=l.workspace.getConfiguration(),t=e.get("wallaby.outputInspectorFeature.automaticDisplay","Large Values and Errors"),a=e.get("wallaby.outputInspectorFeature.automaticDisplayDebuggerOverride","Errors Only");let i="largeValuesAndErrors";switch(this._showErrorOnSelection=!0,t){case"All Values":i="all";break;case"Large Values and Errors":break;case"Errors Only":i="errors";break;case"Never":i="errors",this._showErrorOnSelection=!1}let s="inherit";switch(a){case"Inherit":break;case"Errors Only":s="errors",this._showErrorOnDebuggerSelection=!0;break;case"Never":s="errors",this._showErrorOnDebuggerSelection=!1}"inherit"===s&&(s=i,this._showErrorOnDebuggerSelection=this._showErrorOnSelection),this._inspectorSettings={autoInspect:i,autoInspectForDebugger:s}},W=()=>{this._testExplorerSettings={enabled:l.workspace.getConfiguration().get("wallaby.testExplorerFeature.enabled",!0),showErrorLocation:l.workspace.getConfiguration().get("wallaby.testExplorerFeature.showErrorLocation",!1)}};V(),B(),W(),this._runOnSaveIndicators=l.workspace.getConfiguration().get("wallaby.runOnSaveIndicators",!0),this._uncoveredCoverageIndicator=l.workspace.getConfiguration().get("wallaby.uncoveredCoverageIndicator",!1),this._disposables.add(l.workspace.onDidChangeConfiguration(()=>{V(),B(),W(),this._runOnSaveIndicators=l.workspace.getConfiguration().get("wallaby.runOnSaveIndicators",!0);const e=this._session;e&&e.setPreferences&&e.setPreferences({inspector:this._inspectorSettings})})),this._valueExplorer=new m(this._context,()=>"https://wallabyjs.com/docs/intro/"+(this._traceExplorer.traceBeingNavigated()?"time-travel-debugger.html#inspecting-runtime-values":"value-explorer.html")),this._traceExplorer=new y(this._context),this._testFileCoverageExplorer=new _(this._context),this._setContext("wallaby.inExperimentalMode",this._isInExperimentalMode()),this._wallabyAppPublicUrl="https://wallabyjs.com/app/",this._wallabyAppLocalUrl="http://localhost:51245/",this._previousInlineValuesLineContext=!1,this._previousInlineValuesFileContext=!1,w.setController(this),w.showSaleIfRequired(this._context)}_setFeatureContext(){let e;try{e=this._coreVersion.split(".").map(e=>parseInt(e,10))}catch(t){e=[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]}Object.keys(L).forEach(t=>{const a=L[t];try{a.enabled=!(e[0]<a.version[0]||e[1]<a.version[1]||e[2]<a.version[2])}catch(e){a.enabled=!0}this._setContext(t,a.enabled)})}_createHover(e){return l.MarkdownString&&((e=new l.MarkdownString(e)).isTrusted=!0),new l.Hover(e)}_isInExperimentalMode(){return l.workspace.getConfiguration().get("wallaby.experimental",!1)}_setupVersionSpecificComponents(e){const t=e.major,a=e.minor;t>=1&&a>=2&&l.workspace.registerTextDocumentContentProvider&&(this._sideBySideDiffSupported=!0),t>=1&&a>=3&&(this._hideAfterContentDecorationType=T.createTextEditorDecorationType({isWholeLine:!0,after:{margin:"0 0 0 10000px"}})),t>=1&&a>=5&&(this._lineAndColumnLinks=!0),t>=1&&a>=10&&(j._escapeInlineMessage=(e=>e)),t>=1&&a>=11&&(this._testsOutputDocumentSelector.scheme="*",this._consoleOutputDocumentSelector.scheme="*"),t>=1&&a>=16&&(this._multiFolderWorkspaces=!0)}_createGutterDecorationType(e,t,a){return T.createTextEditorDecorationType({isWholeLine:!0,rangeBehavior:1,gutterIconPath:this._context.asAbsolutePath(s.join("images",(a?"last.":"")+(t?"snapshot.":"")+e+".svg")).split("\\").join("/")})}_createInlineHoverDecorationType(e,t){return T.createTextEditorDecorationType({isWholeLine:!0,rangeBehavior:1,light:{after:{color:e}},dark:{after:{color:t}}})}allCommandsHint(){return this._formatShortcut(this._keyBindings[E]," ")}coreVersion(){return this._coreVersion}activate(){let t=this;this._diagnosticEntries={},this._diagnosticCollection=l.languages.createDiagnosticCollection("wallaby"),this._originalOnceDocumentStopsChanging=this._onceDocumentStopsChanging,this._onceDocumentStopsChanging=d.debounce(d.bind(this._originalOnceDocumentStopsChanging,this),100),this._processOpenedEditors=d.debounce(d.bind(this._processOpenedEditors,this),100),t._statusBar.updateText=d.debounce(d.bind(t._statusBar.updateText,t._statusBar),200),this._executeCommand=d.bind(this._execute,this),this._packagePath=n.realpathSync(this._context.extensionPath),this._packageMetadata=e(s.join(this._packagePath,"package.json")),this._wallabyFolder=s.join(r.homedir(),".wallaby"),this._lkp=s.join(this._wallabyFolder,"key.lic"),this._ol=s.join(this._wallabyFolder,".ol");try{n.existsSync(this._wallabyFolder)||n.mkdirSync(this._wallabyFolder);let e=s.join(this._packagePath,"..",".wlck");if(!n.existsSync(this._lkp)&&n.existsSync(e)){let a=n.readFileSync(e).toString();n.writeFileSync(t._lkp,a),n.unlinkSync(e)}}catch(e){}t._commands=d.reduce(this._packageMetadata.contributes.commands,(e,t)=>{const a=O[t.command];return a&&a.visible&&(e[t.title]=t),e},{}),t._keyBindings=d.reduce(this._packageMetadata.contributes.keybindings,(e,t)=>(e[t.command]=t,e),{}),t._firstInstall&&setTimeout(()=>{w.createOrShow(this._context,"firstInstall")},1e3),this._statusBar.command="wallaby.statusBarCommand";const a=t._keyBindings["wallaby.showSideBySideDiff"];this._snapshotFailedInlineMessage=`Use 'Show Side-by-Side Diff' command ${a&&a.key?`[${t._formatShortcut(a)}]`:""} or line hover tip to see the snapshot error details.`,this._setActiveProjectRootAndConfig(),this._inspector=new b(this._tryGetDmp),this._disposables.add(()=>{if(t.stop(!0),t._statusBar&&t._statusBar.hide(),this._activeLicenseSession)try{this._activeLicenseSession.stop(),this._activeLicenseSession=null}catch(e){}t._testsOutputChannel.dispose(),t._consoleOutputChannel.dispose(),d.each(t._coverageDecorationTypes,e=>e.dispose()),t._uncoveredRegionDecorationType.dispose(),t._activeTraceFrameDecorationType.dispose(),t._activeTraceCallStackFrameDecorationType.dispose(),t._activeValueCallStackFrameDecorationType.dispose(),t._activeTraceFrameWithNowhereToGoDecorationType.dispose(),t._testTimelineContentProvider&&t._testTimelineContentProvider.dispose()}),this.on("stopped",()=>{t._setContext("wallaby.started",!1),t._setContext("wallaby.reportedAtLeastOnceLogValue",!1),t._setContext("wallaby.testFilterToggled",!1),t._setContext("wallaby.uncoveredToggled",!1),t._testFilterToggled=!1,t._removeStatus()}),this.on("projectConfigured",e=>{d.isNumber(e.editDelay)&&(t._onceDocumentStopsChanging=d.debounce(d.bind(t._originalOnceDocumentStopsChanging,t),e.editDelay)),t._profilingEnabledForProject=e.profiling,t._runOnSave=e.runOnSave}),this.on("busy",()=>{t._statusUpdateTimeout||t._statusBar.isDisplayingProgress()||(t._statusUpdateTimeout=setTimeout(()=>t._updateStatus("progress"),C))}),this.on("copyToClipboard",e=>{l.env.clipboard.writeText(e.data)}),this.on("notification",a=>{let i=[];if(~a.text.indexOf("extended-trial-license-link")&&i.push({title:"Request License",command:"_requestTrialLicense"}),~a.text.indexOf("expire")&&"warning"===a.type&&this._suppressExpirationNotifications)return;~a.text.indexOf("activate-link")&&i.push({title:"Enter License",command:"wallaby.showLicense"}),~a.text.indexOf("continue-trial-link")&&i.push({title:"Continue Trial",command:"_continueTrial"}),~a.text.indexOf("purchase")&&i.push({title:"Purchase",command:"_openPurchasePage"}),~a.text.indexOf("PhantomJs docs")&&i.push({title:"View Documentation",command:"_openPhantomJsDocs"}),~a.text.indexOf("auto-config-info-link")&&i.push({title:"View Documentation",command:"_openAutoConfigDocs"}),a.button&&i.push({title:a.button.label,command:()=>{try{e("openurl2").open(a.button.link)}catch(e){}}}),a.text=a.text.replace(/<br\/><br\/>/g," ").replace(/<br\/>/g," ").replace(/<[^>]*>/g,"");let s=[a.text].concat(i);T["show"+a.type.charAt(0).toUpperCase()+a.type.substr(1)+("info"===a.type?"rmation":"")+"Message"].apply(T,s).then(t._executeCommand),0===a.text.indexOf("Can not start node.js process")&&T.showInformationMessage('You may use the "wallaby.node" setting to configure the location of node.')}),this.on("stats",e=>{e&&(t._stats=e,d.isObject(e)&&this._traceExplorer.update(e.trace),this._outputTestResults(this._failingTestsOutput,e),this._updateDiagnosticsCollection(e),this._runScheduledActionOnResultsAvailable()),t._updateStatus()}),this.on("activeTestFileCoverageChanged",e=>{this._testFileCoverageExplorer.update(e)}),this.on("filesToTrack",(e,t)=>{d.reduce(t,(e,t)=>(e[t]||(e[t]={changes:[],path:t}),e),e.filesToTrack),this._processOpenedEditors(e)}),this.on("live",(e,a)=>{e.wallabyAppPort=a.wallabyAppPort;try{l.env.asExternalUri(l.Uri.parse(`http://localhost:${a.wallabyAppPort}`)).then(t=>{const[,a]=t.authority.split(":");a&&(e.wallabyAppPort=parseInt(a,10))})}catch(e){console.error(e)}t._setContext("wallaby.started",!0),t._observeDocuments(e),this._context.globalState.get("wallaby:te")||this._context.globalState.update("wallaby:te",a.te)}),this.on("documentUpdates",(e,a)=>{t._updateDocuments(e,a),t._displayStatusForActiveEditor(e),t._screenshotProvider&&t._screenshotProvider.update(),t._isTimelineViewer(T.activeTextEditor)&&t._forEachVisibleTimelineEditor(e=>t._testTimelineContentProvider.updateTimelineEditorInlineValueDecorations(e,j._activeLine(),a)),t._runScheduledActionOnResultsAvailable()}),this.on("fileMessages",e=>{t._setContext("wallaby.reportedAtLeastOnceLogValue",!0),this._valueExplorer.update(e)}),this.on("wallabyAppUrl",e=>{this._currentWallabyAppLocalUrl=e;try{l.env.asExternalUri(l.Uri.parse(this._currentWallabyAppLocalUrl)).then(e=>{this._currentWallabyAppLocalUrl=e.toString()})}catch(e){console.error(e)}}),this.on("inspections",e=>{if(L["wallaby.feature.inspections"].enabled){this._inspector.build(e.empty,e.inspections);const t=b.editors(l.window.visibleTextEditors);t.length?!e.empty||this._traceExplorer.traceBeingNavigated()?this._inspector.update(t):this.closeInspector():!e.empty&&e.obtrusive&&this._showInspector()}}),this._multiFolderWorkspaces&&v.onDidChangeWorkspaceFolders&&this._disposables.add(v.onDidChangeWorkspaceFolders(()=>{const e=this._activeConfig;this._setActiveProjectRootAndConfig(this._activeConfig),e!==this._activeConfig&&this.stop(!0)})),this._projectRunningState()&&l.workspace.getConfiguration().get("wallaby.startAutomatically",!0)?this.start():this._startIfTutorialProject()}_projectRunningState(){return this._activeProjectRoot()&&this._context.workspaceState.get("wallaby:runningstate:"+j._hash(this._activeProjectRoot()))}_setProjectRunningState(e){e?this._context.workspaceState.update("wallaby:runningstate:"+j._hash(this._activeProjectRoot()),1):this._context.workspaceState.update("wallaby:runningstate:"+j._hash(this._activeProjectRoot()),0)}_selectClosestProject(){const e=this._configPath(),t=e=>{if(e&&e.document&&e.document.uri&&"file"===e.document.uri.scheme){const t=v.workspaceFolders.find(t=>e.document.uri.fsPath.startsWith(t.uri.fsPath));if(t)return{workspaceFolder:t.uri.fsPath,editorFolder:s.dirname(e.document.uri.fsPath)}}};let a=t(T.activeTextEditor);if(!a){const e=[...T.visibleTextEditors];e.sort((e,t)=>(e.viewColumn||0)-(t.viewColumn||0)),a=e.find(t)}if(a){do{if(n.existsSync(s.join(a.editorFolder,"package.json"))||n.existsSync(s.join(a.editorFolder,"jest.config.js")))break;a.editorFolder=s.dirname(a.editorFolder)}while(a.editorFolder.length>=a.workspaceFolder.length);const e=s.resolve(a.editorFolder,"auto.detect");this._configFile(e)}else{const e=s.resolve(this._activeProjectRoot(),"auto.detect");this._configFile(e)}e===this._configPath()&&this._started||this.start()}_configFile(e){this._setActiveProjectRootAndConfig(e)}_findProject(e){if(e){if(this._multiFolderWorkspaces&&v.workspaceFolders){const t=d.find(v.workspaceFolders,t=>~e.indexOf(t.uri.fsPath+s.sep));if(t)return t.uri.fsPath}else if(v.rootPath&&~e.indexOf(v.rootPath))return v.rootPath}else{if(!this._multiFolderWorkspaces||!v.workspaceFolders)return v.rootPath;{const e=this._context.workspaceState.get("wallaby:activeProjectRoot");if(e&&d.find(v.workspaceFolders,t=>e===t.uri.fsPath))return e;if(v.workspaceFolders.length)return v.workspaceFolders[0].uri.fsPath}}}_setActiveProjectRootAndConfig(e,t){!e||n.existsSync(e)||e.endsWith("auto.detect")||(e=void 0),this._activeProject=this._findProject(e)||void 0,e&&!this._activeProject&&(e=void 0,this._activeProject=this._findProject()),this._context.workspaceState.update("wallaby:activeProjectRoot",this._activeProject),this._activeProject?(e?this._activeConfig=e:(this._activeConfig=this._context.workspaceState.get("wallaby:configPath:"+j._hash(this._activeProjectRoot())),!this._activeConfig||n.existsSync(this._activeConfig)||this._activeConfig.endsWith("auto.detect")||delete this._activeConfig,!this._activeConfig&&t&&(this._activeConfig=this._configByConvention())),this._context.workspaceState.update("wallaby:configPath:"+j._hash(this._activeProject),this._activeConfig),this._activeConfigFolder=this._activeConfig?s.dirname(this._activeConfig):void 0):(this._activeConfig=void 0,this._activeConfigFolder=void 0)}_activeProjectRoot(){return this._activeProject}_configPath(){return this._activeConfig}_configFolderPath(){return this._activeConfigFolder}deactivate(){this._disposed||(this._inspector.dispose(),this._disposables.dispose(),this._disposed=!0)}_forceDeactivate(){this._deactivator(),d.each(O,(e,t)=>l.commands.registerCommand(t,()=>T.showWarningMessage("Wallaby.js trial session is over, please restart VS Code for a new trial session.")))}selectAsConfigurationAndStart(e){const t=this._tryGetUtils();if(!t)return void this._showWallabyUpdatingWarning();const a=this._activeProjectRoot();if(!a)return void T.showWarningMessage("Please open some folder/project before selecting configuration.");const i=this._relativeNormalizedFilePath(t,e.fsPath,a);this._configFile(s.resolve(a,i,"auto.detect")),this.start()}startOnClosestMonoRepoProject(){this._selectClosestProject()}selectConfigFile(){let e=this;const t=e._tryGetUtils();if(!t)return void e._showWallabyUpdatingWarning();const a=this._activeProjectRoot(),i=this._relativeConfigPath();a?v.findFiles("**/*wallaby*.*","**/node_modules/**",500).then(o=>{const n=[{label:"Automatic Configuration <project directory>",path:s.resolve(this._activeProjectRoot(),"auto.detect")},{label:"Automatic Configuration <custom directory>...",path:"selectDirectory"},{label:"Automatic Configuration <closest project in mono-repo>",path:"closestProject"}],r=d.map(o,a=>({label:e._relativeNormalizedFilePath(t,a.fsPath,e._activeProjectRoot()),path:a.fsPath})),c=[...n,...r.sort((e,t)=>e.label.localeCompare(t.label))],h=a&&i?`Currently selected: ${s.join(s.basename(a),i)}`:void 0;return T.showQuickPick(c,{placeHolder:h}).then(a=>{a&&("closestProject"===a.path?e._selectClosestProject():"selectDirectory"===a.path?T.showOpenDialog({canSelectFolders:!0,defaultUri:l.Uri.file(v.rootPath),openLabel:"Select Folder"}).then(a=>{if(a&&a[0]){const i=e._relativeNormalizedFilePath(t,a[0].fsPath,e._activeProjectRoot());e._configFile(s.resolve(this._activeProjectRoot(),i,"auto.detect")),e.start()}}):(e._configFile(a.path),e.start()))})}):T.showWarningMessage("Please open some folder/project before selecting configuration.")}playTraceNextStep(e={}){this._requestTrace(e)}playTraceNextStepOver(){this._requestTrace({over:!0})}playTraceNextStepOut(){this._requestTrace({out:!0})}playTracePrevStep(){this._requestTrace({back:!0})}playTracePrevStepOver(){this._requestTrace({back:!0,over:!0})}playTracePrevStepOut(){this._requestTrace({back:!0,out:!0})}playTraceForwardToSelection(){this._playTraceToSelection()}playTraceBackwardToSelection(){this._playTraceToSelection({back:!0})}playTraceForwardToBreakpoint(){this._requestTrace({breakpoints:this._getBreakpoints()})}playTraceBackwardToBreakpoint(){this._requestTrace({back:!0,breakpoints:this._getBreakpoints()})}_getBreakpoints(){if(!l.debug.breakpoints)return[];const e=this._tryGetUtils();return e?l.debug.breakpoints.filter(e=>e.enabled&&e.location&&e.location.range&&e.location.uri&&"file"===e.location.uri.scheme).map(t=>({line:t.location.range.start.line+1,file:this._relativeNormalizedFilePath(e,t.location.uri.fsPath)})):[]}openCallStackFrame(e){const t=!e.noTrace;t?d.each(T.visibleTextEditors,e=>this._destroyStackTraceDecorations(e)):(this._destroyAllValueCallStackDecorations(),clearTimeout(this._destroyAllValueCallStackDecorationsTimeout),this._destroyAllValueCallStackDecorationsTimeout=setTimeout(()=>this._destroyAllValueCallStackDecorations(),2e3)),this._navigateWithTraceHighlight(e,t?this._activeTraceCallStackFrameDecorationType:this._activeValueCallStackFrameDecorationType,{requestTimelineIfStepIsOutOfSight:!0}),t&&this._traceExplorer.updateTraceContext(e)}_destroyAllValueCallStackDecorations(){d.each(T.visibleTextEditors,e=>this._destroyValueCallStackDecorations(e))}revealTraceStep(e){e&&this._navigateWithTraceHighlight(e,this._activeTraceFrameDecorationType,{requestTimelineIfStepIsOutOfSight:!0})}stopTraceNavigation(){this._traceExplorer.stopTraceNavigation(),this._closeTestTimeline(!0),d.each(T.visibleTextEditors,e=>this._destroyStackTraceDecorations(e)),this._updateStatus()}_openWallabyTools(){const e=T.activeTextEditor;!this._traceExplorer.traceBeingNavigated()||this._testTimelineContentProvider&&this._testTimelineContentProvider.isExpectingTimelineLoad()||(this._haveAlreadyOpenedWallabyTools=!0,l.commands.executeCommand("workbench.view.extension.wallaby"),setTimeout(()=>{if(e&&e.document&&!this._isTimelineViewer(T.activeTextEditor)){const t=this._getDocumentFilePath(e.document);t&&this._session&&this._session.filesToTrack[t]&&T.showTextDocument(e.document,{preserveFocus:!1})}},400))}_playTraceToSelection(e={}){const t=T.activeTextEditor;if(t){if(e.line=j._activeLine(),e.file=this._getDocumentFilePath(t.document),this._isTimelineViewer(t)){const t=this._testTimelineContentProvider.getOriginalLocationByLine(e.line);if(!t)return;e.line=t.line,e.file=t.file,e.frame=t.step}this._requestTrace(e)}}_requestTrace(e={}){this._session&&this._traceExplorer.requestTrace(e).then(t=>this._processTraceNavigation(t,!1,e.preserveTimelineSelection))}_processFileChanges(e){this._tryGetDmp()&&e.fileChanges.forEach(e=>{try{const t=this._absoluteFilePath(e.file),a=T.visibleTextEditors.find(e=>e.document.fileName===t);if(a){if(a.document.getText()!==e.oldContent)return;a.edit(t=>{t.replace(new l.Range(new l.Position(0,0),a.document.lineAt(a.document.lineCount-1).range.end),e.newContent)})}else{const a=()=>{n.readFileSync(t).toString()===e.oldContent&&n.writeFileSync(t,e.newContent)},i=v.textDocuments.find(e=>e.fileName===t);i&&i.isDirty?i.getText()===e.oldContent&&i.save().then(()=>{a()}):a()}}catch(e){console.error(e)}})}_processTraceNavigation(e,t=!0,a=!1){return e&&e.restart&&!this._haveAlreadyOpenedWallabyTools&&(t=!1,this._openWallabyTools()),d.each(T.visibleTextEditors,e=>this._destroyStackTraceDecorations(e)),this._traceExplorer.traceNavigated(e),this._updateStatus(),!e&&this._traceExplorer.lastActiveStep()?this._navigateWithTraceHighlight(this._traceExplorer.lastActiveStep(),this._activeTraceFrameWithNowhereToGoDecorationType,{onlyHighlightRangeInVisibleEditors:t,preserveTimelineSelection:a,requestTimelineIfStepIsOutOfSight:!0}):e?this._navigateWithTraceHighlight(e,this._activeTraceFrameDecorationType,{onlyHighlightRangeInVisibleEditors:t,requestTimelineIfStepIsOutOfSight:!0}):void 0}_navigateWithTraceHighlight(e,t,{onlyHighlightRangeInVisibleEditors:a=!1,reveal:i=!0,requestTimelineIfStepIsOutOfSight:s=!1,preserveTimelineSelection:o=!1}){const n=(a,i)=>{const s=e.range[0]!==e.range[2],o=i>=0?i:e.range[0]-1,n=a.document&&a.document.lineAt(o),r=e.range[1],c=!r&&n?n.firstNonWhitespaceCharacterIndex:r;s?a.setDecorations(t,[new l.Range(o,c,o,1e4)]):a.setDecorations(t,[new l.Range(o,c,o,e.range[3])])};if(this._anyVisibleTimelineEditors()&&!this._testTimelineContentProvider.unlocked()){const t=this._testTimelineContentProvider.getLineByStep(e.frame);t>=0?(i&&this._forEachVisibleTimelineEditor(a=>{let i=new l.Position(t,e.range[1]);a.revealRange(new l.Range(i,i),2),o||(a.selection=new l.Selection(i,i))}),this._forEachVisibleTimelineEditor(e=>n(e,t))):(this._forEachVisibleTimelineEditor(e=>this._destroyStackTraceDecorations(e)),s&&this.showTestStory({before:e.frame},!0,this._testTimelineContentProvider.openedBeside(),!0)),this._isTimelineViewer(T.activeTextEditor)&&(a=!0,this._testTimelineContentProvider.openedBeside()&&this._navigate(e.file,e.loc,{focus:!1,select:!1,viewColumn:this._testTimelineContentProvider.viewColumnWhenOpened()-1}).then(n))}if(!a)return this._navigate(e.file,e.loc,{reveal:i}).then(n);d.filter(T.visibleTextEditors,t=>t&&t.document&&this._getDocumentFilePath(t.document)===e.file).forEach(e=>n(e))}openWallabyApp(){try{e("openurl2").open(this._getWallabyAppUrl())}catch(e){}}_getWallabyAppUrl(){return this._alwaysOpenLocalWallabyUrl?this._wallabyAppLocalUrl:this._started?this._currentWallabyAppLocalUrl+(this._session&&this._session.wallabyAppPort?"?port="+this._session.wallabyAppPort:""):this._wallabyAppPublicUrl}showFailingTests(){this._stats?(this._outputTestResults(this._failingTestsOutput,this._stats),this._failingTestsOutput.show()):this._consoleOutputChannel.show()}statusBarCommand(){this.showFailingTests(),this._traceExplorer.traceBeingNavigated()&&(l.commands.executeCommand("wallaby.revealTraceStep",this._traceExplorer.lastActiveStep()),l.commands.executeCommand("wallaby.traceExplorer.focus"))}showCommandPalette(){let e=this;T.showQuickPick(d.map(e._commands,(t,a)=>{let i={label:a},s=e._keyBindings[t.command];return s&&(i.description=e._formatShortcut(s)),i})).then(t=>t&&l.commands.executeCommand(e._commands[t.label].command))}_formatShortcut(e,t){t=t||"";let a=this;if(!e)return;let i=a._isMac?e.mac:e.key;return d.map(i.split(" "),e=>d.map(e.split("+"),e=>{let t=e.charAt(0).toUpperCase()+e.slice(1);return a._isMac&&t.replace("Cmd","⌘").replace("Ctrl","⌃").replace("Alt","⌥").replace("Shift","⇧")||t}).join(a._isMac?`${t}`:`${t}+${t}`)).join(" ")}showLastScreenshot(){this._session&&this._screenshotProvider&&this._screenshotProvider.display()}runLineTests(e){this._runTests("line",e)}revealValue(e){if(!this._session)return;let t="",a=1;if(e)t=e.file,e.loc&&(a=parseInt((e.loc+"").split(":")[0],10));else{const e=T.activeTextEditor;if(!e)return;t=this._getDocumentFilePath(e.document),a=j._activeLine()}t&&this._valueExplorer.reveal(t,a)}debugTest(e){this._traceExplorer.traceBeingNavigated()&&this._traceExplorer.stopTraceNavigation(),e&&e.showTimeline&&this._openTestTimelineOnTraceNavigationStarted({},!0),this._runTests("initialTraceRun",e)}profileTest(e){this._traceExplorer.traceBeingNavigated()&&this._traceExplorer.stopTraceNavigation(),T.showQuickPick([{label:"Open profile in Chrome Dev Tools",target:"devtools"},{label:"Open profile in VS Code",target:"editor"}]).then(t=>{t&&t.target&&this._runTests({type:"profileRun",target:t.target},e||j._activeLine())})}showTestStoryBeside(e){this.showTestStory(e||{},!0,!0)}showTestStory(e={},t=!0,a,i){this._session&&this._testTimelineContentProvider&&(this._testTimelineContentProvider.changeLock(!0,this._visibleTimelineEditors()),this._testTimelineContentProvider.showNewTimelineBeside(a),this._traceExplorer.traceBeingNavigated()&&!e.force?this._openTestTimeline(e,t,i):(this.debugTest(e.line),this._openTestTimelineOnTraceNavigationStarted(e,t)))}lockTestStory(){this._session&&this._testTimelineContentProvider&&(this._testTimelineContentProvider.changeLock(!0,this._visibleTimelineEditors()),this.showTestStory({},!0,this._testTimelineContentProvider.openedBeside()))}unlockTestStory(){this._session&&this._testTimelineContentProvider&&(this._forEachVisibleTimelineEditor(e=>this._destroyStackTraceDecorations(e)),this._testTimelineContentProvider.changeLock(!1,this._visibleTimelineEditors()))}_openTestTimelineOnTraceNavigationStarted(e,t){const a=this._traceExplorer.onTraceNavigationStarted(()=>{a.dispose(),this._openTestTimeline(e,t)})}_openTestTimeline(e,t,a){this._session&&this._testTimelineContentProvider&&!this._testTimelineContentProvider.isExpectingTimelineLoad()&&(this._testTimelineContentProvider.expectingTimelineLoad(),this._session.requestTestTimeline(e,s=>i(this,void 0,void 0,function*(){yield this._testTimelineContentProvider.show(s,this._visibleTimelineEditors()),this._highlightActiveTraceStepIfRequired(T.activeTextEditor,{reveal:!e.hide&&t,onlyHighlightRangeInVisibleEditors:!!a})})))}runFileTests(){this._runTests("file")}runProjectTests(){this._runTests("project")}updateTestSnapshots(e){this._runTests("line",e,!0)}updateFileSnapshots(){this._runTests("file",void 0,!0)}updateProjectSnapshots(){this._runTests("project",void 0,!0)}jumpToFailingTest(e){this._jumpTo("failingTest",e)}jumpToErrorSource(){this._jumpTo("errorSource")}jumpToLineTest(e={}){if(!this._session)return;const t=T.activeTextEditor;let a=e.file||t&&this._getDocumentFilePath(t.document),i=e.line||j._activeLine();a&&i&&this.jumpToTest({file:a,line:i})}jumpToSnapshot(e){e&&e.file&&e.line&&this._session&&this._session.requestSnapshot({file:e.file,line:e.line,type:"location"},e=>{if(!e||!e.name)return;parseInt(e.loc,10)-1>=0&&l.commands.executeCommand("wallaby.navigate",{file:e.file,loc:e.loc,side:"left"})})}searchTests(){this.jumpToTest()}jumpToTest(e){return i(this,void 0,void 0,function*(){const t=yield new Promise(t=>{this._session&&this._session.requestTests({filter:e},a=>{t((a||[]).map(t=>({label:this._buildTestName(t.name,t.failing,t.status,!e),description:t.suite,detail:t.file,test:t})))})});if(t&&1===t.length)return this._navigate(t[0].test.file,t[0].test.location);T.showQuickPick(t,{matchOnDescription:!0,matchOnDetail:!0}).then(e=>{e&&(e.test.status&&"executed"!==e.test.status?this._session.requestLocation({file:e.test.file,test:e.test.name,type:"unexecutedTest"},e=>this._navigate(e.file,e.loc)):this._navigate(e.test.file,e.test.location))})})}showSideBySideDiff(e){if(this._session)if(e){if(e.id>=0&&!(e=e.failingTestsOutput?this._failingTestsOutput.getDiffData(e.id):this._lineTestsOutput.getDiffData(e.id)))return;l.commands.executeCommand("vscode.diff",...g.diffCommandArguments(e.expected,e.actual))}else{const e=T.activeTextEditor,t=e&&this._getDocumentFilePath(e.document),a=j._activeLine();this._session.requestError({file:t,line:a,type:"failingTest"},e=>{e&&e.error&&(e.error.expected||e.error.actual)&&l.commands.executeCommand("vscode.diff",...g.diffCommandArguments(e.error.expected,e.error.actual))})}}showLineTests(){let e=this;if(!this._session)return;const t=T.activeTextEditor;let a=t&&this._getDocumentFilePath(t.document),i=j._activeLine();a&&i&&this._session.openedDocuments[a]&&this._session.requestLineReport({file:a,line:i},t=>{e._lineTestsOutput.show(),e._outputTestResults(e._lineTestsOutput,t.report.tests&&t.report.tests.length?t.report:"Line is not covered or covered not by tests")})}showLineTestsFromMenu(){this.showLineTests()}showValue(){this._showValue("show")}copyValue(){this._showValue("copy")}clearValue(){this._clearValues("one")}clearFileValues(){this._clearValues("file")}clearAllValues(){this._clearValues("all")}copyDiagnosticsReportToClipboard(){this._session&&this._session.copyDiagnosticsReportToClipboard({editorVersion:l.version,pluginVersion:this._packageMetadata.version})}runModeOnSave(){this._runOnSave=!0,this._session.setRunMode("onsave")}runModeImmediate(){this._runOnSave=!1,this._session.setRunMode("immediate")}runModeToggle(){this._runOnSave=!this._runOnSave,this._session.setRunMode("toggle")}forceCoreUpdate(){this._state.forceCoreUpdate()}toggleTestFilter(e){if(!this._session)return;const t=T.activeTextEditor;if(!t)return;const a=t&&this._getDocumentFilePath(t.document);e=e||j._activeLine(),this._session.toggleTestFilter({file:a,line:e})}resetTestFilter(){this._session&&(this._setContext("wallaby.testFilterToggled",!1),this._session.toggleTestFilter({}))}resetUncovered(e){if(!(e=e||T.activeTextEditor))return;this._setContext("wallaby.uncoveredToggled",!1);const t=this._getDocumentFilePath(e.document);this._session.uncoveredDisplayed[t]&&this._destroyUncoveredDecorations(e)}startExclusively(e,t){this.addToExclusiveTestRun(e,t,!0)}startExclusivelyFromMenu(e){e&&this.addToExclusiveTestRun(e.fsPath,!0,!0)}addToExclusiveTestRun(e,t,a){const i=this._tryGetUtils();if(i){if(!e&&!t){const t=T.activeTextEditor;e=t&&t.document&&t.document.uri&&t.document.uri.fsPath}e&&(e=this._relativeNormalizedFilePath(i,e),!this._session||a?this.start(e):this._session.addTestLocations([e]))}else this._showWallabyUpdatingWarning()}addToExclusiveTestRunFromMenu(e){e&&this.addToExclusiveTestRun(e.fsPath,!0)}showError(e){return i(this,void 0,void 0,function*(){if(L["wallaby.feature.inspections"].enabled){const t=T.activeTextEditor;if(!t)return;const a=this._getDocumentFilePath(t.document),i=e||j._activeLine();yield this._showInspector({file:a,line:i,type:"error"})}})}inspectValue(){return i(this,void 0,void 0,function*(){if(L["wallaby.feature.inspections"].enabled){const e=T.activeTextEditor;if(!e)return;if(!this._session||!this._session.openedDocuments)return;const t=this._getDocumentFilePath(e.document),a=this._session.openedDocuments[t];if(!a||!a.messages)return;const i=j._activeLine(),s=a.messages[i-1];if(!s)return;(this._inspectorActive&&!s.inspected||!this._inspectorActive)&&(yield this._showInspector({file:t,line:i,type:"log"}))}})}toggleInspectorFocus(){return i(this,void 0,void 0,function*(){if(this._session&&(this._inspectorActive||this._inspectorClearingHandle))if(b.isMyEditor(T.activeTextEditor)){let e=T.visibleTextEditors.find(e=>this._session.previousActiveEditor===e);e||(e=T.visibleTextEditors.find(e=>!b.isMyEditor(e))),e&&e.show()}else yield this._showInspector(void 0,!0)})}closeInspector(){return i(this,void 0,void 0,function*(){if(!this._inspectorOpening&&!this._inspectorClosing){this._inspectorClosing=!0;try{this._inspectorClearingHandle&&(clearTimeout(this._inspectorClearingHandle),delete this._inspectorClearingHandle),this._session&&this._session.removeInspections();const e=b.editors(l.window.visibleTextEditors);if(this._inspector.build(!0),e.length){const t=l.workspace.getConfiguration(),a="workbench.editor.revealIfOpen",i=(t.inspect(a)||{}).globalValue;i||(yield t.update(a,!0,!0)),yield l.window.showTextDocument(b.uri,{preserveFocus:!1}),i||(yield t.update(a,!1,!0)),yield new Promise(e=>setTimeout(()=>e(),100)),b.isMyEditor(T.activeTextEditor)&&(this._inspector.reset(e),yield l.commands.executeCommand("workbench.action.closeActiveEditor")),this._inspectorClearingHandle&&(clearTimeout(this._inspectorClearingHandle),delete this._inspectorClearingHandle),this._session&&this._session.previousActiveEditor&&this._session.previousActiveEditor.show()}}finally{this._inspectorClosing=!1}}})}deleteInspection(e){const t=this._session;if(t&&T.activeTextEditor===b.editor(l.window.visibleTextEditors))if(void 0===e){const e=j._activeLine();this._inspector.execute(e,e=>{t.removeInspections({ids:[e]})})}else t.removeInspections({ids:[e]})}suppressShowingInspectorDocHeader(e){return i(this,void 0,void 0,function*(){yield l.workspace.getConfiguration().update("wallaby.outputInspectorFeature.showDocHeader",!1,!0),this._inspector.build(!1,e),this._inspector.update(b.editors(l.window.visibleTextEditors),!0)})}openTutorial(e){return f.open(e)}openSampleProject(){return this.openTutorial("quick-start")}testingMenuGoToTest(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];this._session._testControllerItems[t.id]&&this._navigate(this._session._testControllerItems[t.id].path,[this._session._testControllerItems[t.id].test.line,this._session._testControllerItems[t.id].test.column])}testingMenuDebug(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];this._session._testControllerItems[t.id]&&(this._navigate(this._session._testControllerItems[t.id].path,[this._session._testControllerItems[t.id].test.line,this._session._testControllerItems[t.id].test.column]),this.debugTest({file:this._session._testControllerItems[t.id].path,loc:this._session._testControllerItems[t.id].test.line}))}testingMenuRunTest(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];this._session._testControllerItems[t.id]&&this._runTests("line",{file:this._session._testControllerItems[t.id].path,loc:this._session._testControllerItems[t.id].test.line},!1)}testingMenuProfile(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];this._session._testControllerItems[t.id]&&this.profileTest({file:this._session._testControllerItems[t.id].path,loc:this._session._testControllerItems[t.id].test.line})}testingMenuViewStory(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];this._session._testControllerItems[t.id]&&(this.debugTest({file:this._session._testControllerItems[t.id].path,loc:this._session._testControllerItems[t.id].test.line}),this._openTestTimelineOnTraceNavigationStarted({},!0))}testingMenuGoToError(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];if(!this._session._testControllerItems[t.id])return;const a=this._session._testControllerItems[t.id].test||this._session._testControllerItems[t.id].file;if(a.errors&&a.errors.length){const e=a.errors[0];e.stack&&e.stack.length&&void 0!==e.stack[0].line&&e.stack[0].path&&this._navigate(e.stack[0].path,[e.stack[0].line,e.stack[0].column||0])}}testingMenuUpdateSnapshot(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];this._session._testControllerItems[t.id]&&(this._session._testControllerItems[t.id].test?this._runTests("line",{file:this._session._testControllerItems[t.id].path,loc:this._session._testControllerItems[t.id].test.line},!0):this._runTests("file",{file:this._session._testControllerItems[t.id].path},!0))}testingMenuGoToFile(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];this._session._testControllerItems[t.id]&&this._navigate(this._session._testControllerItems[t.id].path)}testingMenuRunFileTests(...e){if(!this._hasValidStats)return;if(!e||1!==e.length)return;const t=e[0];this._session._testControllerItems[t.id]&&this._runTests("file",{file:this._session._testControllerItems[t.id].path},!1)}resetCache(){return i(this,void 0,void 0,function*(){const t=this._started;this.stop();const a=t=>new Promise((a,i)=>{e("fs-extra").remove(t,(e,t)=>{e?i(e):a()})});let i=!1;if(this._configPath()){const e=s.join(this._packagePath,"projects",j._hash(this._configPath()));try{yield a(e)}catch(e){i=!0,console.log(e)}}const o=s.join(this._packagePath,"projects");try{yield a(o),T.showInformationMessage("Wallaby cache has been reset."),t&&this.start()}catch(e){i?T.showErrorMessage(`Wallaby cache could not be reset. Please close all editors and try again or else delete "${o}" manually.`):T.showWarningMessage("Wallaby cache has been reset for the current project only. To reset for all projects, please ensure Wallaby is not running in any editor."),console.log(e)}})}_startIfTutorialProject(){try{n.existsSync(s.join(this._activeProjectRoot(),"node_modules",".wallaby-tutorial"))&&(this._context.workspaceState.update("wallaby:configPath:"+j._hash(this._activeProject),void 0),this._closeAllEditors(),l.window.withProgress({location:l.ProgressLocation.Notification,title:"Wallaby Tutorial",cancellable:!1},e=>new Promise(t=>i(this,void 0,void 0,function*(){e.report({message:"Starting tutorial project..."}),this.start(void 0,t)}))),this._tutorialFileWatcher||(this._tutorialFileWatcher=v.createFileSystemWatcher("**/node_modules/.wallaby-tutorial"),this._disposables.add(this._tutorialFileWatcher),this._disposables.add(this._tutorialFileWatcher.onDidCreate(()=>this._startIfTutorialProject()))))}catch(e){}}_showInspector(e,t){return i(this,void 0,void 0,function*(){if(this._inspectorClosing)return;if(this._inspectorClearingHandle&&(clearTimeout(this._inspectorClearingHandle),delete this._inspectorClearingHandle),e){const t=this._session;if(!t)return;t.addInspections(e)}this._session&&this._session.editorDataEvent&&this._session.editorDataEvent({event:`vscode.showInspector.${e?e.type:"auto"}`,params:""});let a=Math.max(...l.window.visibleTextEditors.filter(e=>e.viewColumn).map(e=>e.viewColumn));if(1===a)a=l.ViewColumn.Beside;else{const e=this._visibleTimelineEditors().filter(e=>e.viewColumn);e.length&&(a=Math.max(...e.map(e=>e.viewColumn))-1)}const i={preview:!1,viewColumn:a,preserveFocus:!0};let s=b.editor(l.window.visibleTextEditors);if(!s){this._inspectorOpening=!0;try{s=yield l.window.showTextDocument(b.uri,i)}finally{this._inspectorOpening=!1}s.options.lineNumbers=l.TextEditorLineNumbersStyle.Off}t&&s.show()})}_showValue(e,t){return i(this,void 0,void 0,function*(){const a=T.activeTextEditor;if(!a)return;const i=this._session;if(!i)return;const s=a.selection;if(!s||!s.end)return;let o=s.start.line+1,n=s.end.line+1,r=this._getDocumentFilePath(a.document),c=a.document;if(this._isTimelineViewer(a)){this._playTraceToSelection({preserveTimelineSelection:!0,playToExactFrame:!0});const e=this._testTimelineContentProvider.getOriginalLocationByLine(o);if(!e)return;const t=n-o;if(n=(o=e.line)+t,r=e.file,!(c=yield v.openTextDocument(this._absoluteFilePath(r))))return}else if(!r||!this._session.openedDocuments[r])return;const d=c.getText();i.evaluateExpressionInEditor(r,d,[o,s.start.character,n,s.end.character],e),t&&this._scheduleOnResultsAvailable(r,s.end,()=>l.commands.executeCommand("editor.action.showHover"))})}_clearValues(e){const t=this._session;if(!t)return;const a={};if("file"===e||"one"===e){const i=T.activeTextEditor;if(!i)return;if(a.path=this._getDocumentFilePath(i.document),"one"===e){const e=t.openedDocuments[a.path];a.line=j._activeLine();const i=a.line-1;if(!(e&&e.messages&&e.messages[i]&&e.messages[i].removable))return}if("file"===e){const e=t.openedDocuments[a.path];if(!e||!e.hasRemovableMessages)return}}t.removeLogs(a)}_scheduleOnResultsAvailable(e,t,a){this._runOnResultsAvailable={filePath:e,selectionEnd:t,action:a}}_updateDiagnosticsCollection(e){if(l.workspace.getConfiguration().get("wallaby.reportFailuresAsProblems",!0)){const t={};try{e&&e.errors&&e.errors.length&&e.errors.filter(e=>e&&e.snapshot).forEach(e=>{if(e.stack&&e.stack.length){const a=e.stack[0],i=this._absoluteFilePath(a.file),[s,o]=a.loc.split(":"),n=new l.Position(parseInt(s,10)-1,parseInt(o,10)),r={code:"",message:e.message,range:new l.Range(n,n),severity:l.DiagnosticSeverity.Error,source:"Wallaby.js"};t[i]||(t[i]=[]),t[i].push(r)}}),e&&e.tests&&e.tests.forEach(e=>{if(e.file&&e.errors){const a=this._absoluteFilePath(e.file);t[a]||(t[a]=[]);const i=e.path.join(" "),[s,o]=e.declarationLoc.split(":"),n=new l.Position(parseInt(s,10)-1,parseInt(o,10)),r={code:"",message:i,range:new l.Range(n,n),severity:l.DiagnosticSeverity.Error,source:"Wallaby.js",relatedInformation:e.errors.map(e=>{if(e.stack&&!(!e.stack.length>0)&&e.stack[0].loc&&e.stack[0].file)try{const[t,a]=((e.stack[0].loc||"")+":0").split(":"),i=parseInt(t,10)-1,s=parseInt(a,10),o=l.Uri.file(this._absoluteFilePath(e.stack[0].file));if(i<1)return;return{message:e.message,location:new l.Location(o,new l.Position(i,s))}}catch(e){return}}).filter(e=>!!e)};t[a].push(r),t[a].sort((e,t)=>e.range.start.line===t.range.start.line?e.range.start.character-t.range.start.character:e.range.start.line-t.range.start.line)}})}catch(e){console.error(e)}Object.keys(t).forEach(e=>{const a=this._diagnosticEntries[e],i=t[e];if(!a||i.length!==a.length||JSON.stringify(i)!==JSON.stringify(a)){const t=l.Uri.file(e);this._diagnosticCollection.set(t,i)}}),Object.keys(this._diagnosticEntries).forEach(e=>{if(!t[e]){const t=l.Uri.file(e);this._diagnosticCollection.set(t,void 0)}}),this._diagnosticEntries=t}}_runScheduledActionOnResultsAvailable(){if(!this._runOnResultsAvailable)return;const e=T.activeTextEditor;if(!e)return;if(!this._session)return;const t=e.selection;if(!t||!t.end)return;const a=this._getDocumentFilePath(e.document);if(a&&this._session.openedDocuments[a]&&a===this._runOnResultsAvailable.filePath&&t.end===this._runOnResultsAvailable.selectionEnd)try{this._runOnResultsAvailable.action()}finally{delete this._runOnResultsAvailable}}copyExpressionPath(e){e&&e.copyExpressionPath()}copyExpressionData(e){e&&e.copyExpressionData()}goToExpressionSource(e){e&&e.data()&&e.data().expressionLocation&&this._navigate(e.data().expressionLocation.file,e.data().expressionLocation.loc)}openStartView(){w.createOrShow(this._context)}start(e,t){if(this._currentWallabyAppLocalUrl=this._wallabyAppLocalUrl,this._setContext("wallaby.hasAnyEnabledBreakpoints",L["wallaby.feature.debugger.breakpoints"].enabled&&!!this._getBreakpoints().length),!this._activeProjectRoot())return void T.showWarningMessage("Please open some folder/project before starting wallaby.js.");let a=this;if(this.stop(!1),this._reloadCoreClient(),!this._state.coreClient)return this._startWhenUpdated=!0,void a._showWallabyStartAfterUpdateWarning();if(delete this._startWhenUpdated,!this._configPath()&&(this._setActiveProjectRootAndConfig(void 0,!0),!this._configPath()))return void j._notifyHowToSelectConfig(this);v.saveAll(!1),this._consoleOutputChannelUsed&&(this._consoleOutputChannel.clear(),this._consoleOutputChannel.append(D));!this._context.globalState.get("wallaby:autostart:notification")&&l.workspace.getConfiguration().get("wallaby.startAutomatically",!0)&&(T.showWarningMessage("Please note: Wallaby.js is configured to start automatically if it was last running when your project was closed.","Update Setting to not Start Automatically").then(e=>{e&&l.workspace.getConfiguration().update("wallaby.startAutomatically",!1,!0)}),this._context.globalState.update("wallaby:autostart:notification",!0)),j._checkConfigurationSettings(),this._updateConfigurationFromSettings(),this._setProjectRunningState(!1);let i=this._session=new(this._tryGetSession());i.disposables=new h,i.filesToTrack=Object.create(null),i.openedDocuments=Object.create(null),i.suppressUncoveredResets=Object.create(null),i.uncoveredDisplayed=Object.create(null),i.projectCachePath=s.join(this._packagePath,"projects",j._hash(this._configPath())),i.start({env:this._env,localRoot:this._activeProjectRoot(),projectPath:i.projectCachePath,configPath:this._configPath(),testsPath:e,client:"VSCode",lkp:this._lkp,te:this._context.globalState.get("wallaby:te")}),i.on("started",e=>{i.editorDataEvent&&(this._firstInstall||w.showWhatsNewIfRequired(this._context).then(e=>{e&&i.editorDataEvent({event:"vscode.showWhatsNew",params:""})}),l.workspace.getConfiguration().get("wallaby.showStartViewOnFeatureRelease",!0)||i.editorDataEvent({event:"vscode.showStartViewOnFeatureRelease.false",params:""})),a._started=!0,delete a._starting,a._appendLineToConsoleOutputChannel(`${a._markupText("info","[Info]")} Started Wallaby.js Core v`+e.version),a._coreVersion=e.version,a._setFeatureContext(),i.setPreferences&&i.setPreferences({inspector:a._inspectorSettings}),a.emit("started",e),t&&t()}),i.on("stopped",e=>{a.stop(!1),e.deactivate&&a._forceDeactivate()}),i.on("expiredLicense",()=>{delete a._state.onFirstStart}),i.on("notification",e=>a.emit("notification",e)),i.on("busy",()=>{a._state.onFirstStart&&(a._state.onFirstStart(),delete a._state.onFirstStart),a._session&&a.emit("busy")}),i.on("copyToClipboard",e=>a.emit("copyToClipboard",e)),i.on("stats",e=>a.emit("stats",e)),i.on("activeTestFileCoverageChanged",e=>a.emit("activeTestFileCoverageChanged",e)),i.on("fileMessages",e=>a.emit("fileMessages",e)),i.on("inspections",e=>a.emit("inspections",e)),i.on("projectConfigured",e=>a.emit("projectConfigured",e)),i.on("filesToTrack",e=>a.emit("filesToTrack",i,e)),i.on("live",e=>a.emit("live",i,e)),i.on("documentUpdates",e=>a.emit("documentUpdates",i,e)),i.on("navigationRequested",e=>a._navigate(e.file,e.loc)),i.on("closeAllEditors",()=>a._closeAllEditors()),i.on("wallabyAppUrl",e=>a.emit("wallabyAppUrl",e.url)),i.on("testFilterToggled",e=>{a._setContext("wallaby.testFilterToggled",e.enabled),a._testFilterToggled=e.enabled,a._stats&&a._outputTestResults(this._failingTestsOutput,a._stats),a._updateStatus()}),i.on("traceNavigationReset",()=>this.stopTraceNavigation()),i.on("traceNavigated",e=>this._processTraceNavigation(e)),i.on("fileChanges",e=>this._processFileChanges(e)),i.on("traceTestSelectionRequested",e=>this._selectTestForDebugging(e)),i.on("testFilterTestSelectionRequested",e=>this._selectTestForFiltering(e)),i.on("testTimelineReset",()=>this._closeTestTimeline()),i.on("testRunSummary",e=>{a._processTestRunSummary(e)}),i.on("profileAvailable",e=>{l.commands.executeCommand("vscode.open",l.Uri.file(e.path),-2)}),i.on("consoleError",e=>e&&d.each(e.split("\n"),e=>e&&a._appendLineToConsoleOutputChannel(`${a._markupText("error","[Error] "+e.replace(/\u0000/g,""))}`))),i.on("consoleLog",e=>e&&d.each(e.split("\n"),e=>e&&a._appendLineToConsoleOutputChannel(`${a._markupText("info","[Info]")} ${e.replace(/\u0000/g,"")}`))),this._starting=!0,this.emit("starting"),a._updateStatus("progress"),this._valueExplorer.reset(this,i),this._traceExplorer.reset(this,i),this._testFileCoverageExplorer.reset(),i.disposables.add(l.debug.onDidChangeBreakpoints(()=>this._setContext("wallaby.hasAnyEnabledBreakpoints",L["wallaby.feature.debugger.breakpoints"].enabled&&!!this._getBreakpoints().length))),i.disposables.add(()=>{delete this._runOnResultsAvailable,d.each(T.visibleTextEditors,e=>{d.each(a._coverageDecorationTypes,t=>e.setDecorations(t,[])),a._hideAfterContentDecorationType&&e.setDecorations(a._hideAfterContentDecorationType,[]),a._destroyUncoveredDecorations(e),a._destroyStackTraceDecorations(e)})}),this._testExplorerSettings.enabled&&l.tests&&l.tests.createTestController&&L["wallaby.feature.testExplorer"]&&(i._testController=l.tests.createTestController("wallaby","Wallaby Test Run"),i.disposables.add(()=>{i._testController.dispose(),delete i._testController}),i._testController.resolveHandler=(e=>this._resolveTestControllerItem(e)))}_processTestRunSummary(e){try{if(!e||!e.files)return;const t="|||",a=[],i=[],s=[],o=[],n=[],r=[],c=[];this._session._testControllerItems={};const d=(e,r,l,c)=>{const h=[];l.forEach(r=>{const l=r.internalName||r.name,u=[...c,l],p=this._session._testController.createTestItem("wallaby."+u.join(t),r.name);h.push(p),r.line?(s.push(p.id),this._session._testControllerItems[p.id]={path:e,test:r}):(o.push(p.id),this._session._testControllerItems[p.id]={path:e}),r.tests?(r.errors&&r.errors.length&&(n.push(p.id),i.push({testItem:p,test:r})),d(e,p,r.tests,u)):a.push({testItem:p,test:r,path:e})}),r.children.replace(h)},h=e=>{let t;if(t=e.actual&&e.expected?l.TestMessage.diff(e.message,e.expected,e.actual):new l.TestMessage(e.message),this._testExplorerSettings.showErrorLocation)if(e.stack&&e.stack.length&&void 0!==e.stack[0].line&&void 0!==e.stack[0].column&&e.stack[0].path){const a=l.Uri.file(this._absoluteFilePath(e.stack[0].path));t.location=new l.Location(a,new l.Range(new l.Position(e.stack[0].line-1,e.stack[0].column),new l.Position(e.stack[0].line-1,e.stack[0].column)))}else t.location=new l.Location(leafNode.testItem.uri,leafNode.testItem.range);return t},u=[];e.files.forEach(e=>{if(!e.path)return;const t=this._session._testController.createTestItem("wallaby."+e.path,e.path);o.push(t.id),c.push(t.id),this._session._testControllerItems[t.id]={path:e.path,file:e},e.errors&&e.errors.length&&i.push({testItem:t,test:e}),d(e.path,t,e.tests,[e.path]),u.push(t)}),this._session._testController.items.replace(u);const p=this._session._testController.createTestRun(new l.TestRunRequest,"wallaby",!1);i.forEach(e=>{n.push(e.testItem.id),p.errored(e.testItem,e.test.errors.map(h),e.test.time)});a.forEach(e=>{e.test.errors.length?(n.push(e.testItem.id),e.test.errors.find(e=>e.snapshot)&&(r.push(e.testItem.id),r.find(t=>t==="wallaby."+e.path)||r.push("wallaby."+e.path)),p.failed(e.testItem,e.test.errors.map(h),e.test.time)):"executed"===e.test.status?p.passed(e.testItem,e.test.time):"skipped"!==e.test.status&&"todo"!==e.test.status||p.skipped(e.testItem)}),p.end(),this._setContext("wallaby.testingMenu.canGoToTest",s),this._setContext("wallaby.testingMenu.canGoToFile",o),this._setContext("wallaby.testingMenu.canUpdateSnapshot",r),this._setContext("wallaby.testingMenu.canGoToError",n),this._setContext("wallaby.testingMenu.isFile",c)}catch(e){console.error(e)}}_resolveTestControllerItem(e){return i(this,void 0,void 0,function*(){if(!e)try{this._session.requestTestRunSummary()}catch(e){console.error(e)}})}_appendLineToConsoleOutputChannel(e){this._consoleOutputChannel.appendLine(e),this._consoleOutputChannelUsed=!0}static _checkConfigurationSettings(){try{let e=l.workspace.getConfiguration();e&&!e.get("editor.glyphMargin",!0)&&T.showWarningMessage("Wallaby.js will not display coverage indicators because the `editor.glyphMargin` setting is set to `false`.")}catch(e){}}_selectTestForDebugging({tests:e,originalRequest:t}){T.showQuickPick(d.map(e,e=>{const t=e.testData,a=t.slice(1,t.length-1).join(" > ");let i=t[t.length-1];return{label:i=this._buildTestName(i,e.failing),description:a,detail:e.file,test:t}}),{matchOnDescription:!0,matchOnDetail:!0}).then(e=>e&&this._session&&this._session.runTests(Object.assign({initialTraceRun:!0,tests:[e.test]},t)))}_selectTestForFiltering({tests:e,file:t}){if(!e||!e.length)return;const a=e.map(e=>{const t=e.path,a=t.slice(1,t.length-1).join(" > ");let i=t[t.length-1];return{label:i=this._buildTestName(i,e.failing),description:e.toggled?"$(filter) "+a:a,detail:e.file,test:t}});T.showQuickPick(a,{matchOnDescription:!0,matchOnDetail:!0}).then(e=>e&&this._session&&this._session.toggleTestFilter({file:t,test:e.test}))}_updateConfigurationFromSettings(){try{let e=l.workspace.getConfiguration();if(e){this._suppressExpirationNotifications=e.get("wallaby.suppressExpirationNotifications",!1),this._alwaysOpenLocalWallabyUrl=e.get("wallaby.alwaysOpenLocalWallabyAppUrl",!1),this._failingTestsOutput&&this._failingTestsOutput.setContentLimit(e.get("wallaby.outputContentSize",0)),this._env=e.get("wallaby.env",{});const t=e.get("wallaby.compactMessageOutput",!1);this._failingTestsOutput.compactMessageOutput=t,this._lineTestsOutput.compactMessageOutput=t;let a=e.get("wallaby.node",""),i=e.get("wallaby.useWsl",!1);a&&(process.env.WALLABY_NODE=a),process.env.WALLABY_USE_WSL=i}}catch(e){}}stop(e){this._statusUpdateTimeout&&clearTimeout(this._statusUpdateTimeout),this._diagnosticCollection.clear(),e||this._setProjectRunningState(!1);let t=this._session;this._diagnosticEntries={},this._diagnosticCollection.clear(),delete this._started,delete this._starting,delete this._session,delete this._stats,t&&(t.disposables&&t.disposables.dispose(),t.stop(),delete t.filesToTrack,delete t.openedDocuments,delete t.disposables,this.emit("stopped"),this._appendLineToConsoleOutputChannel(`${this._markupText("info","[Info]")} Wallaby.js stopped`),this._outputTestResults(this._lineTestsOutput,""),this._valueExplorer.reset(),this._traceExplorer.reset(),this._testFileCoverageExplorer.reset(),this._failingTestsOutput.reset(),this._testsOutputEditor=null),this._onDidUpdateDocuments.fire(),this.closeInspector()}_readyForUse(){this._started||(this._coreVersion=this._state.coreVersion,this._setFeatureContext()),this._startWhenUpdated&&this.start()}_updateAvailable(e){this._started?e&&T.showInformationMessage("Wallaby has been updated. To use the updated version, you must restart Wallaby.",{title:"Restart Now",command:"now"},{title:"Restart Later",command:"later"}).then(e=>{e&&"now"===e.command&&this.start()}):this._readyForUse()}openFile(e){if(!e||!e.path)return;const t=this._absoluteFilePath(e.path);t&&T.showTextDocument(l.Uri.file(t)).then(t=>e.showCoverage&&this._showUncovered(t,void 0,!0))}toggleUncovered(){let e=T.activeTextEditor;if(!e)return;const t=this._getDocumentFilePath(e.document);let a=!!this._session.uncoveredDisplayed[t];this._destroyUncoveredDecorations(e),this._setContext("wallaby.uncoveredToggled",!1),a||this._showUncovered(e)}_destroyUncoveredDecorations(e){if(e&&(e.setDecorations(this._uncoveredRegionDecorationType,[]),this._session)){const t=this._getDocumentFilePath(e.document);t&&delete this._session.uncoveredDisplayed[t]}}_destroyStackTraceDecorations(e){if(e)try{e.setDecorations(this._activeTraceFrameDecorationType,[]),e.setDecorations(this._activeTraceCallStackFrameDecorationType,[]),e.setDecorations(this._activeTraceFrameWithNowhereToGoDecorationType,[])}catch(e){}}_destroyValueCallStackDecorations(e){if(e)try{e.setDecorations(this._activeValueCallStackFrameDecorationType,[])}catch(e){}}showLicense(){w.createOrShow(this._context,"activate")}processLicenseChange(e,t){if(d.isUndefined(e))return;let a=this;const i=a._tryGetUtils();if(!i)return void t({type:"error",text:"Wallaby.js is updating, you will be notified when the update is complete.",items:["Dismiss"]});let o="";try{o=JSON.parse(Buffer.from(n.readFileSync(this._ol).toString(),"base64").toString())}catch(e){o={}}let c="";try{c=n.readFileSync(a._lkp).toString()}catch(e){}if(/^[a-zA-Z0-9_+&*-]+(?:\.[a-zA-Z0-9_+&*-]+)*@(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,63}$/.test(e)){try{if(o.wallabyEmail=e.trim(),o.lastUpdate=(new Date).getTime(),n.writeFileSync(this._ol,Buffer.from(JSON.stringify(o)).toString("base64")),this._activeLicenseSession&&(this._activeLicenseSession.stop(),this._activeLicenseSession=null),this._reloadCoreClient(),!this._state.coreClient)return void t({type:"info",text:"Your email address will be confirmed when Wallaby.js is next started.",items:["Dismiss"]});const i=new(this._tryGetSession());i.stop=(()=>{i===this._activeLicenseSession&&(this._activeLicenseSession=null)}),i.start({localRoot:a._lkp,projectPath:a._lkp,configPath:a._lkp,client:"VSCode",lkp:this._lkp,ol:!0}),i.on("notification",e=>{t({type:"notification",text:e})}),this._activeLicenseSession=i}catch(e){t({type:"error",text:"Unable to save email activation request: "+e.message,items:[]})}return}try{n.unlinkSync(this._ol)}catch(e){}let h=c,u=e||"",p=!!a._parseLicenseKey(i,h),g=a._parseLicenseKey(i,u),m=!!g,y=!1;if(m||!u&&p)try{if(n.writeFileSync(a._lkp,u),g.isBundle){let e=s.join(r.homedir(),".quokka"),t=s.join(e,".qlc");n.existsSync(e)||n.mkdirSync(e),n.writeFileSync(t,u);let a=s.join(e,"config.json"),i={};try{let e=n.readFileSync(a).toString();i=JSON.parse(e)}catch(e){}i.pro=!0,n.writeFileSync(a,JSON.stringify(i)),l.commands.executeCommand("quokka.switchToPro").catch(e=>{})}y=m}catch(e){t({type:"error",text:"Error saving license key: "+e.message}),y=!1}else t({type:"error",text:"The entered license key is not a valid wallaby.js license key.",items:[]});y&&(t({type:"info",text:`Wallaby.js is licensed to: ${g.licensee}. Free upgrades until: ${g.expiration}`,items:[]}),a._state.licenseChanged({wasRunning:a._started||a._starting,hasEverStartedOnOpenedProject:a._projectRunningState()>=0,newKey:g,start:()=>a.start(),stop:()=>{(a._started||a._starting)&&(a.stop(!0),a._showWallabyStartAfterUpdateWarning())}}))}_showWallabyStartAfterUpdateWarning(){T.showWarningMessage("Wallaby.js is updating and will be started automatically when the update is complete.","Dismiss")}_showWallabyUpdatingWarning(){T.showWarningMessage("Wallaby.js is updating, you will be notified when the update is complete.","Dismiss")}_parseLicenseKey(e,t){if(d.isString(t))try{let a=e.parseKey(t);if(a.licenseeName&&a.expirationDateString&&(~a.licensedProduct.indexOf("(Freedom)")||~a.licensedProduct.indexOf("(VS Code)")))return{licensee:a.licenseeName,freeLicense:a.freeLicense,isBundle:0===a.licensedProduct.indexOf("Wallaby.js + Quokka.js"),expiration:a.expirationDateStringFormatted||a.expirationDateString}}catch(e){return}}_showUncovered(e,t,a){let i=this;if(!this._session)return;let s=e&&this._getDocumentFilePath(e.document);s&&(a||this._session.openedDocuments[s])&&(a&&(this._session.suppressUncoveredResets[s]=!0),this._setContext("wallaby.uncoveredToggled",!0),this._session.requestUncoveredRegions({file:s,line:t},t=>i._highlightUncovered(e,t.ranges)))}_highlightUncovered(e,t){const a=this._getDocumentFilePath(e.document);this._session.uncoveredDisplayed[a]=!0,e.setDecorations(this._uncoveredRegionDecorationType,d.map(t,e=>new l.Range(e[0]-1,e[1],e[2]-1,e[3])))}_jumpTo(e,t={}){let a=this;if(!this._session)return;const i=T.activeTextEditor;let s=t.file||i&&this._getDocumentFilePath(i.document),o=t.line||j._activeLine();this._session.requestLocation({file:s,line:o,type:e},e=>a._navigate(e.file,e.loc))}_runTests(e,t,a){if(!this._session)return;const i="initialTraceRun"===e;let s,o,n,r;if(t&&(d.isNumber(t)?s=t:(o=t.file,s=t.loc&&parseInt((t.loc+"").split(":")[0],10),r=i&&t.tests)),e.type&&(n=e.target,e=e.type),!o){const e=T.activeTextEditor;o=e&&this._getDocumentFilePath(e.document)}s||(s=("line"===e||i||"profileRun"===e)&&j._activeLine()),this._session.runTests({file:"project"!==e&&o,line:s,initialTraceRun:i,profileRun:"profileRun"===e?n:void 0,evaluateExpression:"valueLine"===e,tests:r,updateSnapshots:a})}static _activeLine(){const e=T.activeTextEditor;return e&&e.selection&&e.selection.active&&e.selection.active.line+1}static _notifyHowToSelectConfig(e){return T.showWarningMessage("Please select wallaby.js configuration file.",{title:"Select Wallaby.js Config File",command:()=>e.selectConfigFile()}).then(e._executeCommand)}_execute(e){if(e&&e.command)return"function"==typeof e.command?e.command(e):~e.command.indexOf("wallaby.")?l.commands.executeCommand(e.command):this[e.command]()}_getDocumentFilePath(e){const t=this._tryGetUtils();if(t&&"git"!==e.uri.scheme)return e.uri&&e.uri.fsPath&&this._relativeNormalizedFilePath(t,e.uri.fsPath)}_observeDocuments(e){let t=this;if(e.isDisposed())return;const a={};T.visibleTextEditors.forEach(t=>{if(!t||!t.document||!t.document.isDirty)return;if(a[t.document.fileName])return;if(a[t.document.fileName]=!0,t.document.uri&&t.document.uri.scheme&&"file"!==t.document.uri.scheme)return;const i=this._getDocumentFilePath(t.document);if(i){const a=t.document.getText();e.fileChangedInEditor(i,a,void 0)}}),e.disposables.add(T.onDidChangeVisibleTextEditors(t=>{t=b.editors(t),this._setContext("wallaby.inspectorOpened",!!t.length);const a=this._inspectorActive;t.length?(this._inspectorActive=!0,this._inspectorClearingHandle&&(clearTimeout(this._inspectorClearingHandle),delete this._inspectorClearingHandle),(!a||t.length>1)&&this._inspector.update(t,!0)):(this._inspectorActive=!1,a&&(this._inspectorClearingHandle&&(clearTimeout(this._inspectorClearingHandle),delete this._inspectorClearingHandle),this._inspectorClearingHandle=setTimeout(()=>{this._inspectorClearingHandle&&(clearTimeout(this._inspectorClearingHandle),delete this._inspectorClearingHandle),this._inspectorActive||e.removeInspections()},15e3)))})),e.disposables.add({dispose:()=>{this._inspectorClearingHandle&&(clearTimeout(this._inspectorClearingHandle),delete this._inspectorClearingHandle),delete this._inspectorActive}}),t._setOutputLanguage(T.visibleTextEditors);let i=!1;(t._testsOutputDocumentFileName||t._consoleOutputDocumentFileName)&&(t._ignoreLaggyOutputHack||(i=!t._testsOutputDocumentFileName&&t._consoleOutputDocumentFileName?t._consoleOutputDocumentFileName:!!t._testsOutputDocumentFileName)),t._testsOutputEditor&&t._revealFirstLineInTestOutputEditor(),e.disposables.add(T.onDidChangeVisibleTextEditors(e=>{t._setOutputLanguage(e),t._testsOutputEditor&&t._revealFirstLineInTestOutputEditor(),this._testTimelineContentProvider&&this._testTimelineContentProvider.uri()&&!this._anyVisibleTimelineEditors(e)&&this._testTimelineContentProvider.resetOpenedBesideMode()})),e.disposables.add(v.onDidChangeTextDocument(e=>{const a=e.document;if(a&&a.uri&&"output"===a.uri.scheme){if("Log"!==a.languageId||t._testsOutputDocumentFileName||t._consoleOutputDocumentFileName||(t._setOutputLanguage(T.visibleTextEditors),i||(i=!t._testsOutputDocumentFileName&&t._consoleOutputDocumentFileName?t._consoleOutputDocumentFileName:!!t._testsOutputDocumentFileName)),!t._ignoreLaggyOutputHack&&i&&(a.languageId===x||a.languageId===S)){let e=t._testsOutputChannel;i===t._consoleOutputDocumentFileName&&(e=t._consoleOutputChannel),i=!1,t._ignoreLaggyOutputHack=!0,e.hide(),e.show(!0)}t._testsOutputEditor&&t._testsOutputEditor.document===a&&t._revealFirstLineInTestOutputEditor()}})),e.disposables.add(v.onDidChangeTextDocument(a=>t._processDocumentContentChange(e,a.document,a.contentChanges))),this._processOpenedEditors(e),e.disposables.add(T.onDidChangeActiveTextEditor(a=>{if(e.previousActiveEditor=e.activeEditor,a){const i=t._getDocumentFilePath(a.document);e.activeEditor===a&&(e.filesWithSameEditorReActivated||(e.filesWithSameEditorReActivated=Object.create(null)),e.filesWithSameEditorReActivated[i]=!0),b.isMyEditor(a)||(e.activeEditor=a),e.activeFilePath=i,delete e.activeLineNumber,t._testTimelineContentProvider&&!t._testTimelineContentProvider.isClosing()&&(t._updateTimelineEditorIfRequired(a),t._highlightActiveTraceStepIfRequired(a,{reveal:!t._isTimelineViewer(a)}));const s=e.openedDocuments&&e.openedDocuments[i];t._setInlineValuesFileContext(s&&s.hasRemovableMessages)}t._setContext("wallaby.uncoveredDisplayed",!1),t._processOpenedEditors(e),t._displayStatusForActiveEditor(e)})),e.disposables.add(T.onDidChangeVisibleTextEditors(()=>t._processOpenedEditors(e))),e.disposables.add(()=>{delete e.activeEditor,delete e.previousActiveEditor,delete e.activeFilePath,delete e.activeLineNumber,this._closeTestTimeline(!0)}),e.disposables.add(T.onDidChangeTextEditorSelection(a=>t._handleEditorSelectionChange(e,a)))}_updateTimelineEditorIfRequired(e){if(this._isTimelineViewer(e))if(this._testTimelineContentProvider.isTimelineLoaded())this._testTimelineContentProvider.update(e);else if(this._traceExplorer.traceBeingNavigated()){const e=this._traceExplorer.lastActiveStep();this.showTestStory({before:e&&e.frame},!0,this._testTimelineContentProvider.openedBeside())}}_isTimelineViewer(e){if(this._testTimelineContentProvider)return e&&e.document&&e.document.uri&&"wallaby-test-timeline"===e.document.uri.scheme}_forEachVisibleTimelineEditor(e){return T.visibleTextEditors.filter(e=>this._isTimelineViewer(e)).forEach(e)}_visibleTimelineEditors(){return T.visibleTextEditors.filter(e=>this._isTimelineViewer(e))}_anyVisibleTimelineEditors(e){return!!(e||T.visibleTextEditors).find(e=>this._isTimelineViewer(e))}_closeTestTimeline(e){return i(this,void 0,void 0,function*(){if(this._testTimelineContentProvider){const t=this._testTimelineContentProvider.uri();if(this._testTimelineContentProvider.clear(this._visibleTimelineEditors()),t&&!this._testTimelineContentProvider.isClosing())try{this._testTimelineContentProvider.closing(),e&&(yield T.showTextDocument(t,{preserveFocus:!1}),yield new Promise(e=>setTimeout(()=>e(),100)),this._isTimelineViewer(T.activeTextEditor)&&(yield l.commands.executeCommand("workbench.action.closeActiveEditor")))}catch(e){}finally{this._testTimelineContentProvider.closed()}}})}_highlightActiveTraceStepIfRequired(e,{reveal:t=!1,onlyHighlightRangeInVisibleEditors:a=!0}){if(e&&this._traceExplorer.traceBeingNavigated()){const i=this._traceExplorer.lastActiveStep();if(i&&e.document){(this._getDocumentFilePath(e.document)===i.file||this._anyVisibleTimelineEditors())&&this._navigateWithTraceHighlight(i,this._activeTraceFrameDecorationType,{onlyHighlightRangeInVisibleEditors:a,reveal:t})}}}_handleEditorSelectionChange(e,t){if(t&&t.selections&&t.selections.length&&t.textEditor&&t.textEditor.document){clearTimeout(this._delayedShowErrorTimeout);const a=t.selections[0];if(e.activeLineNumber!==a.active.line){e.activeLineNumber=a.active.line;const t=e.activeLineNumber,i=e.openedDocuments[e.activeFilePath];this._setInlineValuesLineContext(i&&i.messages&&i.messages[t]&&i.messages[t].removable)}this._traceExplorer.traceBeingNavigated()&&(a.start.line===a.end.line&&a.start.character!==a.end.character||a.start.line===a.end.line-1&&0===a.end.character)&&this._showValue("show");const i=e.openedDocuments[e.activeFilePath];i&&i.errors&&i.errors[a.start.line]&&this._isLineTextSelection(t.textEditor.document,a)&&(this._traceExplorer.traceBeingNavigated()?this._showErrorOnDebuggerSelection&&this._showErrorWithDelay(a.start.line+1):this._showErrorOnSelection&&this._showErrorWithDelay(a.start.line+1))}}_showErrorWithDelay(e){const t=T.activeTextEditor;this._delayedShowErrorTimeout=setTimeout(()=>{T.activeTextEditor===t&&this.showError(e)},1e3)}_isLineTextSelection(e,t){const a=e.lineAt(t.start.line);if(a&&a.text&&a.text.length&&!a.isEmptyOrWhitespace&&!(t.start.character>a.firstNonWhitespaceCharacterIndex))return t.start.line===t.end.line&&t.end.character>=a.text.trimEnd().length||t.start.line===t.end.line-1&&0===t.end.character}_displayStatusForActiveEditor(e){let t=this;if(e.isDisposed())return t._updateStatusExtension();let a=T.activeTextEditor;if(!a)return t._updateStatusExtension();let i=t._getDocumentFilePath(a.document);if(!i)return;let s=e.openedDocuments[i];if(!s)return t._updateStatusExtension();s.coverage&&t._updateStatusExtension(s.coverage)}_processOpenedEditors(e){let t=this;if(e.isDisposed())return;let a=d.reduce(T.visibleTextEditors,(a,i)=>{if(i){let s=t._getDocumentFilePath(i.document);if(s&&e.filesToTrack[s]){let e=a[s];e||(e=a[s]=Object.create(null)),e[i.viewColumn]=!0}}return a},{});d.each(a,(t,a)=>{let i=d.keys(t).length,s=e.openedDocuments[a],o=i;if(s?0!==(o=i-s.editorCount)&&(s.editorCount=i):s=e.openedDocuments[a]={changes:[],path:a,editorCount:o},0!==o){let t=o>0?()=>e.fileOpenedInEditor(a):()=>e.fileClosedInEditor(a);for(let e=0,a=Math.abs(o);e<a;e++)t()}else(!d.isEqual(s.editors,t)||e.filesWithSameEditorReActivated&&e.filesWithSameEditorReActivated[a])&&(e.fileClosedInEditor(a),e.fileOpenedInEditor(a));s.editors=t}),d.each(e.openedDocuments,(t,i)=>{if(!a[i]){for(let a=0,s=t.editorCount;a<s;a++)e.fileClosedInEditor(i);delete e.openedDocuments[i]}}),delete e.filesWithSameEditorReActivated}_processDocumentContentChange(e,t,a){if(e.isDisposed())return;if(t&&t.uri&&t.uri.scheme&&"file"!==t.uri.scheme)return;let i=this._getDocumentFilePath(t),s=e.openedDocuments[i];s&&(s.changeTs=F++,s.changes=s.changes.concat(a),this._hideMessagesForChangedRanges(s.changes),this._onceDocumentStopsChanging(e,s,t))}_onceDocumentStopsChanging(e,t,a){!e.isDisposed()&&t.changes.length&&(e.fileChangedInEditor(t.path,a.getText(),{start:d.chain(t.changes).map(e=>e.range.start.line).min().value()+1,end:d.chain(t.changes).map(e=>e.range.end.line).max().value()+1}),t.changes=[],this._destroyUncoveredDecorations(T.activeTextEditor))}_updateStatus(e){let t=this,a=!1;if(this._statusUpdateTimeout&&clearTimeout(this._statusUpdateTimeout),delete this._statusUpdateTimeout,e||(e=d.isString(this._stats)?"failure":this._stats?this._stats.errors.length?"failure":"success":void 0),e){if("progress"===e)this._statusBar.displayProgress();else{this._statusBar.stopProgress();const i=t._traceExplorer.traceBeingNavigated()?"$(bug)   ":t._testFilterToggled?"$(filter)   ":"";if("failure"===e)t._statusBar.setMainText(`${i}✗                `);else{a=!0;const e=this._stats.totalNumber,s=this._stats.failingNumber,o=e-s-(this._stats.skippedNumber||0)-(this._stats.todoNumber||0);t._statusBar.setMainText(`${i}✗ ${d.pad(s||0,4," ","right")}`+` ✔ ${d.pad(o||0,4," ","right")}`)}this._stats&&this._stats.totalNumber&&this._setProjectRunningState(!0),t._statusBar.updateText()}this._statusBar.show()}a&&!t._hasValidStats?(t._setContext("wallaby.hasValidStats",!0),t._hasValidStats=!0):!a&&t._hasValidStats&&(t._setContext("wallaby.hasValidStats",!1),delete t._hasValidStats)}_updateStatusExtension(e){this._statusBar.setExtensionText(e||void 0),this._statusBar.updateText()}_continueTrial(){this._session&&this._session.continueTrial()}_openPurchasePage(){try{e("openurl2").open("https://wallabyjs.com/purchase")}catch(e){}}_openPhantomJsDocs(){try{e("openurl2").open("https://wallabyjs.com/docs/integration/phantomjs2.html")}catch(e){}}_openAutoConfigDocs(){try{e("openurl2").open("https://wallabyjs.com/docs/intro/config.html")}catch(e){}}_requestTrialLicense(){w.createOrShow(this._context,"trial")}_removeStatus(){this._statusBar.hide()}_updateDocuments(e,t){if(e.isDisposed())return;const a=this,i=F++;let s=t.hasRunError?i:void 0;const o=T.activeTextEditor&&a._getDocumentFilePath(T.activeTextEditor.document);e.activeFilePath=o;const n=T.activeTextEditor&&T.activeTextEditor.selection;let r=void 0,c=!1,h=!1;n&&n.active&&(r=n.active.line),d.each(T.visibleTextEditors,n=>{const u=n.document,p=a._getDocumentFilePath(n.document),g=e.openedDocuments[p]||{};delete g.coverage;const m=t[p];if(!m)return;if(this._session.suppressUncoveredResets[p]?delete this._session.suppressUncoveredResets[p]:this.resetUncovered(n),!m.lines)return;m.isAffectedByGlobalErrors&&!s&&(s=i),g.createTs=g.createTs?g.createTs:i,g.updateTs=i,g.errorTs=s?g.errorTs?g.errorTs:s:void 0,g.messages=Object.create(null),g.errors=Object.create(null),g.testDeclarations=Object.create(null),g.testMatchSnapshotCalls=Object.create(null),g.hasRemovableMessages=!1,m.coverage&&d.isNumber(m.coverage.value)&&(g.coverage=`${m.coverage.value}%`);const y={};if(d.each(a._coverageDecorationTypes,(e,t)=>{y[t]=[]}),m.fileMarkersInvalid)for(let e=0;e<6;e++)delete y[1e3+e],delete y[1100+e],delete y.error,delete y.systemLog,delete y.userLog;else if(m.lastRun){if(!a._runOnSaveIndicators)return;m.lines=m.lastRun.lines}if(d.each(m.lines,e=>{const t=e.num-1;if(t<0||t>=u.lineCount)return;const i=u.lineAt(t);if(!i)return;let s;const n=e.meta||{};e.decl?(g.testDeclarations[i.lineNumber]={filtered:n.filtered,snap:n.snap,debugged:n.debugged},s=4!=e.state||e.err?e.state:0):s=e.state;const c=e.err&&e.snap?a._snapshotFailedInlineMessage:e.err||e.log,d=e.longLog||e.err||e.log;if(c||d){const t={range:new l.Range(i.lineNumber,i.firstNonWhitespaceCharacterIndex,i.lineNumber,i.range.end.character)},u=4===s?"error":n.system||n.log&&n.log.system?"systemLog":"userLog";if(y[u].push(t),d&&(t.hoverMessage=l.MarkdownString?new l.MarkdownString("```\n"+d+"\n```"):d),c){if(e.log){const t=n.log&&n.log.removable;g.messages[i.lineNumber]={removable:t,inspected:e.inspected},t&&(p===o&&i.lineNumber===r&&(h=!0),g.hasRemovableMessages=!0)}e.err&&(g.errors[i.lineNumber]={snap:e.snap,diff:n.error&&n.error.diff,source:n.error&&n.error.source}),a._hideAfterContentDecorationType&&(t.renderOptions={after:{contentText:"  "+j._escapeInlineMessage(c)}})}}e.snap&&(s+=100),y[s]&&!m.lastRun&&y[s].push({range:new l.Range(i.lineNumber,i.firstNonWhitespaceCharacterIndex,i.lineNumber,i.range.end.character)}),a._runOnSave&&a._runOnSaveIndicators&&y[s+1e3]&&y[s+1e3].push({range:new l.Range(i.lineNumber,i.firstNonWhitespaceCharacterIndex,i.lineNumber,i.range.end.character)}),e.snap&&(g.testMatchSnapshotCalls[i.lineNumber]=!0)}),this._uncoveredCoverageIndicator){if(!this._coverageDecorationTypes.uncovered){new l.ThemeColor("editorCodeLens.foreground");this._coverageDecorationTypes.uncovered=this._createGutterDecorationType("uncovered",!1,!1),y.uncovered=[]}const e=new Array(u.lineCount).fill(!0);d.each(y,(t,a)=>{t.forEach(t=>{e[t.range.start.line]=!1})});e.forEach((e,t)=>{if(e){const e=u.lineAt(t);if(!e)return;y.uncovered.push({range:new l.Range(e.lineNumber,e.firstNonWhitespaceCharacterIndex,e.lineNumber,e.range.end.character)})}})}d.each(y,(e,t)=>n.setDecorations(a._coverageDecorationTypes[t],e)),a._scheduleHiddenMessagesDisplay(),p===o&&g.hasRemovableMessages&&(c=!0),!g.errorTs&&g.provideLenses&&(!g.changeTs||g.changeTs<g.updateTs)&&g.provideLenses()}),this._setInlineValuesLineContext(h),this._setInlineValuesFileContext(c),this._onDidUpdateDocuments.fire()}static _escapeInlineMessage(e){return j._cssEscape(e).replace(/'/g,'"')}_hideMessagesForChangedRanges(e){this._hideAfterContentDecorationType&&(clearTimeout(this._displayHiddenMessagesTimeout),this._messagesHiddenAt=+new Date,T.activeTextEditor&&T.activeTextEditor.setDecorations(this._hideAfterContentDecorationType,e.map(e=>({range:new l.Range(e.range.start.line,0,e.range.end.line,Number.MAX_SAFE_INTEGER)}))))}_scheduleHiddenMessagesDisplay(){if(!this._hideAfterContentDecorationType)return;let e=this;clearTimeout(this._displayHiddenMessagesTimeout);let t=this._messagesHiddenAt?+new Date-this._messagesHiddenAt:400;this._displayHiddenMessagesTimeout=setTimeout(()=>{try{d.each(T.visibleTextEditors,t=>t.setDecorations(e._hideAfterContentDecorationType,[]))}catch(e){}},Math.max(0,500-t))}navigate(e){return i(this,void 0,void 0,function*(){if(e)if(e.file&&e.side){if(T.visibleTextEditors.find(t=>t.document&&this._getDocumentFilePath(t.document)===e.file))return void(yield this._navigate(e.file,e.loc));const t=T.activeTextEditor;let a=t?t.viewColumn-1:0;a=0===a?l.ViewColumn.Beside:a,yield this._navigate(e.file,e.loc,{reveal:!0,focus:!0,select:!0,viewColumn:a})}else yield this._navigate(e.file,e.loc);else{const e=T.activeTextEditor;e&&b.isMyEditor(e)&&e.selection&&e.selection.active&&(yield this._inspector.navigate(e.selection.active,e=>i(this,void 0,void 0,function*(){return yield this.navigate(e)})))}})}_closeAllEditors(){l.commands.executeCommand("openEditors.closeAll")}_navigate(e,t,{reveal:a=!0,focus:i=!0,select:s=!0,viewColumn:o}={reveal:!0,focus:!0,select:!0}){if(!e)return;let n,r,c=this._absoluteFilePath(e);return d.isNumber(t)?n=t:d.isArray(t)?(n=t[0],r=t[1]):d.isString(t)&&(t=t.split(":"),n=t[0]&&parseInt(t[0],10),r=t[1]&&parseInt(t[1],10)),d.isNumber(n)?n-=1:n=0,d.isNumber(r)||(r=0),o=o||(d.find(T.visibleTextEditors,t=>t&&t.document&&this._getDocumentFilePath(t.document)===e)||{}).viewColumn,v.openTextDocument(c).then(e=>T.showTextDocument(e,o,!i)).then(e=>{if(!a)return e;if(!r){const t=e.document&&e.document.lineAt(n);t&&(r=t.firstNonWhitespaceCharacterIndex)}let t=new l.Position(n,r);return e.revealRange(new l.Range(t,t),2),s?(e.selection=new l.Selection(t,t),e):e})}_relativeConfigPath(){return this._configPath()&&s.relative(this._activeProjectRoot(),this._configPath())}_absoluteFilePath(e){return this._configFolderPath()&&s.resolve(this._configFolderPath(),e)}_relativeNormalizedFilePath(e,t,a){return(a||this._configFolderPath())&&e.normalizePath(s.relative(a||this._configFolderPath(),t))}_configByConvention(){let e=this;if(!this._activeProjectRoot())return;return[{path:s.join(this._activeProjectRoot(),"node_modules","@jest","core","package.json"),majorVersion:24,minorVersion:0,revisionVersion:0},{path:s.join(this._activeProjectRoot(),"node_modules","@angular","cli","package.json"),majorVersion:8,minorVersion:2,revisionVersion:0}].find(e=>{if(n.existsSync(e.path))try{const t=JSON.parse(n.readFileSync(e.path).toString()),[a,i,s]=t.version.split("."),o=parseInt(a),r=parseInt(i),l=parseInt(s);if(o>e.majorVersion)return!0;if(o===e.majorVersion&&r>e.minorVersion)return!0;if(o===e.majorVersion&&r===e.minorVersion&&l>e.revisionVersion)return!0}catch(e){}return!1})?s.join(e._activeProjectRoot(),"auto.detect"):d.chain(["wallaby.js","wallaby.conf.js",".wallaby.js",".wallaby.conf.js","wallaby.json",".wallaby.json"]).map(t=>s.join(e._activeProjectRoot(),t)).find(e=>n.existsSync(e)).value()}_setInlineValuesLineContext(e){e=!!e,this._previousInlineValuesLineContext!==e&&(this._previousInlineValuesLineContext=e,this._setContext("wallaby.lineHasRemovableInlineValues",e))}_setInlineValuesFileContext(e){e=!!e,this._previousInlineValuesFileContext!==e&&(this._previousInlineValuesFileContext=e,this._setContext("wallaby.fileHasRemovableInlineValues",e))}_setContext(e,t){l.commands.executeCommand("setContext",e,t)}_buildTestName(e,t,a,i){if(a&&"executed"!=a){let t="";if(i&&(t="todo"===a?"todo ":"skipped"===a?"skipped ":""),"todo"===a)return"$(clock)  "+t+e;if("skipped"===a)return"$(dialog-warning)  "+t+e}return t?"$(chrome-close)  "+e:"$(check)  "+e}_setOutputLanguage(e){let t;for(const a of e){const e=a.document;if(e&&e.uri&&"output"===e.uri.scheme){if(this._testsOutputDocumentFileName){if(e.fileName===this._testsOutputDocumentFileName){t=a,e.languageId!==x&&l.languages.setTextDocumentLanguage(e,x);break}}else if(this._doesStartWithOutputPrefix(e,k)){this._testsOutputDocumentFileName=e.fileName,t=a,l.languages.setTextDocumentLanguage(e,x);break}if(this._consoleOutputDocumentFileName){if(e.fileName===this._consoleOutputDocumentFileName&&e.languageId!==S){l.languages.setTextDocumentLanguage(e,S);break}}else if(this._doesStartWithOutputPrefix(e,D)){this._consoleOutputDocumentFileName=e.fileName,l.languages.setTextDocumentLanguage(e,S);break}}}this._testsOutputEditor=t}_doesStartWithOutputPrefix(e,t){if(e.lineCount>0){const a=e.lineAt(0);if(a.text&&a.text.length&&~a.text.indexOf(t))return!0}return!1}_detectTestsOutputEditor(e){this._testsOutputEditor=e.find(e=>e.document.fileName===this._testsOutputDocumentFileName)}_revealFirstLineInTestOutputEditor(){const e=this._testsOutputEditor.document;if(e&&e.lineCount>1){const t=e.lineAt(0).firstNonWhitespaceCharacterIndex,a=new l.Position(0,t);this._testsOutputEditor.revealRange(new l.Range(a,a),3),this._testsOutputEditor.selection=new l.Selection(a,a)}}_outputTestResults(e,t){e.build(t,this._testFilterToggled),e.render()}_markupText(e,t){let a=[j._markupStartToken(e)||"",j._markupEndToken(e)||""];return`${a[0]}${t}${a[1]}`}static _markupStartToken(e){const t=P[e];return d.isObject(t)?t.start:t}static _markupEndToken(e){const t=P[e];return d.isObject(t)?t.end:t}static _hash(e){return o.createHash("md5").update(e).digest("hex").substr(0,16)}static _cssEscape(e){const t=String(e),a=t.length;let i,s=-1,o="";const n=t.charCodeAt(0);for(;++s<a;)(i=t.charCodeAt(s))>=1&&i<=31||127==i||0==s&&i>=48&&i<=57||1==s&&i>=48&&i<=57&&45==n?o+="\\"+i.toString(16)+" ":o+=i>=128||45==i||95==i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?t.charAt(s):"\\"+t.charAt(s);return o}}t.exports=j},{"./compositeDisposable":3,"./outputInspector":5,"./screenshotContentProvider":6,"./startViewPanel":7,"./testFileCoverageExplorer":8,"./testTimelineContentProvider":9,"./testsOutputBuilder":10,"./traceExplorer":11,"./tutorial":12,"./valueExplorer":13,crypto:void 0,events:void 0,"fs-extra":void 0,lodash:void 0,openurl2:void 0,os:void 0,path:void 0,vscode:void 0}],5:[function(e,t,a){"use strict";var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const s=e("vscode"),o=e("os"),n=e("./compositeDisposable"),r=e("./testsOutputBuilder"),l={header:Array(6).join("​"),shortcut:Array(5).join("‍"),link:"​",error:" ",code:" ",string:"‌",diff:{delete:"‍",insert:"⁠"}},c="wallaby-inspector",d=o.EOL,h=s.Uri.parse("wallaby-inspector:Output Inspector");class u{constructor(e){this._resolveDmp=e,this._disposables=new n,this._reset(),this._contentProvider=new p,this._disposables.add(s.workspace.registerTextDocumentContentProvider(c,this._contentProvider)),this._opacityMultiplier=s.workspace.getConfiguration().get("wallaby.dimmedTextOpacity",50)}static get uri(){return h}static isMyEditor(e){return e&&e.document&&e.document.uri&&e.document.uri.scheme===h.scheme}static editor(e){return e.find(u.isMyEditor)}static editors(e){return e.filter(u.isMyEditor)}build(e,t){if(t=t||[],this._disposed)return;let a=0;this._reset();const i=this._lines;if(this._initialize(),e)i.set(a++,{text:`${l.header}There are currently no output fragments, ${l.header}${l.shortcut}Shift + Esc${l.shortcut}${l.header} to close the window${l.header}`}),i.set(a++,{text:`${l.header}Output fragments are removed when you use debug actions${l.header}`});else if(t.length){if(s.workspace.getConfiguration().get("wallaby.outputInspectorFeature.showDocHeader",!0)){i.set(a++,{text:`${l.shortcut}Shift + Esc${l.shortcut}${l.header} to close the window, ${l.header}${l.shortcut}F12${l.shortcut}${l.header} to navigate to code,${l.header}`,navigate:()=>s.commands.executeCommand("wallaby.toggleInspectorFocus")}),i.set(a++,{text:`${l.shortcut}Del${l.shortcut}${l.header} or ${l.header}${l.shortcut}Backspace${l.shortcut}${l.header} to remove output fragment${l.header}`,navigate:()=>s.commands.executeCommand("wallaby.toggleInspectorFocus")});const e=`${l.link}Open Inspector Settings${l.link}`,o=`${l.link}Don't Show the Header Again${l.link}`,n=" | ";this._links.push({range:new s.Range(a,0,a,e.length),target:s.Uri.parse("command:workbench.action.openSettings?"+encodeURIComponent(JSON.stringify("wallaby output inspector")))}),this._links.push({range:new s.Range(a,e.length+n.length,a,e.length+n.length+o.length),target:s.Uri.parse("command:wallaby.suppressShowingInspectorDocHeader?"+encodeURIComponent(JSON.stringify([t])))}),i.set(a++,{text:`${e}${n}${o}`})}this._addDecorator(this._separatorDecoratorType,{range:new s.Range(a,0,a,1),renderOptions:this._itemSeparatorDecoratorRenderOptions}),i.set(a++,{text:""});for(const e of t){for(const t of e.errors){this._attachNavigation(t),this._addErrorMenuLenses(a,t,e),a=this._addDiff(a,t,e),i.set(a++,{inspectionId:e.id,text:l.error,navigate:t.navigate});for(const s of(t.formattedMessage&&t.formattedMessage.header.content||t.message).split(/\r\n|\r|\n/))i.set(a++,{inspectionId:e.id,text:s,navigate:t.navigate});if(i.set(a++,{inspectionId:e.id,text:l.error,navigate:t.navigate}),t.formattedMessage){const s="raw"===t.formattedMessage.body.format?l.string:l.code;i.set(a-1,{inspectionId:e.id,text:l.error+s,navigate:t.navigate});for(const s of t.formattedMessage.body.content.split(/\r\n|\r|\n/))i.set(a++,{inspectionId:e.id,text:s,navigate:t.navigate});i.set(a++,{inspectionId:e.id,text:s,navigate:t.navigate})}a=this._addStackTrace(a,t,e),this._addDecorator(this._separatorDecoratorType,{range:new s.Range(a,0,a,1),renderOptions:this._itemSeparatorDecoratorRenderOptions}),i.set(a++,{inspectionId:e.id,text:"",navigate:t.navigate})}for(const t of e.logs){this._attachNavigation(t),this._addLogMenuLenses(a,t,e);const o="raw"===t.format?l.string:l.code;i.set(a++,{inspectionId:e.id,text:o,navigate:t.navigate});for(const s of t.message.split(/\r\n|\r|\n/))i.set(a++,{inspectionId:e.id,text:`${s}`,navigate:t.navigate});i.set(a++,{inspectionId:e.id,text:o,navigate:t.navigate}),a=this._addStackTrace(a,t,e),this._addDecorator(this._separatorDecoratorType,{range:new s.Range(a,0,a,1),renderOptions:this._itemSeparatorDecoratorRenderOptions}),i.set(a++,{inspectionId:e.id,text:"",navigate:t.navigate})}}}else i.set(a++,{text:`${l.header}There are currently no output fragments, ${l.header}${l.shortcut}Shift + Esc${l.shortcut}${l.header} to close the window${l.header}`});const o=Array.from(i.keys()).map(e=>parseInt(e)).sort((e,t)=>e>t?1:t>e?-1:0);this._content=o.map(e=>i.get(e).text).join(d)}update(e,t){if(!this._disposed&&e.length&&this._inialized){if(this._content!==this._contentProvider.provideTextDocumentContent()){let a;const i=s.workspace.onDidChangeTextDocument(o=>{const n=o.document;if(n&&n.uri&&n.uri.scheme===c&&(i.dispose(),a&&clearTimeout(a),this._applyDecorators(e),t))for(const t of e)t.selection=new s.Selection(0,0,0,0)});this._contentProvider.updateTextDocumentContent(this._content),a=setTimeout(()=>i.dispose(),5e3)}else t&&this._applyDecorators(e);for(const t of e)t.options.lineNumbers=s.TextEditorLineNumbersStyle.Off,t.document.languageId!==c&&s.languages.setTextDocumentLanguage(t.document,c)}}navigate(e,t){return i(this,void 0,void 0,function*(){if(this._disposed)return;const a=this._lines.get(e.line);a&&(a.locate&&(yield t(a.locate(e))),a.navigate&&(yield a.navigate()))})}reset(e){this._reset(),this.update(e,!0)}execute(e,t){const a=this._lines.get(e);void 0!==a&&void 0!==a.inspectionId&&t(a.inspectionId)}dispose(){this._disposed||(this._disposables.dispose(),this._disposed=!0)}_reset(){this._lines=new Map,this._decorators=new Map,this._lenses=[],this._links=[],this._content=""}_applyDecorators(e){for(const t of e){const e=this._decorators.get(this._separatorDecoratorType)||[];t.setDecorations(this._separatorDecoratorType,e);const a=this._decorators.get(this._codeDecoratorType)||[];t.setDecorations(this._codeDecoratorType,a)}}_addDecorator(e,t){let a=this._decorators.get(e);a||(a=[],this._decorators.set(e,a)),a.push(t)}_addLogMenuLenses(e,t,a){this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Remove",tooltip:"Remove",command:"wallaby.deleteInspection",arguments:[a.id]})),this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Reveal in Value Explorer",tooltip:"Reveal in Value Explorer",command:"wallaby.revealValue",arguments:[this._getTarget(t)]})),t.test&&(this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Debug test",tooltip:"Debug test",command:"wallaby.debugTest",arguments:[{file:t.test.file,loc:t.test.loc}]})),this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Go to test",tooltip:"Go to test",command:"wallaby.navigate",arguments:[{file:t.test.file,loc:t.test.loc}]})));const i=this._getTarget(t);i&&(i.side="left",this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Go to code",tooltip:"Go to code",command:"wallaby.navigate",arguments:[i]})))}_addErrorMenuLenses(e,t,a){this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Remove",tooltip:"Remove",command:"wallaby.deleteInspection",arguments:[a.id]})),(t.actual||t.expected)&&this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Show side-by-side diff",tooltip:"Show side-by-side diff ",command:"vscode.diff",arguments:[...r.diffCommandArguments(t.expected,t.actual)]})),t.test&&(this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Debug test",tooltip:"Debug test",command:"wallaby.debugTest",arguments:[{file:t.test.file,loc:t.test.loc}]})),this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Go to test",tooltip:"Go to test",command:"wallaby.navigate",arguments:[{file:t.test.file,loc:t.test.loc}]})));const i=this._getTarget(t);if(i&&(i.side="left",this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Go to error",tooltip:"Go to error",command:"wallaby.navigate",arguments:[i]})),t.snapshot&&i.loc)){let t=0;if(_.isNumber(i.loc))t=i.loc;else if(_.isString(i.loc)){const e=i.loc.split(":");t=e[0]&&parseInt(e[0],10)}if(t){const a={file:i.file,line:t};this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Go to snapshot",tooltip:"Go to snapshot",command:"wallaby.jumpToSnapshot",arguments:[a]}))}}t.snapshot&&t.test&&this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:"Update test snapshots",tooltip:"Update test snapshots",command:"wallaby.updateTestSnapshots",arguments:[{file:t.test.file,loc:t.test.loc}]}))}_addDiff(e,t,a){const i=t.actual,o=t.expected;if(!i&&!o)return e;const n=()=>s.commands.executeCommand("vscode.diff",...r.diffCommandArguments(o,i)),c=this._resolveDmp();if(!c)return e;const d="wsDiffIns",h="weDiffIns",u="wsDiffDel",p="weDiffDel";let g=c[c.diff_prettyCompactHtml?"diff_prettyCompactHtml":"diff_prettyHtml"](c.diff_wordMode(o,i)).replace(/&para;<br>/g,"\n").replace(/<br>/g,"\n").replace(/<span class="dots">\.\.\.<\/span>/g,"...").replace(/<\/?span[^>]*>/g,"").replace(/<ins[^>]*>/g,d).replace(/<del[^>]*>/g,u).replace(/<\/ins[^>]*>/g,h).replace(/<\/del[^>]*>/g,p).replace(/style="background:#e6ffe6;"/g,"").replace(/style="background:#ffe6e6;"/g,"").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&gt;/g,">"),m=0,y=0;this._lines.set(e++,{inspectionId:a.id,text:"",navigate:t.navigate});for(let t of g.split(/\r\n|\r|\n/))if(t){m>0&&(t=l.diff.insert+t),y>0&&(t=l.diff.delete+t),m+=(t.match(new RegExp(d,"g"))||[]).length-(t.match(new RegExp(h,"g"))||[]).length,y+=(t.match(new RegExp(u,"g"))||[]).length-(t.match(new RegExp(p,"g"))||[]).length,m>0&&(t+=l.diff.insert),y>0&&(t+=l.diff.delete),t=t.replace(new RegExp(d,"g"),l.diff.insert).replace(new RegExp(h,"g"),l.diff.insert).replace(new RegExp(u,"g"),l.diff.delete).replace(new RegExp(p,"g"),l.diff.delete),this._lines.set(e++,{inspectionId:a.id,text:t,navigate:n})}else this._lines.set(e++,{inspectionId:a.id,text:"",navigate:n});return e}_getOpacity(e){if(50===this._opacityMultiplier)return e.toFixed(2);if(this._opacityMultiplier<50){const t=e;return Math.max(0,e-t*(50-this._opacityMultiplier)/50).toFixed(2)}{const t=1-e;return Math.min(1,e+t*(this._opacityMultiplier-50)/50).toFixed(2)}}_addStackTrace(e,t,a){if(t.test){const a=t.test;let i=a.path&&_.last(a.path)||"",o=_.initial(a.path||[]).join(" ");o.length&&(o+=" ");let n=`${o}${i}`.replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ");n=`${n}`,this._lenses.push(new s.CodeLens(new s.Range(e,0,e,0),{title:n,tooltip:n,command:"wallaby.navigate",arguments:[{file:a.file,loc:a.loc,side:"left"}]}))}const i=this._lines;for(const o of t.stack){const t=o.context?`at ${o.context}`:"at",n=`${o.file}${this._displayLocation(o.loc)}`,r={file:o.file,loc:o.loc,side:"left"},c=()=>s.commands.executeCommand("wallaby.navigate",r);if(this._links.push({range:new s.Range(e,t.length+2,e,t.length+n.length+2),target:s.Uri.parse("command:wallaby.navigate?"+encodeURIComponent(JSON.stringify(r)))}),i.set(e++,{inspectionId:a.id,text:`${t}${l.link} ${n} ${l.link}`,navigate:c}),this._addDecorator(this._separatorDecoratorType,{range:new s.Range(e,0,e,1),renderOptions:this._codeSeparatorDecoratorRenderOptions}),o.code){i.set(e++,{inspectionId:a.id,text:`${l.code}`,navigate:c});const t=o.code.maxLineNumber.toString().length,n=e=>`${" ".repeat(t-e.toString().length)}${e}`;for(const t of o.code.lines)this._addDecorator(this._separatorDecoratorType,{range:new s.Range(e,0,e,1),renderOptions:{before:{contentText:n(t.number),color:this._subtleTextColor,opacity:this._getOpacity(.6)}}}),t.coveredRanges&&(t.coveredRanges.length||this._addDecorator(this._codeDecoratorType,{range:new s.Range(e,0,e,t.content.length)})),i.set(e++,{inspectionId:a.id,text:t.content,locate:e=>({file:o.file,loc:`${t.number}:${e.character}`,side:"left"})});this._addDecorator(this._separatorDecoratorType,{range:new s.Range(e,0,e,1),renderOptions:this._codeSeparatorDecoratorRenderOptions}),i.set(e++,{inspectionId:a.id,text:`${l.code}`,navigate:c})}}return e}_locationArray(e){let t,a;return _.isNumber(e)?t=e:_.isArray(e)?(t=e[0],a=e[1]):_.isString(e)&&(t=(e=e.split(":"))[0]&&parseInt(e[0],10),a=e[1]&&parseInt(e[1],10)),[t,a]}_displayLocation(e){if(!e)return"";let[t,a]=this._locationArray(e);return`:${t}${_.isNumber(a)?":"+(a+1):""}`}_attachNavigation(e){const t=this._getTarget(e);t&&(t.side="left",e.navigate=(()=>s.commands.executeCommand("wallaby.navigate",t)))}_getTarget(e){if(e.stack&&e.stack.length>=1){const t=e.stack[0];return{file:t.file,loc:t.loc}}}_initialize(){if(!this._inialized){const e=this;this._inialized=!0,this._subtleTextColor=new s.ThemeColor("editorCodeLens.foreground"),this._separatorDecoratorType=s.window.createTextEditorDecorationType({rangeBehavior:s.DecorationRangeBehavior.ClosedOpen,textDecoration:"none",before:{height:"100%",margin:"0 26px 0 0"}}),this._itemSeparatorDecoratorRenderOptions={after:{contentText:" ".repeat(100),color:this._subtleTextColor,opacity:this._getOpacity(.5),border:"solid",borderWidth:"0 0 1px 0"}},this._codeSeparatorDecoratorRenderOptions={after:{contentText:"…",color:this._subtleTextColor,opacity:this._getOpacity(.5)}},this._codeDecoratorType=s.window.createTextEditorDecorationType({rangeBehavior:s.DecorationRangeBehavior.ClosedOpen,textDecoration:"none",opacity:this._getOpacity(.3)}),this._disposables.add(s.languages.registerDocumentLinkProvider({language:c},{provideDocumentLinks:()=>e._links})),this._disposables.add(s.languages.registerCodeLensProvider([c],{provideCodeLenses:t=>e._lenses}))}}}class p{constructor(){this._content="",this._onDidChange=new s.EventEmitter}get onDidChange(){return this._onDidChange.event}updateTextDocumentContent(e){this._content=e,this._onDidChange.fire(h)}provideTextDocumentContent(){return this._content}}t.exports=u},{"./compositeDisposable":3,"./testsOutputBuilder":10,os:void 0,vscode:void 0}],6:[function(e,t,a){"use strict";let i=e("vscode"),s=e("path");t.exports=class{constructor(e){this._onDidChange=new i.EventEmitter,this._screenshotUriResolver=e,this._screenShotUri=i.Uri.parse("wallaby-screenshot://authority/wallaby-screenshot"),this._panel=void 0}display(){const e=()=>{try{i.commands.executeCommand("vscode.previewHtml",i.Uri.parse("wallaby-screenshot://authority/wallaby-screenshot"),i.ViewColumn.Two)}catch(e){}};if(!this._panel)try{if(!i.window.createWebviewPanel)return void e();this._panel=i.window.createWebviewPanel("wallabyJsScreenshot","Wallaby Last Screenshot",i.ViewColumn.Two,{localResourceRoots:[i.Uri.file(s.dirname(this._screenshotUriResolver()))]})}catch(t){return void e()}this._panel.onDidDispose(()=>{this._panel=void 0}),this.updateDisplay()}updateDisplay(){this._panel.webview.html=this.provideTextDocumentContent()}provideTextDocumentContent(){let e;try{e=this._screenshotUriResolver()}catch(e){return""}return`<!DOCTYPE html>\n            <html>\n            <head>\n            </head>\n            <body>\n                <img src="${this._panel.webview.asWebviewUri(i.Uri.file(e)).toString()}?ts=${+new Date}" />\n            </body>\n            </html>`}get onDidChange(){return this._onDidChange.event}update(){this._onDidChange.fire(this._screenShotUri),this._panel&&this.updateDisplay()}}},{path:void 0,vscode:void 0}],7:[function(e,t,a){"use strict";var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const s=e("vscode"),o=e("util"),n=e("path"),r=e("fs"),l=e("os"),c=e("./tutorial"),d=new Date(Date.UTC(2021,4,6,0,0,0,0)),h=new Date(Date.UTC(2021,4,20,0,0,0,0));class u{constructor(e,t){let a,i;this._disposables=[],this._panel=e,this._context=t,this._extensionUri=t.extensionUri,this._pendingMessages=[],this._initialized=!1,this._panel.iconPath=s.Uri.file(t.asAbsolutePath("media/logo.svg")),this._load();const o=()=>{clearTimeout(a),a=setTimeout(()=>{try{const e=r.statSync(c.getStateFilePath());i||(i=e.mtime),e.mtime!==i&&(this._updateTutorialProgress(),i=e.mtime)}catch(e){}finally{o()}},2e3)};this._disposables.push({dispose(){clearTimeout(a)}}),o()}static setController(e){u.controller=e}static showWhatsNewIfRequired(e,t){return i(this,void 0,void 0,function*(){if(!s.workspace.getConfiguration().get("wallaby.showStartViewOnFeatureRelease",!0)&&!t)return!1;try{const a=s.Uri.joinPath(e.extensionUri,"media","index.html"),i=new o.TextDecoder("utf8").decode(yield s.workspace.fs.readFile(a)),n=/data-whats-new-version=["|'](\d+)["|']/gm,r=[...i.matchAll(n)],l=Math.max(...r.map(e=>{const[,t]=e;return parseInt(t,10)}));if(l>u._getWhatsNewVersion()){if(!t)return u.createOrShow(e,"whatsnew"),!0;u._saveWhatsNewVersion(l),u.currentSaleDiscount()&&u._updateStartPageMemo({saleStartPageShown:d.getTime()})}}catch(e){console.log(e)}return!1})}static createOrShow(e,t){const a=s.window.activeTextEditor?s.window.activeTextEditor.viewColumn:void 0;if(u.currentPanel)return u.currentPanel._panel.reveal(a),void u.currentPanel._processAction(e,t);const i=s.window.createWebviewPanel(u.viewType,"Wallaby",a||s.ViewColumn.One,{enableScripts:!0,localResourceRoots:[s.Uri.joinPath(e.extensionUri)]});u.currentPanel=new u(i,e),u.currentPanel._processAction(e,t)}_processAction(e,t){if(t)switch(t){case"activate":u.currentPanel.activateLicense();break;case"trial":u.currentPanel.requestTrial();break;case"whatsnew":u.currentPanel.showWhatsNew(),u.currentPanel._panel.title="Wallaby: What's New";break;case"scrollToTop":u.currentPanel.scrollToTop();break;case"firstInstall":u.showWhatsNewIfRequired(e,!0)}}static revive(e,t){u.currentPanel&&u.currentPanel.dispose(),u.currentPanel=new u(e,t)}activateLicense(){this._pendingMessages.push({command:"activateLicense"}),this.processPendingMessages()}requestTrial(){this._pendingMessages.push({command:"requestTrial"}),this.processPendingMessages()}showWhatsNew(){this._pendingMessages.push({command:"showWhatsNew",previousWhatsNewVersion:1,coreVersion:1}),this.processPendingMessages()}scrollToTop(){this._pendingMessages.push({command:"scrollToTop"}),this.processPendingMessages()}_updateTutorialProgress(){this._pendingMessages.push({command:"updateTutorialProgress",tutorial:c.getState()}),this.processPendingMessages()}static showSaleIfRequired(e){if(u.currentSaleDiscount()){if(u._getStartPageMemo().saleStartPageShown===d.getTime())return;u.createOrShow(e,"scrollToTop"),u._updateStartPageMemo({saleStartPageShown:d.getTime()})}}processPendingMessages(){if(this._initialized){const e=this._pendingMessages;this._pendingMessages=[],e.forEach(e=>{this._panel.webview.postMessage(e)})}}static currentSaleDiscount(e){e=e||u.getLicenseDetails();if(["trialDemoOver","trialLicense","demoLicense"].find(t=>t===e.state)){if(u._getStartPageMemo().saleDismissed===d.getTime())return;const e=new Date;if(e>=d&&e<=h){const t=6048e5,a=[{from:d.getTime(),discount:25},{from:d.getTime()+t,discount:20}].sort((e,t)=>t.from-e.from).reduce((t,a)=>t||(e.getTime()>a.from?a:void 0),void 0);if(a)return a.discount}}}_load(){this._update().then(()=>{this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.onDidChangeViewState(e=>{this._panel.visible?this._update():this._initialized=!1},null,this._disposables);const e=e=>{const t=s.workspace.getConfiguration().inspect(e);return void 0!==t.globalValue?t.globalValue:t.defaultValue};this._panel.webview.onDidReceiveMessage(t=>{switch(t.command){case"requestInitialState":this._initialized=!0;const a=e("wallaby.startAutomatically"),i=e("wallaby.codeLensFeature.runTest"),o=e("wallaby.codeLensFeature.debugger"),n=e("wallaby.codeLensFeature.testStory"),r=e("wallaby.codeLensFeature.profiler"),l=e("wallaby.codeLensFeature.testFilters"),h=e("wallaby.codeLensFeature.updateSnapshots"),p=e("wallaby.reportFailuresAsProblems"),g=e("wallaby.startViewStatusBar"),m=e("wallaby.compactMessageOutput"),y=e("wallaby.showStartViewOnFeatureRelease"),_=e("wallaby.suppressExpirationNotifications"),w=s.workspace.getConfiguration().get("wallaby.codeLens",!0),b=u.controller&&u.controller.allCommandsHint(),f=u.controller&&u.controller.coreVersion(),v=u.getLicenseDetails();this._panel.webview.postMessage({command:"initialState",settings:{startAutomatically:a,codeLens:w,codeLensRunTest:i,codeLensDebugger:o,codeLensTestStory:n,codeLensProfiler:r,codeLensTestFilters:l,codeLensUpdateSnapshots:h,reportFailuresAsProblems:p,startViewStatusBar:g,compactMessageOutput:m,showStartViewOnFeatureRelease:y,suppressExpirationNotifications:_},licenseDetails:v,allCommandsShortcut:b,coreVersion:f,whatsNewVersion:u._getWhatsNewVersion(),tutorial:c.getState()}),this.processPendingMessages();const T=u.currentSaleDiscount(v);return void(T&&this._panel.webview.postMessage({command:"sale",discount:T}));case"updateSetting":s.workspace.getConfiguration().update("wallaby."+t.setting,t.value,s.ConfigurationTarget.Global);break;case"otherSettings":s.commands.executeCommand("workbench.action.openSettings","wallaby");break;case"openTutorial":s.commands.executeCommand("wallaby.openTutorial");break;case"trialRequest":this._requestTrialLicense(t.email);break;case"activateLicense":this._activateLicense(t);break;case"updateWhatsNewVersion":u._saveWhatsNewVersion(t.version);break;case"dismissSale":u._updateStartPageMemo({saleDismissed:d.getTime()});break;case"log":console.log(t)}},null,this._disposables)})}_activateLicense({email:e,key:t}){if(!u.controller)return void this._panel.webview.postMessage({command:"activationError",message:"Wallaby.js is updating; cannot activate until update is complete."});const a=new Date;let i=!1;u.controller.processLicenseChange(e||t,e=>{if(!i){i=!0;const t=new Date-a,s=e=>t<500?setTimeout(e,500-t):e();"notification"===e.type&&(e=e.text),"info"===e.type||"warning"===e.type?s(()=>this._panel.webview.postMessage({command:"activationSuccess",message:e.text,licenseDetails:u.getLicenseDetails()})):s(()=>this._panel.webview.postMessage({command:"activationError",message:e.text}))}}),e&&setTimeout(()=>{i||(i=!0,this._panel.webview.postMessage({command:"activationError",message:"A timeout occurred while attempting to validate your email address."}))},25e3)}_requestTrialLicense(t){const a=e("https"),i=JSON.stringify({email:t,type:"wallaby",referrer:"wsp"}),s={hostname:"x55r2pae4l.execute-api.us-east-1.amazonaws.com",port:443,path:"/Prod/bc88894221b34ae4adac5c39a51547a2",method:"POST",headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(i)}},o=a.request(s,e=>{200===e.statusCode?this._panel.webview.postMessage({command:"trialRequestSuccess"}):this._panel.webview.postMessage({command:"trialRequestError"})});o.on("error",e=>{this._panel.webview.postMessage({command:"trialRequestError"}),console.error(e)}),o.write(i),o.end()}static _getStartPageMemo(){const e=n.join(l.homedir(),".wallaby"),t=n.join(e,"startPage.json");try{return JSON.parse(Buffer.from(r.readFileSync(t).toString()))}catch(e){return{}}}static _updateStartPageMemo(e){const t=n.join(l.homedir(),".wallaby"),a=n.join(t,"startPage.json");try{const t=Object.assign(Object.assign({},u._getStartPageMemo()),e);r.writeFileSync(a,JSON.stringify(t))}catch(e){console.error(e)}}static _getWhatsNewVersion(){return u._getStartPageMemo().version||0}static _saveWhatsNewVersion(e){u._updateStartPageMemo({version:e})}static getLicenseDetails(){const e=n.join(l.homedir(),".wallaby"),t=n.join(e,"key.lic"),a=n.join(e,".ol"),i={state:"demoLicense",productType:"",registeredTo:"",expiryDate:"",email:"",daysUntilExpiry:"",isBundle:!1,upgradeUrl:"https://wallabyjs.com/purchase/?referrer=wsp#select-wallaby",purchaseUrl:"https://wallabyjs.com/purchase/?referrer=wsp#select-wallaby",renewUrl:"https://wallabyjs.com/purchase/?referrer=wsp#select-wallaby"};try{const e=JSON.parse(Buffer.from(r.readFileSync(a).toString(),"base64").toString());i.email=e.wallabyEmail||"",i.registeredTo=i.email,i.onlineLicense=!!e.wallabyEmail,i.state="activating"}catch(e){}try{const e=r.readFileSync(t).toString().split(":").reduce((e,t)=>t.trim());if(e.length<50){if(!i.onlineLicense)try{parseInt(e,10)+1314e6<+new Date&&(i.state="trialDemoOver")}catch(e){i.state="trialDemoOver"}}else{const t=Buffer.from(e,"base64").toString().split("\n"),[a,s,,,o,n]=t[1].split(",");i.registeredTo=t[0],i.email=i.email||a,i.isBundle=!!~s.indexOf("Quokka.js");const r=!!~s.toLowerCase().indexOf("company")||!!~s.toLowerCase().indexOf("enterprise"),l=!!~s.indexOf("Open Source"),c="wallabyjs@gmail.com"===a||"1"===n;i.isBundle?i.productType="Wallaby.js + Quokka.js":i.productType="Wallaby.js";const[d,h,p]=t[2].split("/");i.expiryDate=d+" "+u.monthNames[parseInt(h,10)-1]+", "+p;let g=!1;if(l)i.state="openSource";else{const t=new Date(Date.UTC(p,parseInt(h,10)-1,d)),a=new Date,s=Math.floor((t.getTime()-a.getTime())/864e5);i.daysUntilExpiry=`${s} day${1===s?"":"s"}`,s<0?c?i.state="trialDemoOver":(i.state="expired",i.key=e,g=!0):s<=14?c?i.state="trialLicense":(i.state="expiring",i.key=e,g=!0):c?i.state="trialLicense":(i.state="activated",i.key=e,g=!0)}g&&!r&&(r?(i.purchaseUrl="https://wallabyjs.com/store/company/?referrer=wsp#select-wallaby",o?(i.upgradeUrl=`https://wallabyjs.com/store/personal/?renewalOrder=${o}&upgrade=1&referrer=wsp`,i.renewUrl=`https://wallabyjs.com/store/personal/?renewalOrder=${o}&referrer=wsp`):(i.upgradeUrl="https://wallabyjs.com/store/company/?referrer=wsp#select-wallaby",i.renewUrl="https://wallabyjs.com/store/company/?referrer=wsp#select-wallaby")):(i.upgradeUrl=`https://wallabyjs.com/store/personal/?renewalEmail=${encodeURIComponent(a)}&upgrade=1&referrer=wsp`,i.renewUrl=`https://wallabyjs.com/store/personal/?renewalEmail=${encodeURIComponent(a)}&referrer=wsp`))}}catch(e){}return i}dispose(){for(u.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}_update(){return i(this,void 0,void 0,function*(){const e=this._panel.webview;this._panel.webview.html=yield this._getHtmlForWebview(e)})}_getHtmlForWebview(e){return i(this,void 0,void 0,function*(){const t=s.Uri.joinPath(this._extensionUri,"media","index.html"),a=new o.TextDecoder("utf8").decode(yield s.workspace.fs.readFile(t)),i={nonce:function(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<32;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),cspSource:e.cspSource,root:e.asWebviewUri(this._extensionUri).toString()};return Object.keys(i).reduce((e,t)=>e.replace(new RegExp(("${"+t+"}").replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),"g"),i[t]),a)})}}u.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],u.viewType="wallabyStartPage",t.exports=u},{"./tutorial":12,fs:void 0,https:void 0,os:void 0,path:void 0,util:void 0,vscode:void 0}],8:[function(e,t,a){"use strict";const i=e("vscode"),s=e("lodash");class o{constructor(e,t,a){this.iconPath=i.ThemeIcon.File,this.resourceUri=i.Uri.file(t.name),this.label=t.name+`${this._formatCodeCoverage(t.coverage)}`,this.description=`${t.dir}`,this.tooltip=`Open ${t.path}`,this.command={command:"wallaby.openFile",arguments:[{path:t.path,showCoverage:t.coverage&&t.coverage.low}]},this.collapsibleState=a?2:0,this._children=a}_formatCodeCoverage(e){return e?` | ${e.value}%${e.low?"  ⚠️":""}`:""}getChildren(){return this._children?this._children:[]}}class n{constructor(){this._onDidChangeTreeData=new i.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}getChildren(e){return e?e.getChildren():Promise.resolve(this._rootNodes||[])}}t.exports=class{constructor(e){this._context=e,this._treeDataProvider=new n,i.window.registerTreeDataProvider&&i.window.registerTreeDataProvider("wallaby.testFileCoverageExplorer",this._treeDataProvider)}reset(){this._treeDataProvider._rootNodes=[],this._treeDataProvider.refresh()}update(e){const t=s.first(e.testFiles);this._treeDataProvider._rootNodes=[],t&&(this._treeDataProvider._rootNodes=[new o(this._context,t.file,t.coveredFiles.map(e=>new o(this._context,e)))]),this._treeDataProvider.refresh()}}},{lodash:void 0,vscode:void 0}],9:[function(e,t,a){"use strict";var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const s=e("vscode");class o{constructor(e){this._absolutePathResolver=e,this._opacityMultiplier=s.workspace.getConfiguration().get("wallaby.dimmedTextOpacity",50),this._onDidChange=new s.EventEmitter,this._onDidChangeCodeLenses=new s.EventEmitter;const t=new s.ThemeColor("editorCodeLens.foreground");this._annotationDecorationType=s.window.createTextEditorDecorationType({rangeBehavior:s.DecorationRangeBehavior.ClosedOpen,textDecoration:"none",before:{height:"100%",margin:"0 26px 0 0"}}),this._subtleDecorationType=s.window.createTextEditorDecorationType({rangeBehavior:s.DecorationRangeBehavior.ClosedOpen,textDecoration:"none",opacity:this._getOpacity(.3)}),this._logDecorationType=s.window.createTextEditorDecorationType({isWholeLine:!0,light:{after:{color:"#0000ff"}},dark:{after:{color:"rgba(86, 156, 214, 1)"}}}),this._systemLogDecorationType=s.window.createTextEditorDecorationType({isWholeLine:!0,after:{color:t}}),this._errorDecorationType=s.window.createTextEditorDecorationType({isWholeLine:!0,light:{after:{color:"#c80000"}},dark:{after:{color:"#fe536a"}}}),this._lineNumberStyle={color:t,opacity:this._getOpacity(.6)},this._fileNameStyle={color:t,opacity:this._getOpacity(.5),fontWeight:"bold"},this._headerStyle=this._footerStyle={color:t,opacity:this._getOpacity(.5),border:"solid",borderWidth:"0 0 1px 0"},this._fileContentSeparatorStyle={color:t,opacity:this._getOpacity(.5)},this._content={},this._unlocked=!1}_getOpacity(e){if(50===this._opacityMultiplier)return e.toFixed(2);if(this._opacityMultiplier<50){const t=e;return Math.max(0,e-t*(50-this._opacityMultiplier)/50).toFixed(2)}{const t=1-e;return Math.min(1,e+t*(this._opacityMultiplier-50)/50).toFixed(2)}}get onDidChange(){return this._onDidChange.event}get onDidChangeCodeLenses(){return this._onDidChangeCodeLenses.event}_initialize(){this._initialized||(this._definitionProvider=s.languages.registerDefinitionProvider({scheme:"wallaby-test-timeline",language:"wallaby-timeline"},this),this._codeLensProvider||(this._codeLensProvider=s.languages.registerCodeLensProvider({scheme:"wallaby-test-timeline",language:"wallaby-timeline"},this)),this._changeRevealIfOpenSetting(),this._initialized=!0,this._unlocked=!1,s.commands.executeCommand("setContext","wallaby.testStoryUnlocked",this._unlocked))}changeLock(e,t){this._unlocked=!e,s.commands.executeCommand("setContext","wallaby.testStoryUnlocked",!e),this._unlocked&&(t.forEach(e=>{e.setDecorations(this._logDecorationType,[]),e.setDecorations(this._systemLogDecorationType,[])}),this._content&&this._content.codeLens&&(this._content.codeLens.forEach(e=>{e.command.title="The rest of the test story can not be viewed in a detached mode.",delete e.command.command}),this._onDidChangeCodeLenses.fire()))}unlocked(){return this._unlocked}clear(e){this._initialized&&!this._unlocked&&(this._definitionProvider.dispose(),delete this._content,delete this._showNewTimelineBeside,delete this._expectingTimelineLoad,e.forEach(e=>this._resetAllDecorations(e)),this._uri&&this._onDidChange.fire(this._uri),this._restoreRevealIfOpenSetting(),delete this._uri,delete this._initialized)}uri(){return this._uri}dispose(){this.clear([]),this._codeLensProvider&&(this._codeLensProvider.dispose(),delete this._codeLensProvider)}expectingTimelineLoad(){this._expectingTimelineLoad=!0}isExpectingTimelineLoad(){return this._expectingTimelineLoad}provideTextDocumentContent(){return this._providedTextDocumentContent=(this._content||{}).text||"",this._providedTextDocumentContent}provideDefinition(e,t){if(!this._content||this._updating||this._unlocked)return;const a=this._content.lines[t.line];return a&&a.file&&a.num?new s.Location(s.Uri.file(this._absolutePathResolver(a.file)),new s.Position(a.num-1,t.character)):void 0}provideCodeLenses(e){if(this._initialized&&(this._onCodeLensProvided&&(this._onCodeLensProvided(),delete this._onCodeLensProvided),this._content&&this._content.codeLens&&!this._updating))return this._content.codeLens}static prepareContentText(e){return e.replace(/ /g," ")}getLineByStep(e){if(this._content)return this._content.lineByStep[e]}getOriginalLocationByLine(e){if(!this._content||this._unlocked)return;const t=this._content.lines[e-1];if(!t||!t.file||!t.num)return;let a=t.step;if(!(a>=0))for(let t=e;t<this._content.lines.length&&!((a=this._content.lines[t].step)>=0);t++);return{file:t.file,line:t.num,step:a}}_changeRevealIfOpenSetting(){try{const e=s.workspace.getConfiguration();this._revealIfOpenSetting=(e.inspect("workbench.editor.revealIfOpen")||{}).globalValue,e.update("workbench.editor.revealIfOpen",!0,!0)}catch(e){}}_restoreRevealIfOpenSetting(){try{s.workspace.getConfiguration().update("workbench.editor.revealIfOpen",this._revealIfOpenSetting,!0),delete this._revealIfOpenSetting}catch(e){}}closing(){this._closing=new Promise(e=>{this._closed=e})}isClosing(){return!!this._closing}closed(){this._closed(),delete this._closing,delete this._closed}show(e,t){return i(this,void 0,void 0,function*(){try{if(!e)return;this._closing&&(t.length=0,yield this._closing);const a=!!t.length;if(this._content=this._generateDecoratedContent(e),this._initialize(),this._uri=s.Uri.parse("wallaby-test-timeline://authority/Test Story"),!t.length){yield this._updateTimelineDocument();const e={preview:!1};this._showNewTimelineBeside?(e.viewColumn=-2,e.preserveFocus=!0,this._openedBeside=!0):this.resetOpenedBesideMode();const a=yield s.window.showTextDocument(this._uri,e);delete this._showNewTimelineBeside,a.options.lineNumbers=s.TextEditorLineNumbersStyle.Off,s.languages.setTextDocumentLanguage(a.document,"wallaby-timeline"),this._viewColumnWhenOpened=a.viewColumn,t=[a]}yield Promise.all(t.map(e=>this._updateEditor(e,a)))}finally{delete this._expectingTimelineLoad}})}resetOpenedBesideMode(){delete this._openedBeside}openedBeside(){return this._openedBeside}viewColumnWhenOpened(){return this._viewColumnWhenOpened}_updateTimelineDocument(){return i(this,void 0,void 0,function*(){void 0!==this._providedTextDocumentContent&&this._content.text!==this._providedTextDocumentContent&&(yield new Promise(e=>{const t=s.workspace.onDidChangeTextDocument(i=>{i.document&&i.document.uri&&"wallaby-test-timeline"===i.document.uri.scheme&&(clearTimeout(a),t.dispose(),e())}),a=setTimeout(()=>{t.dispose(),e()},2e3);this._onDidChange.fire(this._uri)}))})}_updateEditor(e,t){return i(this,void 0,void 0,function*(){if(this._updating=!0,t){const e=new Promise(e=>{const t=setTimeout(()=>{e()},500);this._onCodeLensProvided=(()=>{clearTimeout(t),setImmediate(e)})});this._onDidChangeCodeLenses.fire(),yield e}yield this._updateTimelineDocument(),delete this._updating,this._onDidChangeCodeLenses.fire(),this._resetAllDecorations(e),this._updateDecorations(e)})}update(e){e.options.lineNumbers=s.TextEditorLineNumbersStyle.Off,this._updateDecorations(e)}isTimelineLoaded(){return!!this._content}_updateDecorations(e){if(!e)return;if(!e.document||!e.document.uri||"wallaby-test-timeline"!==e.document.uri.scheme)return;const t=this._content;t?(e.setDecorations(this._annotationDecorationType,t.annotationDecorations),e.setDecorations(this._subtleDecorationType,t.subtleDecorations),e.setDecorations(this._errorDecorationType,t.errorDecorations)):this._resetAllDecorations(e)}_resetAllDecorations(e){e.setDecorations(this._logDecorationType,[]),e.setDecorations(this._systemLogDecorationType,[]),e.setDecorations(this._errorDecorationType,[]),e.setDecorations(this._annotationDecorationType,[]),e.setDecorations(this._subtleDecorationType,[])}updateTimelineEditorInlineValueDecorations(e,t,a){if(this._unlocked)return;if(!e||!t)return;if(!e.document||!e.document.uri||"wallaby-test-timeline"!==e.document.uri.scheme)return;const i=this.getOriginalLocationByLine(t);if(!i)return;const o=a[i.file];if(!o||!o.lines||!o.lines.length)return;const n=o.lines.find(e=>e.num===i.line);if(!n)return;const r=e.document.lineAt(t-1);if(!r)return;const l={range:new s.Range(r.lineNumber,r.firstNonWhitespaceCharacterIndex,r.lineNumber,r.range.end.character)},c=n.log||"",d=n.longLog||c;d&&(l.hoverMessage=s.MarkdownString?new s.MarkdownString("```js\n"+d+"\n```"):d),l.renderOptions={after:{contentText:" ".repeat(2)+c}};const h=n.meta&&n.meta.system?this._systemLogDecorationType:this._logDecorationType;e.setDecorations(this._logDecorationType,[]),e.setDecorations(this._systemLogDecorationType,[]),c&&e.setDecorations(h,[l])}showNewTimelineBeside(e){e?this._showNewTimelineBeside=!0:delete this._showNewTimelineBeside}_generateDecoratedContent(e){const t=[],a=[],i=[],n=[];let r,l,c,d;const h=[],u={},p=()=>h.length-1,g=e.maxLineNumber.toString().length,m=" ".repeat(g),y=e=>{const a=p();t.push({range:new s.Range(a,0,a,1),renderOptions:{before:Object.assign({contentText:o.prepareContentText((e=>`${" ".repeat(g-e.toString().length)}${e}`)(e))},this._lineNumberStyle)}})},_=()=>{const e=p();t.push({range:new s.Range(e,0,e,1),renderOptions:{after:Object.assign({contentText:o.prepareContentText("…")},this._fileContentSeparatorStyle)}})},w=(e,t,o)=>{for(const n of t){const t=n.n||"",c=n.content?`${n.content}`:n.separator?"​​":" ",d={text:c,num:t,file:e};h.push(d),n.separator&&_();const g=p();if(n.executedLine){n.steps=n.steps||[o];for(const e of n.steps)u[e]=g;if(n.error){const e={range:new s.Range(g,0,g,c.length)},t=n.error;e.renderOptions={after:{contentText:" ".repeat(2)+t}},i.push(e)}d.step=n.steps[0],void 0===r&&(r=d.step),l=n.steps[n.steps.length-1]}if((!n.executedLine||n.contextRanges)&&!n.separator)if(n.contextRanges)for(const[e,t]of n.contextRanges)a.push({range:new s.Range(g,e,g,t)});else a.push({range:new s.Range(g,0,g,c.length)});y(t)}},b=e=>{h.push({text:"​"}),h.push({text:"​"});const a=p();t.push({range:new s.Range(a,0,a,1),renderOptions:{after:Object.assign({contentText:o.prepareContentText((e=>e)(e))},this._fileNameStyle),before:{contentText:o.prepareContentText(m)}}}),h.push({text:"​"})},f=()=>{h.push({text:"​"});const e=p();t.push({range:new s.Range(e,0,e,1),renderOptions:{after:Object.assign({contentText:o.prepareContentText(" ".repeat(100))},this._footerStyle)}})},v=()=>{h.push({text:"​"});const e=p();t.push({range:new s.Range(e,0,e,1),renderOptions:{after:Object.assign({contentText:o.prepareContentText(" ".repeat(100))},this._headerStyle)}})};e.truncatedStart&&(h.unshift({text:"​"}),c=new s.CodeLens(new s.Range(1,0,1,1),{title:"Load previous entries",command:"wallaby.showTestStory"}),v());for(const t of e.entries)t.file&&(b(t.file),t.hideable&&n.push(new s.CodeLens(new s.Range(h.length-2,0,h.length-2,1),{title:"Hide repeated entries like this",command:"wallaby.showTestStory",arguments:[{hide:t}]}))),w(t.file,t.lines,t.step),f();return e.truncatedEnd&&(h.push({text:" "}),h.push({text:" "}),d=new s.CodeLens(new s.Range(h.length-1,0,h.length-1,1),{title:"Load next entries",command:"wallaby.showTestStory"})),c&&(c.command.arguments=[{before:r}],n.push(c)),d&&(d.command.arguments=[{after:l}],n.push(d)),{lines:h,lineByStep:u,text:h.map(e=>e.text).join("\n"),annotationDecorations:t,subtleDecorations:a,errorDecorations:i,codeLens:n}}}t.exports=o},{vscode:void 0}],10:[function(e,t,a){"use strict";let i=e("vscode");const s=e("lodash"),o=e("path"),n=/^darwin/.test(process.platform),r=/^win/.test(process.platform),l={none:"",empty:Array(6).join("​"),link:Array(2).join("​"),error:{start:"",end:" "},duration:Array(4).join("​"),suite:Array(5).join("​"),string:{start:"",end:" "},diff:Array(7).join("​"),diffEllipsis:Array(4).join("​"),diffIns:Array(2).join("⁠"),diffDel:Array(2).join("‍"),tmpDiffIns:{start:"wsDiffIns",end:"weDiffIns"},tmpDiffDel:{start:"wsDiffDel",end:"weDiffDel"},linkNoStack:Array(2).join("​")},c=void 0!==i.env.remoteName,d="All tests covering the line of code:",h=" failing test",u=" passing",p=" skipped",g=" todo",m="Launch Coverage & Test Explorer",y="Search Tests",_="Reset Test Filter",w="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";class b{constructor(e,t,a,s,o,n,r,l,c,u,p){const g=this;this._lines=[],this._links=[],this._diffs=[],this._lineAndColumnLinks=o,this._contentLimit=204800,this._channel=e,this._absolutePathResolver=t,this._inExperimentalMode=p,this._channelPrefix=u||"",this._failingTestsOutput=n,this._tryGetDmp=a,this._timeEnd=" ms]​",this._sideBySideDiffSupported=l,this._wallabyAppLinkResolver=c,this._replaceApiAvailable=!0,i.languages.registerDocumentLinkProvider&&s.add(i.languages.registerDocumentLinkProvider(r,{provideDocumentLinks:e=>{const t=e.lineAt(0);return t&&t.text&&(g._failingTestsOutput&&~t.text.indexOf(h)||!g._failingTestsOutput&&~t.text.indexOf(d))?g._links:[]}}))}build(e,t){let a=this;if(a._lines=[],a._links=[],a._diffs=[],s.isString(e))a._appendLine(this._failingTestsOutput?"error":"string",0,e,this._failingTestsOutput&&"Error");else if(s.isObject(e)){const o=e.totalNumber,n=e.failingNumber,r=e.skippedNumber||0,l=e.todoNumber||0,c=o-n-r-l;if(this._failingTestsOutput){let s,o,d=this._markupStartToken("string")+n+h+(1===n?", ":"s, ")+c+u;r&&(s={start:(d+=", ").length},d+=r+p,s.end=d.length),l&&(o={start:(d+=", ").length},d+=l+g,o.end=d.length),d+=(e.additionalHeaderMessage?" "+e.additionalHeaderMessage:"")+this._markupEndToken("string")+" "+this._markupStartToken("link")+m+this._markupEndToken("link")+" | "+this._markupStartToken("link")+y+this._markupEndToken("link")+(t?" | "+this._markupStartToken("link")+_+this._markupEndToken("link"):"")+(e.errors&&e.errors.length?"\n":""),a._appendLine("none",0,d,void 0,void 0,e=>{e=a._channelPrefix+e;const t=a._lines.length;if(s){const e={skipped:!0};a._links.push({range:new i.Range(t,s.start+a._channelPrefix.length,t,s.end+a._channelPrefix.length),target:i.Uri.parse("command:wallaby.jumpToTest?"+JSON.stringify(e))})}if(o){const e={todo:!0};a._links.push({range:new i.Range(t,o.start+a._channelPrefix.length,t,o.end+a._channelPrefix.length),target:i.Uri.parse("command:wallaby.jumpToTest?"+JSON.stringify(e))})}~e.indexOf(m)&&a._links.push({range:new i.Range(t,e.indexOf(m),t,e.indexOf(m)+m.length),target:i.Uri.parse(this._wallabyAppLinkResolver())}),~e.indexOf(_)&&a._links.push({range:new i.Range(t,e.indexOf(_),t,e.indexOf(_)+_.length),target:i.Uri.parse("command:wallaby.resetTestFilter")}),~e.indexOf(y)&&a._links.push({range:new i.Range(t,e.indexOf(y),t,e.indexOf(y)+y.length),target:i.Uri.parse("command:wallaby.jumpToTest")})})}else a._appendLine("string",0,d,"");s.each(e.errors,e=>{a._outputError(e.message,e.formattedMessage,e.stack,e.expected,e.actual,e.snapshot),a._appendLine("none",0,"")}),s.each(e.tests,e=>a._outputTest(e))}}lines(){return this._lines}render(){let e=this,t=this._channelPrefix;for(let e=0,a=this._lines.length;e<a;e++){if((t+=this._lines[e]+"\n").length>this._contentLimit){t+="\n--- output truncated to "+this._contentLimit+' bytes (use the "wallaby.outputContentSize" user setting to change the bytes limit) ---\n';break}}if(this._channel.replace&&this._replaceApiAvailable)try{this._channel.replace(t.replace(/\u0000/g,""))}catch(e){this._channel.clear(),this._channel.append(t.replace(/\u0000/g,"")),this._replaceApiAvailable=!1}else e._channel.clear(),e._channel.append(t.replace(/\u0000/g,""))}show(){this._channel.hide(),this._channel.show(!0)}setContentLimit(e){e&&(this._contentLimit=e)}reset(){this._lines=[],this._links=[],this._diffs=[]}static diffCommandArguments(e,t){const a={};switch(i.workspace.getConfiguration().get("wallaby.diffViewPosition","Default")){case"Default":break;case"Active":a.viewColumn=i.ViewColumn.Active;break;case"Beside":a.viewColumn=i.ViewColumn.Beside}return[i.Uri.parse("wallaby-diff:data?"+Buffer.from(e).toString("base64")),i.Uri.parse("wallaby-diff:data?"+Buffer.from(t).toString("base64")),"Expected vs Actual",a]}createErrorMarkdown({expected:e,actual:t,snapshot:a,stack:s,test:l},{file:c,line:d}){const h=[];(e||t)&&this._sideBySideDiffOutputLink(e,t,a,d,0,h);let u="",p=!1;if(l&&(u=`[Debug test](${i.Uri.parse("command:wallaby.debugTest?"+encodeURIComponent(JSON.stringify({tests:l.path&&[l.path],file:c,loc:d})))})`,c!==l.file&&(u+=w+`[Go to test](${i.Uri.parse("command:wallaby.jumpToFailingTest?"+encodeURIComponent(JSON.stringify({file:c,line:d})))})`)),(u+=(u?w:"")+`[Show error details](${i.Uri.parse("command:wallaby.showError?"+encodeURIComponent(JSON.stringify(d)))})`)&&(h.length?h[0]+=w+u+"\n":h.push(u+"\n")),(e||t)&&(p=!0,h.push("***"),h.push("```wallaby-tests"),this._diffOutput(e,t,0,h),h.push("```")),s&&s.length>1){p||(p=!0,h.push("***"));for(let e of s)if(h.push(`${n?"⎯⎯⎯⎯":r?"⎯⎯":"⸺"} at ${e.context?"**"+b._escapeHtml(e.context)+"** ":""}[\`${o.basename(e.file)}${this._displayLocation(e.loc)}\`](${i.Uri.parse(i.Uri.file(this._absolutePathResolver(e.file)).toString()+this._location(e.loc))})\n`),e.contextCodeLine){e.contextCodeLine.trimStart()&&(h.push("```wallaby-error"),h.push(`​${n?"   ":r?"   ":"    "}${e.contextCodeLine.trimStart()}​\n`),h.push("```"))}}return h.join("\n")}static _escapeHtml(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}_markupStartToken(e){const t=l[e];return s.isObject(t)?t.start:t}_markupEndToken(e){const t=l[e];return s.isObject(t)?t.end:t}_sideBySideDiffOutputLink(e,t,a,s,o,n){if(e=e||"",t=t||"",o=o||0,this._sideBySideDiffSupported){let r="\nShow side-by-side diff",l=i.Uri.parse("command:wallaby.showSideBySideDiff?"+JSON.stringify({id:this._diffs.push({expected:e,actual:t})-1,failingTestsOutput:this._failingTestsOutput}));const c="Update snapshot";let d=i.Uri.parse("command:wallaby.updateTestSnapshots?"+JSON.stringify(s));const h=a&&s;n?i.MarkdownString&&(r=`[Show side-by-side diff](${l})`,h&&(r+=`${w}[${c}](${d})`),this._appendLine("linkNoStack",o,r,void 0,void 0,void 0,n)):this._appendLine("linkNoStack",o,r+(h?`  ${c}`:""),void 0,void 0,(e,t)=>{const a=this._lines.length;this._links.push({range:new i.Range(a,t,a,t+r.length-1),target:l}),h&&this._links.push({range:new i.Range(a,t+r.length+1,a,t+r.length+c.length+1),target:d})})}}getDiffData(e){return this._diffs[e]}_updateSnapshotOutputLink(e,t){const a=i.Uri.parse("command:wallaby.updateTestSnapshots?"+JSON.stringify(e));this._appendLine("linkNoStack",t,"Update snapshots\n",void 0,void 0,(e,t)=>{const s=this._lines.length;this._links.push({range:new i.Range(s,t,s,t+"Update snapshots\n".length-1),target:a})})}_diffOutput(e,t,a,i){e=e||"",t=t||"",a=a||0;const s=this._tryGetDmp();if(!s)return;let o=s[s.diff_prettyCompactHtml?"diff_prettyCompactHtml":"diff_prettyHtml"](s.diff_wordMode(e,t)).replace(/&para;<br>/g,"\n").replace(/<br>/g,"\n").replace(/<span class="dots">\.\.\.<\/span>/g,this._markupStartToken("diffEllipsis")+"..."+this._markupEndToken("diffEllipsis")).replace(/<\/?span[^>]*>/g,"").replace(/<ins[^>]*>/g,this._markupStartToken("tmpDiffIns")).replace(/<del[^>]*>/g,this._markupStartToken("tmpDiffDel")).replace(/<\/ins[^>]*>/g,this._markupEndToken("tmpDiffIns")).replace(/<\/del[^>]*>/g,this._markupEndToken("tmpDiffDel")).replace(/style="background:#e6ffe6;"/g,"").replace(/style="background:#ffe6e6;"/g,"").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&gt;/g,">"),n=0,r=0;this._appendLine("diff",a,o,void 0,void 0,e=>{if(!e)return e;n>0&&(e=this._markupStartToken("diffIns")+e),r>0&&(e=this._markupStartToken("diffDel")+e);let t=(e.match(new RegExp(this._markupStartToken("tmpDiffIns"),"g"))||[]).length,a=(e.match(new RegExp(this._markupEndToken("tmpDiffIns"),"g"))||[]).length;n+=t-a;let i=(e.match(new RegExp(this._markupStartToken("tmpDiffDel"),"g"))||[]).length,s=(e.match(new RegExp(this._markupEndToken("tmpDiffDel"),"g"))||[]).length;return r+=i-s,n>0&&(e+=this._markupEndToken("diffIns")),r>0&&(e+=this._markupEndToken("diffDel")),e.replace(new RegExp(this._markupStartToken("tmpDiffIns"),"g"),this._markupStartToken("diffIns")).replace(new RegExp(this._markupEndToken("tmpDiffIns"),"g"),this._markupEndToken("diffIns")).replace(new RegExp(this._markupStartToken("tmpDiffDel"),"g"),this._markupStartToken("diffDel")).replace(new RegExp(this._markupEndToken("tmpDiffDel"),"g"),this._markupEndToken("diffDel"))},i)}_outputError(e,t,a,i,o,n,r){let l=this;r=r||0,this._tryGetDmp()&&(i||o?(this._sideBySideDiffOutputLink(i,o,n,a&&a.length&&a[0],r),l._appendLine("none",0,""),this._diffOutput(i,o,r)):n&&this._updateSnapshotOutputLink(a&&a.length&&a[0],r)),t?(this._appendLine("error",r,t.header.content),this._appendLine("raw"===t.body.format?"string":"none",r,t.body.content)):this._appendLine("error",r,e),s.each(a,e=>l._outputLink(e,r+1))}_outputTest(e){let t=this,a=e.path&&s.last(e.path)||"",o=s.initial(e.path||[]).join(" ");o.length&&(o+=" ");let n=`${this._markupStartToken("suite")}`+`${o}${a}`.replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ")+`${this._markupEndToken("suite")}`,r=s.isNumber(e.time)?"["+e.time+this._timeEnd:"";const l=` |${this._markupStartToken("link")} Open test story${this._markupEndToken("link")}`,d=this.compactMessageOutput?"":"\n";t._appendLine("none",1,""),t._appendLine("none",1,`${n} ${this._markupStartToken("duration")}${r}${this._markupEndToken("duration")}${this._markupStartToken("link")} Debug test${this._markupEndToken("link")}${l}`,void 0,void 0,(a,s)=>{const o=t._lines.length;t._links.push({range:new i.Range(o,s,o,s+n.length),target:c?i.Uri.parse("command:wallaby.navigate?"+encodeURIComponent(JSON.stringify({file:e.file,loc:e.loc}))):i.Uri.parse(i.Uri.file(t._absolutePathResolver(e.file)).toString()+t._location(e.loc))}),t._links.push({range:new i.Range(o,a.lastIndexOf(" Debug test")+1,o,a.lastIndexOf(" Debug test")+" Debug test".length),target:i.Uri.parse("command:wallaby.debugTest?"+encodeURIComponent(JSON.stringify({file:e.file,loc:e.loc,tests:e.tests})))}),t._links.push({range:new i.Range(o,a.lastIndexOf(" Open test story")+1,o,a.lastIndexOf(" Open test story")+" Open test story".length),target:i.Uri.parse("command:wallaby.debugTest?"+encodeURIComponent(JSON.stringify({file:e.file,loc:e.loc,tests:e.tests,showTimeline:!0})))})}),s.each(e.errors,(e,a)=>{const i=0===a?"\n":d;return e.formattedMessage&&(e.formattedMessage.header.content=i+e.formattedMessage.header.content,e.formattedMessage.body.content=d+e.formattedMessage.body.content),t._outputError(i+e.message,e.formattedMessage,e.stack,e.expected,e.actual,e.snapshot,2)}),e.messages&&e.messages.length&&(t._appendLine("string",2,"\nFrom console:"),s.each(e.messages,(e,a)=>(t._appendLine("raw"===e.format?"string":"none",3,(0===a?"\n":d)+e.text),t._outputLink(e,3))))}_outputLink(e,t){let a=this;if(e.file){const s=e.file+this._displayLocation(e.loc);this._appendLine("link",t,s,void 0,e.context,(t,o)=>{const n=a._lines.length;a._links.push({range:new i.Range(n,o,n,o+s.length),target:c?i.Uri.parse("command:wallaby.navigate?"+encodeURIComponent(JSON.stringify({file:e.file,loc:e.loc}))):i.Uri.parse(i.Uri.file(a._absolutePathResolver(e.file)).toString()+a._location(e.loc))})})}}_location(e){let[t,a]=this._locationArray(e);return"#"+(this._lineAndColumnLinks&&s.isNumber(a)?`${t},${a+1}`:t)}_locationArray(e){let t,a;return s.isNumber(e)?t=e:s.isArray(e)?(t=e[0],a=e[1]):s.isString(e)&&(t=(e=e.split(":"))[0]&&parseInt(e[0],10),a=e[1]&&parseInt(e[1],10)),[t,a]}_displayLocation(e){if(!e)return"";let[t,a]=this._locationArray(e);return`:${t}${s.isNumber(a)?":"+(a+1):""}`}_appendLine(e,t,a,i,o,n,r){let l=this,c=a.split(/\r\n|\r|\n/);o&&o.replace&&(o=o.replace(/\r\n\s*/g," ").replace(/\n\s*/g," "));let d=[this._markupStartToken(e)||"",this._markupEndToken(e)||""];s.each(c,(a,h)=>{const u=(i?`[${i}] `:"")+s.pad("",2*t,"   ")+("link"===e?this._markupStartToken("empty")+"at "+(o?o+" ":"")+this._markupEndToken("empty"):"")+("diff"===e?0===h?d[0]:"":d[0]);let p=u+a+("diff"===e?"":d[1]);if(n){const e=n(p,u.length);e&&(p=e)}"diff"===e&&(p+=h===c.length-1?d[1]:""),(r||l._lines).push(p)})}}t.exports=b},{lodash:void 0,path:void 0,vscode:void 0}],11:[function(e,t,a){"use strict";const i=e("vscode"),s=e("path"),o=e("lodash");class n{constructor(e,t,a){this._traceContext={},this._onUpdate=[],this._extensionContext=e,this._session=a,this._controller=t,this.id=a.id}asAbsolutePath(e){return this._extensionContext.asAbsolutePath(e)}scheduleOnUpdate(e){this._onUpdate.push(e)}runPendingUpdates(){o.each(this._onUpdate,e=>{try{return e()}catch(e){}}),this._onUpdate.length=0}requestTrace(e){return new Promise(t=>this._session.requestTrace(e,e=>t(e)))}updateTraceContext(e){this._session.isDisposed()||this._session.traceContext({currentFrame:e.frame})}requestCallStack(){this._session.isDisposed()||(this._session.traceContext({captureCallStackFrame:this._traceContext.frame}),this._controller._runTests("valueLine"))}receivedCallStack(e){this._callStack=e}currentCallStack(){return this._callStack}currentTraceFrame(){return this._traceContext.frame}stopTraceNavigation(){this._session.isDisposed()||this._session.traceContext({stopNavigation:!0})}}class r{constructor(e,t){this._data=e,this.label=e.context||"...",this.description=`${s.basename(e.file)}:${e.loc[0]}:${e.loc[1]}`,this.tooltip=`${this.label} at ${e.file}:${e.loc[0]}:${e.loc[1]}`,this.command={command:"wallaby.openCallStackFrame",arguments:[e]},this.iconPath={light:t.asAbsolutePath("images/location.light.svg"),dark:t.asAbsolutePath("images/location.dark.svg")}}}class l{constructor(e,t,a){this.iconPath={light:e.asAbsolutePath("images/location.light.svg"),dark:e.asAbsolutePath("images/location.dark.svg")},a?(this.label="Test ",this.description=t.name,this.iconPath={light:e.asAbsolutePath("images/test.light.svg"),dark:e.asAbsolutePath("images/test.dark.svg")}):this.label=t.name,this.tooltip=`Jump to ${t.name}`,this.command={command:"wallaby.playTraceNextStep",arguments:[{frame:t.start}]}}}class c{constructor(e){this._traceBeingNavigated=e,this._onDidChangeTreeData=new i.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event}refresh(){this._traceBeingNavigated()&&this._onDidChangeTreeData.fire()}getTreeItem(e){if(this._traceBeingNavigated())return e}getChildren(e){if(this._traceBeingNavigated())return e?e.getChildren():Promise.resolve(this._rootNodes)}}t.exports=class{constructor(e){this._callStackRootId=0,this._context=e,this._treeDataProvider=new c(()=>this.traceBeingNavigated()),this._onTraceNavigationStarted=new i.EventEmitter,this.onTraceNavigationStarted=this._onTraceNavigationStarted.event,i.window.registerTreeDataProvider&&i.window.registerTreeDataProvider("wallaby.traceExplorer",this._treeDataProvider)}reset(e,t){this._sessionContext&&this._sessionContext.runPendingUpdates(),this._treeDataProvider._rootNodes=[],delete this._callStackNodes,e&&t&&(this._sessionContext=new n(this._context,e,t)),this._setTraceBeingNavigatedContext(!1)}update(e){if(this._setTraceBeingNavigatedContext(!!e),e){if(e.callStack){const t=e.callStack[this._sessionContext.currentTraceFrame()];t&&t.stack&&(this._callStackNodes=t.stack.map(e=>new r(e,this._context)))}e.tests&&(this._testNodes=o.map(e.tests,e=>new l(this._context,e,!0))),e.files&&(this._fileNodes=o.map(e.files,e=>new l(this._context,e))),e.length&&(this._traceLength=e.length,this._traceBeingNavigated&&this._currentStep&&(this._statusNode=this._navigationStatusNode(this._currentStep,this._traceLength))),this._sessionContext.receivedCallStack(e.callStack),this._sessionContext.runPendingUpdates(),this._updateNodes()}}_navigationStatusNode(e,t){return{label:`Executed ${Math.floor((e.frame+1)/t*100)}%`,description:`step ${e.frame+1} of ${t} (click to locate)`,iconPath:{light:this._context.asAbsolutePath("images/progress.light.svg"),dark:this._context.asAbsolutePath("images/progress.dark.svg")},command:{command:"wallaby.revealTraceStep",arguments:[e]}}}_buildRootNodes(){const e=this,t=[];return this._statusNode&&t.push(this._statusNode),this._testNodes&&this._testNodes.length&&t.push({label:"Jump to",collapsibleState:2,iconPath:{light:this._context.asAbsolutePath("images/location.light.svg"),dark:this._context.asAbsolutePath("images/location.dark.svg")},getChildren(){let t=[];return e._testNodes&&e._testNodes.length&&(t=t.concat(e._testNodes)),e._fileNodes&&e._fileNodes.length&&t.push({label:"Loaded Files",collapsibleState:1,iconPath:{light:e._context.asAbsolutePath("images/files.light.svg"),dark:e._context.asAbsolutePath("images/files.dark.svg")},getChildren:()=>e._fileNodes}),t}}),this._traceBeingNavigated&&t.push({id:this._callStackRootId,label:"Call Stack",iconPath:{light:this._context.asAbsolutePath("images/callStack.light.svg"),dark:this._context.asAbsolutePath("images/callStack.dark.svg")},collapsibleState:1,getChildren(){if(e._callStackNodes){const t=e._callStackNodes;return delete e._callStackNodes,e._callStackRootId++,t}return e._sessionContext.requestCallStack(),new Promise(t=>{e._sessionContext.scheduleOnUpdate(t)})}}),t}requestTrace(e={}){return this._sessionContext.requestTrace(e)}_setTraceBeingNavigatedContext(e,t){i.commands.executeCommand("setContext","wallaby.traceBeingNavigated",e);const a=!!this._traceBeingNavigated;this._traceBeingNavigated=e,e||(this._statusNode=void 0),a!==e&&!t&&this._updateNodes(),e&&!a&&this._onTraceNavigationStarted.fire()}_updateNodes(){this._treeDataProvider._rootNodes=this._buildRootNodes(),this._treeDataProvider.refresh()}traceBeingNavigated(){return this._traceBeingNavigated}traceNavigated(e){e&&(this._currentStep=e,this._statusNode=this._navigationStatusNode(e,this._traceLength),this._sessionContext._traceContext.frame=e.frame),this._setTraceBeingNavigatedContext(!0,!0),this._updateNodes()}lastActiveStep(){return this._currentStep}updateTraceContext(e){return this._sessionContext.updateTraceContext(e)}stopTraceNavigation(){this._setTraceBeingNavigatedContext(!1),this._sessionContext.stopTraceNavigation(),this.update()}}},{lodash:void 0,path:void 0,vscode:void 0}],12:[function(e,t,a){"use strict";var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const s=e("vscode"),o=e("fs-extra"),n=e("path"),r=e("os"),l=n.join(r.homedir(),".wallaby","tutorial.json");t.exports={open(e="",t){return i(this,void 0,void 0,function*(){s.window.withProgress({location:s.ProgressLocation.Notification,title:"Wallaby Tutorial",cancellable:!1},a=>new Promise(c=>i(this,void 0,void 0,function*(){try{const i=o.mkdtempSync(n.join(r.tmpdir(),"wallaby-")),c=n.join(i,"main.zip");a.report({message:"Downloading and unpacking..."}),yield this._download("https://github.com/wallabyjs/tutorial/archive/refs/heads/main.zip",c);const d=n.join(r.homedir(),".wallaby","tutorial");try{o.removeSync(d)}catch(e){throw new Error('Can not remove the existing tutorial folder, please close the tutorial project in your editor if you have it opened, then open a new VS Code instance and run the "Open Tutorial" command.')}yield this._extract(c,d);const h=n.join(d,"wallaby-tutorial"),u=n.join(d,"wallaby-tutorial-original");o.removeSync(n.join(d,"tutorial-main",".idea")),o.renameSync(n.join(d,"tutorial-main"),h),o.copySync(h,u),a.report({message:"Installing packages..."});try{yield this._executeCommand("npm install",{cwd:h})}catch(e){try{yield this._executeCommand("yarn install",{cwd:h})}catch(e){const t=o.mkdtempSync(n.join(r.tmpdir(),"wallaby-tutorial-deps-")),a=n.join(t,"node_modules.zip");yield this._download("https://github.com/wallabyjs/tutorial-deps/releases/download/v2021-10-08/node_modules.zip",a),yield this._extract(a,h)}}if(e){const t=this.getState();t.currentModuleName=e,o.writeFileSync(l,JSON.stringify(t))}o.writeFileSync(n.join(h,"node_modules",".wallaby-tutorial"),""),yield s.commands.executeCommand("vscode.openFolder",s.Uri.file(h),!0),t&&t()}catch(e){s.window.showErrorMessage("An error occurred while opening tutorial: "+e.message)}c()})))})},getState(){let e;try{e=JSON.parse(o.readFileSync(l).toString())}catch(t){e={}}return e},getStateFilePath:()=>l,_download(t,a){return i(this,void 0,void 0,function*(){return new Promise((n,r)=>i(this,void 0,void 0,function*(){try{const i=e("node-fetch"),l={headers:{"User-Agent":"VS Code "+s.version}},c=yield i(t,l);if(!c.ok||200!==c.status)throw new Error(`Error while downloading wallaby tutorial from ${t}, status code: ${c.status}.`);{const e=yield c.buffer();o.writeFileSync(a,e),n()}}catch(e){r(e)}}))})},_executeCommand(t,a){return i(this,void 0,void 0,function*(){const i=e("child_process").spawn;return new Promise((e,s)=>{let o=i(t,Object.assign(Object.assign({},a||{}),{shell:!0})),n="",r="";o.stdout&&o.stdout.on("data",e=>{n+=e.toString()}),o.stderr&&o.stderr.on("data",e=>{r+=e.toString()}),o.on("exit",i=>{0===i?e({stdout:n,stderr:r,returnCode:i}):(console.warn(`Wallaby: child process exited with code ${i}`),console.warn(t,a),s(r?new Error(r):new Error("Return Code "+i))),o=void 0})})})},_extract(t,a){return i(this,void 0,void 0,function*(){const i=new(e("adm-zip-mit"))(t);yield new Promise((e,t)=>{i.extractAllToAsync(a,!0,a=>{a?t(a):e()})})})}}},{"adm-zip-mit":void 0,child_process:void 0,"fs-extra":void 0,"node-fetch":void 0,os:void 0,path:void 0,vscode:void 0}],13:[function(e,t,a){"use strict";const i=e("vscode"),s=e("lodash");class o{constructor(e,t){this._context=e,this._docsNode={label:"No logged values, click to see the feature docs",iconPath:this._context.asAbsolutePath("images/question.svg"),command:{command:"vscode.open",get arguments(){return[i.Uri.parse(t())]}},getParent:()=>void 0},this._treeDataProvider=new l(this._docsNode),this._treeDataProvider._rootNodes={},this._treeView=i.window.createTreeView("wallaby.valueExplorer",{treeDataProvider:this._treeDataProvider}),this._treeView.onDidExpandElement(e=>e.element.uiCollapsibleState=2),this._treeView.onDidCollapseElement(e=>e.element.uiCollapsibleState=1)}reveal(e,t){if(Object.keys(this._treeDataProvider._rootNodes).length){const a=e=>{const t=this._treeDataProvider._rootNodes;for(const a in t)if(t.hasOwnProperty(a)){const i=t[a];if(i.label===e)return i}},i=a(e),s={expand:!0,focus:!0};if(i){let o=i.getChildren();if(o)if("function"==typeof o[Symbol.iterator]){for(const e of o)if(e.data().expressionLocation.line===t)return void this._reveal(e,s);this._reveal(i,s)}else o.then(()=>{const i=a(e);if(i){const e=i.getChildren();if(e)for(const a of e)if(a.data().expressionLocation.line===t)return void this._reveal(a,s);this._reveal(i,s)}});else this._reveal(i,s)}else{const e=this._treeDataProvider._rootNodes;for(const t in e)if(e.hasOwnProperty(t)){const a=e[t];this._reveal(a,{expand:!1,focus:!1,select:!1})}}}else this._reveal(this._docsNode,{expand:!1,focus:!1,select:!1})}_reveal(e,t){return this._treeView.reveal(e,t).catch(()=>this._treeView.reveal(e,t).catch(e=>console.error(e)))}reset(e,t){this._sessionContext&&this._sessionContext.runPendingUpdates(),this._treeDataProvider._rootNodes={},this._treeDataProvider.refresh(),e&&t&&(this._sessionContext=new n(this._context,e,t))}update(e){try{if(e.reset&&(this._treeDataProvider._rootNodes={},this._sessionContext.resetExpressionsToEvaluate()),!e.specificFile){const t=e.files||{};s.each(this._treeDataProvider._rootNodes,(e,a)=>{t[a]||(delete this._treeDataProvider._rootNodes[a],this._sessionContext.removeFileFromExpressionsToEvaluate(a))})}s.each(e.files,(t,a)=>{const i=this._treeDataProvider._rootNodes[a];if(!i||t.messages&&t.messages.length||t.active){const n=new r(this._sessionContext,{id:a,name:t.name,queryPath:a.toString(),label:{name:t.name},fileNode:!0,disallowToCopyPath:!0,disallowToCopyData:!0,expandable:!0});let l=!1;n._children=s.chain(t.messages).map(e=>{let a=(e.valueBag||{}).data;if(!a)return;a.name||(a.name=o.removeExcessiveSpacesTabsLineBreaks(e.context));const i=(e.loc.toString()||"").split(":")[0];return i&&(a.name=`line ${i}${a.name?`: ${a.name}`:""}`),a.label=a.label||{},a.label.name=a.name,a.context=e.context,a.rootValueNode=!0,a.expressionLocation={file:t.name,loc:e.loc,line:parseInt(i,10)},a}).filter(e=>!!e).sortBy(function(e){return e.expressionLocation.line}).map(e=>(l=l||e.autoExpand,new r(this._sessionContext,e,n,e.autoExpand))).value();const c=l||t.active;if(n._children.length?c&&(n.collapsibleState=2):e.reset?n.collapsibleState=1:(c&&i&&i.lazy||delete n._children,c&&(n.collapsibleState=2)),i){let e=i.uiCollapsibleState,t=i.collapsibleState;void 0!==e?2!==e&&l?n.id=i.id.toString().startsWith("A")?n.id:"A"+n.id:(n.uiCollapsibleState=e,n.collapsibleState=e):void 0!==t&&n.collapsibleState!==t&&(n.id=i.id.toString().startsWith("A")?n.id:"A"+n.id)}this._treeDataProvider._rootNodes[a]=n}}),this._sessionContext.runPendingUpdates(),this._treeDataProvider.refresh()}catch(e){console.warn("Error while updating Value Explorer nodes: "+e.stack)}}static removeExcessiveSpacesTabsLineBreaks(e){return e&&e.replace(/\r\n\s*/g," ").replace(/\n\s*/g," ")}}class n{constructor(e,t,a){this._expressionsToEvaluate={},this._onUpdate=[],this._extensionContext=e,this._session=a,this._controller=t,this.id=a.id}asAbsolutePath(e){return this._extensionContext.asAbsolutePath(e)}isPathRequested(e,t){if("string"==typeof e)return;let a=this._expressionsToEvaluate;const i=s.every(e,e=>!!a[e]&&(a=a[e],!0));return i&&t?JSON.stringify(t)===JSON.stringify(a):i}requestNodes(e,t){const a=e._queryPath;if("string"==typeof a)return void(!this._session.isDisposed()&&this._session.getFileMessages(a));let i=this._expressionsToEvaluate;s.each(a,e=>{i[e]=i[e]||{},i=i[e]}),t&&(i.props=t.props,i.strLength=t.strLength,i.ranges=t.ranges),this._session.isDisposed()||(this._session.expressionsToEvaluate(this._expressionsToEvaluate),this._controller._runTests("valueLine",e.getRootExpressionLocation()))}scheduleOnUpdate(e){this._onUpdate.push(e)}copyToClipboard(e){!this._session.isDisposed()&&this._session.copyToClipboard(e)}cancelPendingUpdates(){this._onUpdate=[]}runPendingUpdates(){s.each(this._onUpdate,e=>{try{return e()}catch(e){}}),this._onUpdate.length=0}removeFileFromExpressionsToEvaluate(e){s.each(s.keys(this._expressionsToEvaluate),t=>{parseInt(t.split(",")[0],10)&&delete this._expressionsToEvaluate[e]})}resetExpressionsToEvaluate(){this._expressionsToEvaluate={}}}class r{constructor(e,t,a,s){this._context=e,this._parent=a,this._data=t,this.label=this._createLabel(),this.description=t.label&&t.label.description,this._queryPath=t.queryPath,this.id=(s?"A":"")+t.id,this.iconPath=this._getIconPath(),this.contextValue="",t.target&&(t.target.range=[t.target.line,0,t.target.line,1e4],t.target.noTrace=!0,this.command={command:"wallaby.openCallStackFrame",arguments:[t.target]}),t.disallowToCopyPath||(this.contextValue+="WallabyAllowToCopyPath"),t.disallowToCopyData||(this.contextValue+="WallabyAllowToCopyData"),t.rootValueNode&&(this.contextValue+="WallabyAllowToGoToSource"),this._autoExpand=s&&!this._data.cappedProps&&!this._data.capped&&!this._data.callStackNode&&!this._data.loadActionNode&&!this._data.rangeNode&&"string"!==this._data.type&&!this._data.getter&&!this._data.setter,this.collapsibleState=t.expandable?this._autoExpand?2:1:0,t.rangeNode&&(this._parentArray=a._parentArray||a,this._queryPath=this._parentArray._queryPath),t.fileNode&&(this.iconPath=i.ThemeIcon.File,this.resourceUri=i.Uri.file(t.name))}getParent(){return this._parent}getChildren(){if(this._children)return this._children;if(this.lazy=!0,"string"===this._data.type&&this._data.capped)return this._getChildren({strLength:Number.MAX_VALUE});if(this._data.loadActionNode)return this._getChildren({props:Number.MAX_VALUE});const e=(this._data.props||[]).map(e=>new r(this._context,e,this,this._autoExpand)),t=e=>e._data.functionsNode||e._data.loadActionNode||e._data.callStackNode;return this._data.rangeNode||"array"===this._data.type||"Map"===this._data.type||"Set"===this._data.type||e.sort(function(e,a){if(t(e)||t(a))return 0;const i=((e._data.label||{}).name||"").toLowerCase(),s=((a._data.label||{}).name||"").toLowerCase();return i<s?-1:i>s?1:0}),e.length?Promise.resolve(e):this._data.rangeNode?this._getChildren({ranges:{props:JSON.parse(JSON.stringify(this._parentArray._data.props,(e,t)=>(t.props&&(!t.props.length&&t===this._data||t.props.length&&!t.props[0].rangeNode)&&(t.props=!0),t))),length:this._parentArray._data.length}}):this._getChildren()}copyExpressionPath(){(this._data||{}).expressionPath&&this._context.copyToClipboard(this._data.expressionPath.join(""))}copyExpressionData(){this._data&&this._context.copyToClipboard(this._data)}data(){return this._data}getRootExpressionLocation(){let e=this;for(;e&&!e._data.rootValueNode;)e=e._parent;if(e)return e._data.expressionLocation}_getChildren(e){return this._context.isPathRequested(this._queryPath,e)?[]:(this._context.requestNodes(this,e),new Promise(e=>this._context.scheduleOnUpdate(e)))}_getIconPath(){if(this._data.getter)return this._context.asAbsolutePath("images/getter.svg");if(this._data.functionsNode)return this._context.asAbsolutePath("images/function.svg");if(this._data.loadActionNode)return this._context.asAbsolutePath("images/more.svg");if(this._data.error)return this._context.asAbsolutePath("images/error.svg");if(this._data.rangeNode)return this._context.asAbsolutePath("images/range.svg");if(this._data.callStackNode)return{light:this._context.asAbsolutePath("images/callStack.light.svg"),dark:this._context.asAbsolutePath("images/callStack.dark.svg")};if(this._data.callStackEntryNode)return{light:this._context.asAbsolutePath("images/location.light.svg"),dark:this._context.asAbsolutePath("images/location.dark.svg")};if(this._data.proxyNode)return{light:this._context.asAbsolutePath("images/usages.light.svg"),dark:this._context.asAbsolutePath("images/usages.dark.svg")};if(!this._data.fileNode){if(this._data.type)switch(this._data.type.toLowerCase()){case"string":if(this._data.capped)return this._context.asAbsolutePath("images/cappedString.svg");case"object":case"array":case"number":case"function":case"boolean":case"date":case"regexp":case"symbol":case"null":case"undefined":return this._context.asAbsolutePath(`images/${this._data.type.toLowerCase()}.svg`)}return this._context.asAbsolutePath("images/object.svg")}}_createLabel(){const e=this._data.label;let t="";return e.name&&(t+=e.name),e.type&&(t+=`: ${e.type} `),e.value&&(t+=(e.type?"":": ")+e.value),t}}class l{constructor(e){this._docsNode=e,this._onDidChangeTreeData=new i.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}getParent(e){if(e)return e.getParent()}getChildren(e){if(e)return e.getChildren();if(s.isEmpty(this._rootNodes))return Promise.resolve([this._docsNode]);try{return Promise.resolve(s.chain(this._rootNodes).values().sortBy(e=>e._data.name).value())}catch(e){console.warn("Error while trying to get Value Explorer root nodes: "+e.stack),Promise.resolve([])}}}t.exports=o},{lodash:void 0,vscode:void 0}],14:[function(e,t,a){t.exports={name:"wallaby-vscode",displayName:"Wallaby.js",description:"Accelerated Distraction-free JavaScript Testing.",version:"1.0.328",author:"Wallaby.js",homepage:"http://wallabyjs.com",bugs:{url:"https://github.com/wallabyjs/public/issues"},publisher:"WallabyJs",repository:{},engines:{vscode:"^1.25.0"},keywords:["testing","runner","unittest","JavaScript","TypeScript"],categories:["Other","Testing"],activationEvents:["*"],main:"./index",icon:"images/logo.png",galleryBanner:{color:"#ffffff",theme:"light"},contributes:{viewsContainers:{activitybar:[{id:"wallaby",title:"Wallaby Tools",icon:"images/logo.svg"}]},views:{wallaby:[{id:"wallaby.valueExplorer",name:"Value Explorer",when:"wallaby.started && wallaby.reportedAtLeastOnceLogValue"},{id:"wallaby.traceExplorer",name:"Debugger",when:"wallaby.traceBeingNavigated"},{id:"wallaby.testFileCoverageExplorer",name:"Test File Coverage",when:"wallaby.started"}]},commands:[{command:"wallaby.start",title:"Start",category:"Wallaby.js"},{command:"wallaby.stop",title:"Stop",category:"Wallaby.js"},{command:"wallaby.openStartView",title:"Open Start View",category:"Wallaby.js"},{command:"wallaby.showCommandPalette",title:"Show Commands",category:"Wallaby.js"},{command:"wallaby.jumpToFailingTest",title:"Jump to Failing Test",category:"Wallaby.js"},{command:"wallaby.jumpToErrorSource",title:"Jump to Error Source",category:"Wallaby.js"},{command:"wallaby.toggleUncovered",title:"Toggle Uncovered Code Regions",category:"Wallaby.js"},{command:"wallaby.showLineTests",title:"Show Line Tests",category:"Wallaby.js"},{command:"wallaby.showLineTestsFromMenu",title:"Wallaby.js: Show Line Tests",category:"Wallaby.js"},{command:"wallaby.showFailingTests",title:"Show Failing Tests",category:"Wallaby.js"},{command:"wallaby.showSideBySideDiff",title:"Show Side-by-Side Diff",category:"Wallaby.js"},{command:"wallaby.runProjectTests",title:"Run Project Tests",category:"Wallaby.js"},{command:"wallaby.runFileTests",title:"Run File Tests",category:"Wallaby.js"},{command:"wallaby.runLineTests",title:"Run Line Tests",category:"Wallaby.js"},{command:"wallaby.startExclusively",title:"Start Exclusive Test Run",category:"Wallaby.js"},{command:"wallaby.startExclusivelyFromMenu",title:"Wallaby.js: Start Exclusive Test Run",category:"Wallaby.js"},{command:"wallaby.selectAsConfigurationAndStart",title:"Wallaby.js: Configure and Start",category:"Wallaby.js"},{command:"wallaby.addToExclusiveTestRun",title:"Add to Exclusive Test Run",category:"Wallaby.js"},{command:"wallaby.addToExclusiveTestRunFromMenu",title:"Wallaby.js: Add to Exclusive Test Run",category:"Wallaby.js"},{command:"wallaby.updateProjectSnapshots",title:"Update Project Snapshots",category:"Wallaby.js"},{command:"wallaby.updateFileSnapshots",title:"Update File Snapshots",category:"Wallaby.js"},{command:"wallaby.updateTestSnapshots",title:"Update Test Snapshots",category:"Wallaby.js"},{command:"wallaby.showValue",title:"Show Value",category:"Wallaby.js"},{command:"wallaby.copyValue",title:"Copy Value",category:"Wallaby.js"},{command:"wallaby.openWallabyApp",title:"Launch Coverage & Test Explorer",category:"Wallaby.js"},{command:"wallaby.selectConfigFile",title:"Select Configuration",category:"Wallaby.js"},{command:"wallaby.startOnClosestMonoRepoProject",title:"Start on closest project in mono-repo",category:"Wallaby.js"},{command:"wallaby.showLastScreenshot",title:"Show Last Screenshot",category:"Wallaby.js"},{command:"wallaby.showLicense",title:"Manage License Key",category:"Wallaby.js"},{command:"wallaby.copyExpressionPath",title:"Copy Path",category:"Wallaby.js"},{command:"wallaby.copyExpressionData",title:"Copy Data",category:"Wallaby.js"},{command:"wallaby.goToExpressionSource",title:"Go to Source",category:"Wallaby.js"},{command:"wallaby.copyDiagnosticsReportToClipboard",title:"Copy Diagnostics Report",category:"Wallaby.js"},{command:"wallaby.runModeOnSave",title:"Make Current Session Run Only on Save",category:"Wallaby.js"},{command:"wallaby.runModeImmediate",title:"Make Current Session Run on Any Change",category:"Wallaby.js"},{command:"wallaby.runModeToggle",title:"Toggle Current Session Run Mode (Any Change/On Save)",category:"Wallaby.js"},{command:"wallaby.forceCoreUpdate",title:"Force Core Update",category:"Wallaby.js"},{command:"wallaby.toggleTestFilter",title:"Toggle Test Filter",category:"Wallaby.js"},{command:"wallaby.resetTestFilter",title:"Reset Test Filter",category:"Wallaby.js"},{command:"wallaby.resetUncovered",title:"Reset Uncovered Code Regions",category:"Wallaby.js"},{command:"wallaby.playTraceNextStep",title:"Step Into",category:"Wallaby.js",icon:{dark:"images/debug-step-into.dark.svg",light:"images/debug-step-into.light.svg"}},{command:"wallaby.playTracePrevStep",title:"Step Back Into",category:"Wallaby.js",icon:{dark:"images/debug-step-into-back.dark.svg",light:"images/debug-step-into-back.light.svg"}},{command:"wallaby.playTraceForwardToSelection",title:"Run to Active Line",category:"Wallaby.js",icon:{dark:"images/debug-continue.dark.svg",light:"images/debug-continue.light.svg"}},{command:"wallaby.playTraceBackwardToSelection",title:"Run Back to Active Line",category:"Wallaby.js",icon:{dark:"images/debug-continue-back.dark.svg",light:"images/debug-continue-back.light.svg"}},{command:"wallaby.playTraceForwardToBreakpoint",title:"Run to Breakpoint",category:"Wallaby.js",icon:{dark:"images/debug-continue-breakpoint.dark.svg",light:"images/debug-continue-breakpoint.light.svg"}},{command:"wallaby.playTraceBackwardToBreakpoint",title:"Run Back to Breakpoint",category:"Wallaby.js",icon:{dark:"images/debug-continue-back-breakpoint.dark.svg",light:"images/debug-continue-back-breakpoint.light.svg"}},{command:"wallaby.playTraceNextStepOver",title:"Step Over",category:"Wallaby.js",icon:{dark:"images/debug-step-over.dark.svg",light:"images/debug-step-over.light.svg"}},{command:"wallaby.playTracePrevStepOver",title:"Step Back Over",category:"Wallaby.js",icon:{dark:"images/debug-step-over-back.dark.svg",light:"images/debug-step-over-back.light.svg"}},{command:"wallaby.playTraceNextStepOut",title:"Step Out",category:"Wallaby.js",icon:{dark:"images/debug-step-out.dark.svg",light:"images/debug-step-out.light.svg"}},{command:"wallaby.playTracePrevStepOut",title:"Step Back Out",category:"Wallaby.js",icon:{dark:"images/debug-step-out-back.dark.svg",light:"images/debug-step-out-back.light.svg"}},{command:"wallaby.openCallStackFrame",title:"Open Call Stack Frame",category:"Wallaby.js"},{command:"wallaby.revealTraceStep",title:"Reveal Trace Step",category:"Wallaby.js"},{command:"wallaby.stopTraceNavigation",title:"Stop Debugger",category:"Wallaby.js",icon:{dark:"images/stop.dark.svg",light:"images/stop.light.svg"}},{command:"wallaby.lockTestStory",title:"Attach Test Story File to Debugger and Code",category:"Wallaby.js",icon:{dark:"images/lock.dark.svg",light:"images/lock.light.svg"}},{command:"wallaby.unlockTestStory",title:"Detach Test Story File from Debugger and Code",category:"Wallaby.js",icon:{dark:"images/unlock.dark.svg",light:"images/unlock.light.svg"}},{command:"wallaby.statusBarCommand",title:"Status Bar Command",category:"Wallaby.js"},{command:"wallaby.debugTest",title:"Debug Test",category:"Wallaby.js"},{command:"wallaby.showTestStory",title:"Open Test Story",category:"Wallaby.js"},{command:"wallaby.showTestStoryBeside",title:"Open Test Story Beside",category:"Wallaby.js"},{command:"wallaby.profileTest",title:"Profile Test",category:"Wallaby.js"},{command:"wallaby.jumpToLineTest",title:"Jump to Line Test",category:"Wallaby.js"},{command:"wallaby.searchTests",title:"Search Tests",category:"Wallaby.js"},{command:"wallaby.openFile",title:"Open File",category:"Wallaby.js"},{command:"wallaby.revealValue",title:"Reveal in Value Explorer",category:"Wallaby.js"},{command:"wallaby.navigate",title:"Navigate to File",category:"Wallaby.js"},{command:"wallaby.clearValue",title:"Clear Value",category:"Wallaby.js"},{command:"wallaby.clearFileValues",title:"Clear File Values",category:"Wallaby.js"},{command:"wallaby.clearAllValues",title:"Clear All Values",category:"Wallaby.js"},{command:"wallaby.showError",title:"Show Error",category:"Wallaby.js"},{command:"wallaby.closeInspector",title:"Close Output Inspector",category:"Wallaby.js"},{command:"wallaby.deleteInspection",title:"Delete Inspection",category:"Wallaby.js"},{command:"wallaby.jumpToSnapshot",title:"Jump to Snapshot",category:"Wallaby.js"},{command:"wallaby.toggleInspectorFocus",title:"Toggle Output Inspector Focus",category:"Wallaby.js"},{command:"wallaby.inspectValue",title:"Show in Output Inspector",category:"Wallaby.js"},{command:"wallaby.suppressShowingInspectorDocHeader",title:"Don't Show Output Inspector Doc Header",category:"Wallaby.js"},{command:"wallaby.openTutorial",title:"Open Tutorial",category:"Wallaby.js"},{command:"wallaby.openSampleProject",title:"Open Sample Project",category:"Wallaby.js"},{command:"wallaby.resetCache",title:"Reset Wallaby Cache",category:"Wallaby.js"},{command:"wallaby.testingMenuGoToTest",title:"Go to Test",category:"Wallaby.js",icon:{dark:"images/go-to-file.dark.svg",light:"images/go-to-file.light.svg"}},{command:"wallaby.testingMenuDebug",title:"Debug",category:"Wallaby.js",icon:{dark:"images/debug-test.dark.svg",light:"images/debug-test.light.svg"}},{command:"wallaby.testingMenuProfile",title:"Profile",category:"Wallaby.js"},{command:"wallaby.testingMenuRunTest",title:"Re-Run Test",category:"Wallaby.js"},{command:"wallaby.testingMenuViewStory",title:"View Story",category:"Wallaby.js",icon:{dark:"images/test-story.dark.svg",light:"images/test-story.light.svg"}},{command:"wallaby.testingMenuGoToError",title:"Go to Error",category:"Wallaby.js",icon:{dark:"images/go-to-error.dark.svg",light:"images/go-to-error.light.svg"}},{command:"wallaby.testingMenuUpdateSnapshot",title:"Update Snapshot(s)",category:"Wallaby.js",icon:{dark:"images/test-snapshot.dark.svg",light:"images/test-snapshot.light.svg"}},{command:"wallaby.testingMenuGoToFile",title:"Go to File",category:"Wallaby.js",icon:{dark:"images/go-to-file.dark.svg",light:"images/go-to-file.light.svg"}},{command:"wallaby.testingMenuRunFileTests",title:"Run Tests",category:"Wallaby.js"}],menus:{"extension/context":[{command:"wallaby.showLicense",when:"extensionStatus == installed && extension == wallabyjs.wallaby-vscode"},{command:"wallaby.forceCoreUpdate",when:"extensionStatus == installed && extension == wallabyjs.wallaby-vscode"}],"explorer/context":[{command:"wallaby.startExclusivelyFromMenu",when:"!wallaby.started && wallaby.feature.exclusiveTestRun && explorerResourceIsFolder && resourceFilename != .idea && resourceFilename != .vs && resourceFilename != .vscode && resourceFilename != node_modules || !wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == javascript && resourceFilename =~ /^(?!wallaby).*\\.js$/ && resourceFilename != jest.config.js || !wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == javascriptreact || !wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == typescript || !wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == typescriptreact || !wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == coffeescript || !wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == vue",group:"WallabyGroup@1"},{command:"wallaby.addToExclusiveTestRunFromMenu",when:"wallaby.started && wallaby.feature.exclusiveTestRun && explorerResourceIsFolder && resourceFilename != .idea && resourceFilename != .vs && resourceFilename != .vscode && resourceFilename != node_modules || wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == javascript && resourceFilename =~ /^(?!wallaby).*\\.js$/ && resourceFilename != jest.config.js || wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == javascriptreact || wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == typescript || wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == typescriptreact || wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == coffeescript || wallaby.started && wallaby.feature.exclusiveTestRun && resourceLangId == vue",group:"WallabyGroup@1"},{command:"wallaby.selectAsConfigurationAndStart",when:"explorerResourceIsFolder && resourceFilename != .idea && resourceFilename != .vs && resourceFilename != .vscode && resourceFilename != node_modules",group:"WallabyGroup@1"}],"editor/title":[{command:"wallaby.playTraceBackwardToSelection",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-998"},{command:"wallaby.playTracePrevStepOut",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-997"},{command:"wallaby.playTracePrevStep",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-996"},{command:"wallaby.playTracePrevStepOver",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-995"},{command:"wallaby.stopTraceNavigation",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-994"},{command:"wallaby.playTraceNextStepOver",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-993"},{command:"wallaby.playTraceNextStep",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-992"},{command:"wallaby.playTraceNextStepOut",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-991"},{command:"wallaby.playTraceForwardToSelection",when:"wallaby.started && wallaby.traceBeingNavigated && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked",group:"navigation@-990"},{command:"wallaby.playTraceBackwardToBreakpoint",when:"wallaby.started && wallaby.traceBeingNavigated && wallaby.hasAnyEnabledBreakpoints && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && wallaby.hasAnyEnabledBreakpoints && !wallaby.testStoryUnlocked",group:"navigation@-989"},{command:"wallaby.playTraceForwardToBreakpoint",when:"wallaby.started && wallaby.traceBeingNavigated && wallaby.hasAnyEnabledBreakpoints && resourceScheme != wallaby-test-timeline || wallaby.started && wallaby.traceBeingNavigated && wallaby.hasAnyEnabledBreakpoints && !wallaby.testStoryUnlocked",group:"navigation@-988"},{command:"wallaby.lockTestStory",when:"wallaby.started && wallaby.traceBeingNavigated && wallaby.testStoryUnlocked && resourceScheme == wallaby-test-timeline",group:"navigation@-987"},{command:"wallaby.unlockTestStory",when:"wallaby.started && wallaby.traceBeingNavigated && !wallaby.testStoryUnlocked && resourceScheme == wallaby-test-timeline",group:"navigation@-986"}],commandPalette:[{command:"wallaby.jumpToFailingTest",when:"wallaby.started"},{command:"wallaby.jumpToErrorSource",when:"wallaby.started"},{command:"wallaby.jumpToLineTest",when:"wallaby.started && activeEditor"},{command:"wallaby.toggleUncovered",when:"wallaby.started && activeEditor"},{command:"wallaby.showLineTests",when:"wallaby.started && activeEditor"},{command:"wallaby.showLineTestsFromMenu",when:"false"},{command:"wallaby.showFailingTests",when:"wallaby.started"},{command:"wallaby.showSideBySideDiff",when:"wallaby.started && activeEditor"},{command:"wallaby.runProjectTests",when:"wallaby.started"},{command:"wallaby.runFileTests",when:"wallaby.started && activeEditor"},{command:"wallaby.runLineTests",when:"wallaby.started && activeEditor"},{command:"wallaby.startExclusively",when:"activeEditor && wallaby.feature.exclusiveTestRun"},{command:"wallaby.startExclusivelyFromMenu",when:"false"},{command:"wallaby.selectAsConfigurationAndStart",when:"false"},{command:"wallaby.addToExclusiveTestRun",when:"activeEditor && wallaby.started && wallaby.feature.exclusiveTestRun"},{command:"wallaby.addToExclusiveTestRunFromMenu",when:"false"},{command:"wallaby.updateProjectSnapshots",when:"wallaby.started"},{command:"wallaby.updateFileSnapshots",when:"wallaby.started && activeEditor"},{command:"wallaby.updateTestSnapshots",when:"wallaby.started && activeEditor"},{command:"wallaby.showValue",when:"wallaby.started && activeEditor"},{command:"wallaby.copyValue",when:"wallaby.started && activeEditor"},{command:"wallaby.openWallabyApp",when:"wallaby.started"},{command:"wallaby.showLastScreenshot",when:"wallaby.started"},{command:"wallaby.copyDiagnosticsReportToClipboard",when:"wallaby.started && wallaby.feature.diagnostics"},{command:"wallaby.runModeOnSave",when:"wallaby.started"},{command:"wallaby.runModeImmediate",when:"wallaby.started"},{command:"wallaby.runModeToggle",when:"wallaby.started"},{command:"wallaby.copyExpressionPath",when:"false"},{command:"wallaby.copyExpressionData",when:"false"},{command:"wallaby.goToExpressionSource",when:"false"},{command:"wallaby.toggleTestFilter",when:"wallaby.started && activeEditor && wallaby.feature.testFilters"},{command:"wallaby.resetTestFilter",when:"wallaby.started && wallaby.testFilterToggled && wallaby.feature.testFilters"},{command:"wallaby.resetUncovered",when:"wallaby.started && wallaby.uncoveredToggled"},{command:"wallaby.playTraceNextStep",when:"false"},{command:"wallaby.playTracePrevStep",when:"false"},{command:"wallaby.playTraceForwardToSelection",when:"false"},{command:"wallaby.playTraceBackwardToSelection",when:"false"},{command:"wallaby.playTraceForwardToBreakpoint",when:"false"},{command:"wallaby.playTraceBackwardToBreakpoint",when:"false"},{command:"wallaby.playTraceNextStepOver",when:"false"},{command:"wallaby.playTracePrevStepOver",when:"false"},{command:"wallaby.playTraceNextStepOut",when:"false"},{command:"wallaby.playTracePrevStepOut",when:"false"},{command:"wallaby.openCallStackFrame",when:"false"},{command:"wallaby.revealTraceStep",when:"false"},{command:"wallaby.stopTraceNavigation",when:"wallaby.started && wallaby.traceBeingNavigated"},{command:"wallaby.statusBarCommand",when:"false"},{command:"wallaby.debugTest",when:"wallaby.started && activeEditor && wallaby.feature.debugger"},{command:"wallaby.profileTest",when:"wallaby.started && activeEditor && wallaby.feature.profiler && !wallaby.traceBeingNavigated"},{command:"wallaby.showTestStory",when:"wallaby.started && wallaby.feature.testStory && wallaby.traceBeingNavigated || wallaby.started && wallaby.feature.testStory && activeEditor"},{command:"wallaby.showTestStoryBeside",when:"wallaby.started && wallaby.feature.testStory && wallaby.traceBeingNavigated || wallaby.started && wallaby.feature.testStory && activeEditor"},{command:"wallaby.searchTests",when:"wallaby.started"},{command:"wallaby.openFile",when:"false"},{command:"wallaby.revealValue",when:"wallaby.started && activeEditor"},{command:"wallaby.lockTestStory",when:"false"},{command:"wallaby.unlockTestStory",when:"false"},{command:"wallaby.navigate",when:"false"},{command:"wallaby.clearValue",when:"wallaby.started && activeEditor && wallaby.feature.trackableValues && wallaby.lineHasRemovableInlineValues"},{command:"wallaby.clearFileValues",when:"wallaby.started && activeEditor && wallaby.feature.trackableValues && wallaby.fileHasRemovableInlineValues"},{command:"wallaby.clearAllValues",when:"wallaby.started && wallaby.feature.trackableValues"},{command:"wallaby.showError",when:"wallaby.started && activeEditor && wallaby.feature.inspections"},{command:"wallaby.deleteInspection",when:"wallaby.started && editorTextFocus && editorLangId == wallaby-inspector && wallaby.feature.inspections"},{command:"wallaby.jumpToSnapshot",when:"false"},{command:"wallaby.toggleInspectorFocus",when:"wallaby.started && wallaby.feature.inspections"},{command:"wallaby.closeInspector",when:"wallaby.started && wallaby.inspectorOpened && wallaby.feature.inspections"},{command:"wallaby.inspectValue",when:"wallaby.started && !wallaby.inspectorOpened && wallaby.feature.inspections"},{command:"wallaby.suppressShowingInspectorDocHeader",when:"false"},{command:"wallaby.openTutorial",when:"true"},{command:"wallaby.openSampleProject",when:"true"},{command:"wallaby.resetCache",when:"true"},{command:"wallaby.testingMenuGoToTest",when:"false"},{command:"wallaby.testingMenuDebug",when:"false"},{command:"wallaby.testingMenuProfile",when:"false"},{command:"wallaby.testingMenuRunTest",when:"false"},{command:"wallaby.testingMenuViewStory",when:"false"},{command:"wallaby.testingMenuGoToError",when:"false"},{command:"wallaby.testingMenuUpdateSnapshot",when:"false"},{command:"wallaby.testingMenuGoToFile",when:"false"},{command:"wallaby.testingMenuRunFileTests",when:"false"}],"view/title":[{command:"wallaby.playTraceBackwardToBreakpoint",when:"view =~ /wallaby.traceExplorer/ && wallaby.hasAnyEnabledBreakpoints",group:"navigation@1"},{command:"wallaby.playTraceBackwardToSelection",when:"view =~ /wallaby.traceExplorer/",group:"navigation@2"},{command:"wallaby.playTracePrevStepOut",when:"view =~ /wallaby.traceExplorer/",group:"navigation@3"},{command:"wallaby.playTracePrevStep",when:"view =~ /wallaby.traceExplorer/",group:"navigation@4"},{command:"wallaby.playTracePrevStepOver",when:"view =~ /wallaby.traceExplorer/",group:"navigation@5"},{command:"wallaby.stopTraceNavigation",when:"view =~ /wallaby.traceExplorer/ && wallaby.traceBeingNavigated",group:"navigation@6"},{command:"wallaby.playTraceNextStepOver",when:"view =~ /wallaby.traceExplorer/",group:"navigation@7"},{command:"wallaby.playTraceNextStep",when:"view =~ /wallaby.traceExplorer/",group:"navigation@8"},{command:"wallaby.playTraceNextStepOut",when:"view =~ /wallaby.traceExplorer/",group:"navigation@9"},{command:"wallaby.playTraceForwardToSelection",when:"view =~ /wallaby.traceExplorer/",group:"navigation@10"},{command:"wallaby.playTraceForwardToBreakpoint",when:"view =~ /wallaby.traceExplorer/ && wallaby.hasAnyEnabledBreakpoints",group:"navigation@11"}],"view/item/context":[{command:"wallaby.copyExpressionPath",when:"viewItem =~ /WallabyAllowToCopyPath/"},{command:"wallaby.copyExpressionData",when:"viewItem =~ /WallabyAllowToCopyData/"},{command:"wallaby.goToExpressionSource",when:"viewItem =~ /WallabyAllowToGoToSource/"}],"editor/context":[{command:"wallaby.showLineTestsFromMenu",group:"WallabyGroup@1",when:"wallaby.started && editorLangId != wallaby-inspector"}],"testing/item/context":[{command:"wallaby.testingMenuDebug",group:"inline@1",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.canGoToTest && wallaby.hasValidStats"},{command:"wallaby.testingMenuViewStory",group:"inline@2",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.canGoToTest && wallaby.hasValidStats"},{command:"wallaby.testingMenuGoToError",group:"inline@3",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.canGoToError && wallaby.hasValidStats"},{command:"wallaby.testingMenuUpdateSnapshot",group:"inline@4",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.canUpdateSnapshot && wallaby.hasValidStats"},{command:"wallaby.testingMenuGoToFile",group:"inline@5",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.canGoToFile && wallaby.hasValidStats"},{command:"wallaby.testingMenuGoToTest",group:"inline@5",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.canGoToTest && wallaby.hasValidStats"},{command:"wallaby.testingMenuProfile",group:"Wallaby@1",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.canGoToTest && wallaby.hasValidStats"},{command:"wallaby.testingMenuRunTest",group:"Wallaby@1",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.canGoToTest && wallaby.hasValidStats"},{command:"wallaby.testingMenuRunFileTests",group:"Wallaby@1",when:"wallaby.started && controllerId == wallaby && testId in wallaby.testingMenu.isFile && wallaby.hasValidStats"}]},keybindings:[{command:"wallaby.testingMenuGoToFile",weight:90,when:"focusedView == workbench.view.testing",key:"alt+enter"},{command:"wallaby.testingMenuGoToTest",weight:90,when:"focusedView == workbench.view.testing",key:"alt+enter"},{command:"wallaby.showCommandPalette",key:"ctrl+shift+=",mac:"cmd+shift+="},{command:"wallaby.start",key:"ctrl+shift+r r",mac:"cmd+shift+r r"},{command:"wallaby.stop",key:"ctrl+shift+r s",mac:"cmd+shift+r s"},{command:"wallaby.runProjectTests",key:"ctrl+shift+r p",mac:"cmd+shift+r p",when:"wallaby.started"},{command:"wallaby.showLastScreenshot",key:"ctrl+shift+r h",mac:"cmd+shift+r h",when:"wallaby.started"},{command:"wallaby.runLineTests",key:"ctrl+shift+r c",mac:"cmd+shift+r c",when:"wallaby.started && editorTextFocus"},{command:"wallaby.runFileTests",key:"ctrl+shift+r f",mac:"cmd+shift+r f",when:"wallaby.started && editorTextFocus"},{command:"wallaby.jumpToFailingTest",key:"ctrl+shift+r o",mac:"cmd+shift+r o",when:"wallaby.started && editorTextFocus"},{command:"wallaby.jumpToErrorSource",key:"ctrl+shift+r p",mac:"cmd+shift+r p",when:"wallaby.started && editorTextFocus"},{command:"wallaby.toggleUncovered",key:"ctrl+shift+r u",mac:"cmd+shift+r u",when:"wallaby.started && editorTextFocus"},{command:"wallaby.showFailingTests",key:"ctrl+shift+r t",mac:"cmd+shift+r t",when:"wallaby.started"},{command:"wallaby.showLineTests",key:"ctrl+shift+r l",mac:"cmd+shift+r l",when:"wallaby.started && editorTextFocus"},{command:"wallaby.showSideBySideDiff",key:"ctrl+shift+r d",mac:"cmd+shift+r d",when:"wallaby.started && editorTextFocus"},{command:"wallaby.showValue",key:"ctrl+shift+r v",mac:"cmd+shift+r v",when:"wallaby.started && editorTextFocus"},{command:"wallaby.copyValue",key:"ctrl+shift+r x",mac:"cmd+shift+r x",when:"wallaby.started && editorTextFocus"},{command:"wallaby.resetUncovered",key:"Escape",mac:"Escape",when:"wallaby.started && wallaby.uncoveredToggled && editorTextFocus"},{command:"wallaby.resetTestFilter",key:"shift+escape",mac:"shift+escape",when:"wallaby.started && wallaby.testFilterToggled && editorTextFocus"},{command:"wallaby.stopTraceNavigation",key:"shift+f5",mac:"shift+f5",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.debugTest",key:"shift+f5",mac:"shift+f5",when:"wallaby.started && !wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTraceNextStep",key:"f11",mac:"f11",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTraceForwardToSelection",key:"f5",mac:"f5",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTraceForwardToBreakpoint",key:"f8",mac:"f8",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTraceNextStepOver",key:"f10",mac:"f10",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTraceNextStepOut",key:"shift+f11",mac:"shift+f11",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTracePrevStep",key:"ctrl+f11",mac:"ctrl+f11",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTraceBackwardToSelection",key:"ctrl+f5",mac:"ctrl+f5",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTraceBackwardToBreakpoint",key:"ctrl+f8",mac:"ctrl+f8",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTracePrevStepOver",key:"ctrl+f10",mac:"ctrl+f10",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.playTracePrevStepOut",key:"ctrl+shift+f11",mac:"ctrl+shift+f11",when:"wallaby.started && wallaby.traceBeingNavigated && !inDebugMode"},{command:"wallaby.clearValue",key:"Escape",mac:"Escape",when:"wallaby.started && wallaby.feature.trackableValues && !wallaby.uncoveredToggled && wallaby.lineHasRemovableInlineValues && editorTextFocus && !suggestWidgetVisible && !findWidgetVisible && !renameInputVisible && !referenceSearchVisible && !inReferenceSearchEditor && !quickFixWidgetVisible && !parameterHintsVisible"},{command:"wallaby.clearFileValues",key:"Escape Escape",mac:"Escape Escape",when:"wallaby.started && wallaby.feature.trackableValues && !wallaby.uncoveredToggled && !wallaby.lineHasRemovableInlineValues && wallaby.fileHasRemovableInlineValues && editorTextFocus && !suggestWidgetVisible && !findWidgetVisible && !renameInputVisible && !referenceSearchVisible && !inReferenceSearchEditor && !quickFixWidgetVisible && !parameterHintsVisible && !editorHasSelection"},{command:"wallaby.closeInspector",key:"shift+escape",mac:"shift+escape",when:"wallaby.started && wallaby.inspectorOpened && editorTextFocus && wallaby.feature.inspections"},{command:"wallaby.toggleInspectorFocus",key:"ctrl+shift+/",mac:"ctrl+shift+/",when:"wallaby.started && editorTextFocus && wallaby.feature.inspections"},{command:"wallaby.navigate",key:"f12",mac:"f12",when:"wallaby.started && editorTextFocus && editorLangId == wallaby-inspector && wallaby.feature.inspections"},{command:"wallaby.deleteInspection",key:"delete",mac:"delete",when:"wallaby.started && editorTextFocus && editorLangId == wallaby-inspector && wallaby.feature.inspections"},{command:"wallaby.deleteInspection",key:"backspace",mac:"backspace",when:"wallaby.started && editorTextFocus && editorLangId == wallaby-inspector && wallaby.feature.inspections"}],languages:[{id:"wallaby-tests"},{id:"wallaby-console"},{id:"wallaby-timeline"},{id:"wallaby-inspector"},{id:"wallaby-error"}],grammars:[{language:"wallaby-tests",scopeName:"wallaby.tests",path:"./wallaby-tests.tmGrammar.json"},{language:"wallaby-console",scopeName:"wallaby.console",path:"./wallaby-console.tmGrammar.json"},{language:"wallaby-timeline",scopeName:"source.wallaby-timeline",path:"./wallaby-timeline.tmGrammar.json"},{language:"wallaby-inspector",scopeName:"source.wallaby-inspector",path:"./wallaby-inspector.tmGrammar.json"},{language:"wallaby-error",scopeName:"source.wallaby-error",path:"./wallaby-error.tmGrammar.json"}],configurationDefaults:{"[wallaby-tests]":{"editor.unicodeHighlight.invisibleCharacters":!1,"editor.unicodeHighlight.excludedCharacters":[],"editor.unicodeHighlight.nonBasicASCII":!1,"editor.unicodeHighlight.ambiguousCharacters":!1,"editor.unicodeHighlight.includeComments":!1},"[wallaby-console]":{"editor.unicodeHighlight.invisibleCharacters":!1,"editor.unicodeHighlight.excludedCharacters":[],"editor.unicodeHighlight.nonBasicASCII":!1,"editor.unicodeHighlight.ambiguousCharacters":!1,"editor.unicodeHighlight.includeComments":!1},"[wallaby-timeline]":{"editor.unicodeHighlight.invisibleCharacters":!1,"editor.unicodeHighlight.excludedCharacters":[],"editor.unicodeHighlight.nonBasicASCII":!1,"editor.unicodeHighlight.ambiguousCharacters":!1,"editor.unicodeHighlight.includeComments":!1},"[wallaby-inspector]":{"editor.unicodeHighlight.invisibleCharacters":!1,"editor.unicodeHighlight.excludedCharacters":[],"editor.unicodeHighlight.nonBasicASCII":!1,"editor.unicodeHighlight.ambiguousCharacters":!1,"editor.unicodeHighlight.includeComments":!1},"[wallaby-error]":{"editor.unicodeHighlight.invisibleCharacters":!1,"editor.unicodeHighlight.excludedCharacters":[],"editor.unicodeHighlight.nonBasicASCII":!1,"editor.unicodeHighlight.ambiguousCharacters":!1,"editor.unicodeHighlight.includeComments":!1}},configuration:{type:"object",title:"Wallaby configuration",properties:{"wallaby.startAutomatically":{description:"Start Wallaby automatically if Wallaby was running when the folder/workspace was last opened",type:"boolean",default:!0},"wallaby.useHttpForDownload":{description:"Use HTTP protocol to download wallaby updates",type:"boolean",default:!1},"wallaby.strictSSL":{description:"Use strict SSL to download wallaby updates",type:"boolean",default:!0},"wallaby.noAutomaticInstall":{description:"Stop automatic wallaby core updates",type:"boolean",default:!1},"wallaby.showUpdateNotifications":{description:"Show wallaby core update notifications",type:"boolean",default:!0},"wallaby.suppressExpirationNotifications":{description:"Stop wallaby expiring license update reminders",type:"boolean",default:!1},"wallaby.alwaysOpenLocalWallabyAppUrl":{description:"Always open locally hosted Wallaby App",type:"boolean",default:!1},"wallaby.node":{description:"Path to node.js executable that is used to run wallaby core",type:"string",default:""},"wallaby.useWsl":{description:"Use Windows Subsystem for Linux",type:"boolean",default:!1},"wallaby.reportFailuresAsProblems":{description:"Report Failing Tests to the VS Code Problems View",type:"boolean",default:!0},"wallaby.outputContentSize":{description:"Wallaby output content limit in bytes",type:"number",default:0},"wallaby.codeLensFeature.runTest":{description:"Enable Run Test Code Lens",type:"boolean",default:!1},"wallaby.codeLensFeature.debugger":{description:"Enable Debugger Code Lens",type:"boolean",default:!0},"wallaby.codeLensFeature.testStory":{description:"Enable Test Story Code Lens",type:"boolean",default:!0},"wallaby.codeLensFeature.profiler":{description:"Enable Profiler Code Lens",type:"boolean",default:!0},"wallaby.codeLensFeature.testFilters":{description:"Enable Test Filters Code Lens",type:"boolean",default:!0},"wallaby.codeLensFeature.updateSnapshots":{description:"Enable Update Snapshots Code Lens",type:"boolean",default:!0},"wallaby.compactMessageOutput":{description:"Minimize the number of new line characters between output console messages",type:"boolean",default:!1},"wallaby.startViewStatusBar":{description:"Display Wallaby Start View status bar indicator",type:"boolean",default:!0},"wallaby.showStartViewOnFeatureRelease":{description:"Display information about new features when they are released",type:"boolean",default:!0},"wallaby.runOnSaveIndicators":{description:"Displays coverage indicators and inline value messages when current session is configured to only run on save",type:"boolean",default:!0},"wallaby.outputInspectorFeature.automaticDisplay":{markdownDescription:"Specifies when [Output Inspector](https://wallabyjs.com/docs/intro/output-inspector.html) is automatically displayed",type:"string",default:"Large Values and Errors",enum:["All Values","Large Values and Errors","Errors Only","Never"],enumDescriptions:["Automatically opens Output Inspector on any use of Live Comments and Live Value Display (Show Value) or on use of Show Error feature","Automatically opens Output Inspector on use of Live Comments and Live Value Display (Show Value) for large values only or on use of Show Error feature","Automatically opens Output Inspector only on use of Show Error feature","Never automatically open the Output Inspector"]},"wallaby.outputInspectorFeature.automaticDisplayDebuggerOverride":{markdownDescription:"Specifies when [Output Inspector](https://wallabyjs.com/docs/intro/output-inspector.html) is automatically displayed in context of [Time Travel Debugger](https://wallabyjs.com/docs/intro/time-travel-debugger.html)",type:"string",default:"Errors Only",enum:["Inherit","Errors Only","Never"],enumDescriptions:["Inherits Automatic Output Inspector Display setting value","Automatically opens Output Inspector only on use of Show Error feature","Never automatically open the Output Inspector"]},"wallaby.outputInspectorFeature.showDocHeader":{markdownDescription:"Specifies whether [Output Inspector](https://wallabyjs.com/docs/intro/output-inspector.html) documenation header is displayed",type:"boolean",default:!0},"wallaby.colors":{description:"Wallaby gutter indicators colors (requires a restart after change)",type:"object",default:{covered:"#62b455",errorPath:"#ffa0a0",errorSource:"#fe536a",notCovered:"#cccccc",partiallyCovered:"#d2a032","snapshot.covered":"#62b455","snapshot.errorPath":"#ffa0a0","snapshot.errorSource":"#fe536a","snapshot.notCovered":"#cccccc","snapshot.partiallyCovered":"#d2a032"}},"wallaby.dimmedTextOpacity":{description:"A value between 0 (transparent) and 100 (opaque) to adjust dimmed Wallaby text in Output Inspector and Test Story Viewer (requires VS Code restart).",type:"number",default:50},"wallaby.diffViewPosition":{description:"Specifies the editor location where diffs will be displayed.",type:"string",default:"Default",enum:["Default","Active","Beside"],enumDescriptions:["VS Code default diff position (the first editor column)","The currently active editor column","Beside the currently active editor column"]}}}},devDependencies:{"@babel/core":"^7.11.1","@babel/plugin-syntax-class-properties":"^7.12.13","@babel/preset-env":"^7.11.0","@babel/preset-typescript":"^7.10.4","@types/vscode":"^1.53.0","babel-jest":"^26.3.0",grunt:"*","grunt-babel":"5.0.1","grunt-browserify":"*","grunt-bump":"0.0.16","grunt-contrib-clean":"*","grunt-contrib-compress":"^0.12.0","grunt-contrib-copy":"*","grunt-contrib-uglify-es":"*","grunt-ts":"^6.0.0-beta.16",jest:"^26.4.0",lodash:"*",typescript:"^3.1.1",vsce:"^1.46.0"},optionalDependencies:{"aws-sdk":"^2.353.0",keytar:"^4.10.0"},dependencies:{"adm-zip-mit":"0.4.12","fs-extra":"0.26.2",lodash:"3.0.0","node-fetch":"2.6.1",openurl2:"1.0.1",request:"2.88.0","tar-stream":"1.3.1","unbzip2-stream":"1.0.8"},__metadata:{id:"6766254a-8e43-4ebc-9b89-e5be39cb5318",publisherDisplayName:"Wallaby.js",publisherId:"9e43bb4e-4318-4e59-b5c2-df1109a963dd"},scripts:{build:"npm run test && node ./node_modules/grunt/bin/grunt",pub:"node ./node_modules/grunt/bin/grunt bump-only && npm run build && vsce publish && vsce package && node ./node_modules/grunt/bin/grunt publish-complete",release:"node ./docker/run.js",test:"jest"}}},{}]},{},[2]);