#!/usr/bin/env node
'use strict';
// Keep this file in sync with lighthouse
// TODO: have LH depend on this one.
/**
 * @fileoverview Script to launch a clean Chrome instance on-demand.
 *
 * Assuming Lighthouse is installed globally or `npm link`ed, use via:
 *     chrome-debug
 * Optionally enable extensions or pass a port, additional chrome flags, and/or a URL
 *     chrome-debug --port=9222
 *     chrome-debug http://goat.com
 *     chrome-debug --show-paint-rects
 *     chrome-debug --enable-extensions
 */
require('./compiled-check.js')('./dist/chrome-launcher.js');
var _a = require('./dist/chrome-launcher'), Launcher = _a.Launcher, launch = _a.launch;
var args = process.argv.slice(2);
var chromeFlags = [];
var startingUrl;
var port;
var ignoreDefaultFlags;
if (args.length) {
    var providedFlags = args.filter(function (flag) { return flag.startsWith('--'); });
    var portFlag = providedFlags.find(function (flag) { return flag.startsWith('--port='); });
    if (portFlag)
        port = parseInt(portFlag.replace('--port=', ''), 10);
    var enableExtensions = !!providedFlags.find(function (flag) { return flag === '--enable-extensions'; });
    // The basic pattern for enabling Chrome extensions
    if (enableExtensions) {
        ignoreDefaultFlags = true;
        chromeFlags.push.apply(chromeFlags, Launcher.defaultFlags().filter(function (flag) { return flag !== '--disable-extensions'; }));
    }
    chromeFlags.push.apply(chromeFlags, providedFlags);
    startingUrl = args.find(function (flag) { return !flag.startsWith('--'); });
}
launch({
    startingUrl: startingUrl,
    port: port,
    ignoreDefaultFlags: ignoreDefaultFlags,
    chromeFlags: chromeFlags,
})
    // eslint-disable-next-line no-console
    .then(function (v) { return console.log("\u2728  Chrome debugging port: " + v.port); });
